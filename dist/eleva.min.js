!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Eleva=t()}(this,(function(){"use strict";class e{static parse(e,t){return e.replace(/\{\{\s*(.*?)\s*\}\}/g,((e,n)=>{const o=this.evaluate(n,t);return void 0===o?"":o}))}static evaluate(e,t){try{const n=Object.keys(t),o=n.map((e=>t[e])),s=new Function(...n,`return ${e}`)(...o);return void 0===s?"":s}catch(n){return console.error("Template evaluation error:",{expression:e,data:t,error:n.message}),""}}}class t{constructor(e){this._value=e,this._watchers=new Set}get value(){return this._value}set value(e){e!==this._value&&(this._value=e,this._watchers.forEach((t=>t(e))))}watch(e){return this._watchers.add(e),()=>this._watchers.delete(e)}}class n{constructor(){this.events={}}on(e,t){(this.events[e]||(this.events[e]=[])).push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter((e=>e!==t)))}emit(e,...t){(this.events[e]||[]).forEach((e=>e(...t)))}}class o{patchDOM(e,t){const n=document.createElement("div");n.innerHTML=t,this.diff(e,n)}diff(e,t){const n=Array.from(e.childNodes),o=Array.from(t.childNodes),s=Math.max(n.length,o.length);for(let t=0;t<s;t++){const s=n[t],r=o[t];if(s||!r)if(!s||r){if(s.nodeType===Node.ELEMENT_NODE&&r.nodeType===Node.ELEMENT_NODE){const t=s.getAttribute("key"),n=r.getAttribute("key");if((t||n)&&t!==n){e.replaceChild(r.cloneNode(!0),s);continue}}s.nodeType===r.nodeType&&s.nodeName===r.nodeName?s.nodeType!==Node.TEXT_NODE?s.nodeType===Node.ELEMENT_NODE&&(this.updateAttributes(s,r),this.diff(s,r)):s.nodeValue!==r.nodeValue&&(s.nodeValue=r.nodeValue):e.replaceChild(r.cloneNode(!0),s)}else e.removeChild(s);else e.appendChild(r.cloneNode(!0))}}updateAttributes(e,t){const n={value:"value",checked:"checked",selected:"selected",disabled:"disabled"};Array.from(e.attributes).forEach((n=>{n.name.startsWith("@")||t.hasAttribute(n.name)||e.removeAttribute(n.name)})),Array.from(t.attributes).forEach((t=>{t.name.startsWith("@")||e.getAttribute(t.name)!==t.value&&(e.setAttribute(t.name,t.value),n[t.name]?e[n[t.name]]=t.value:t.name in e&&(e[t.name]=t.value))}))}}return class{constructor(e,t={}){this.name=e,this.config=t,this._components={},this._plugins=[],this._lifecycleHooks=["onBeforeMount","onMount","onBeforeUpdate","onUpdate","onUnmount"],this._isMounted=!1,this.emitter=new n,this.renderer=new o}use(e,t={}){return"function"==typeof e.install&&e.install(this,t),this._plugins.push(e),this}component(e,t){return this._components[e]=t,this}mount(n,o,s={}){const r="string"==typeof n?document.querySelector(n):n;if(!r)throw new Error(`Container not found: ${n}`);const i=this._components[o];if(!i)throw new Error(`Component "${o}" not registered.`);const{setup:a,template:c,style:u,children:l}=i,h={props:s,emit:this.emitter.emit.bind(this.emitter),on:this.emitter.on.bind(this.emitter),signal:e=>new t(e),...this._prepareLifecycleHooks()},d=n=>{const s={...h,...n},i=[],a=[];this._isMounted?s.onBeforeUpdate&&s.onBeforeUpdate():s.onBeforeMount&&s.onBeforeMount();const d=()=>{const t=e.parse(c(s),s);this.renderer.patchDOM(r,t),this._processEvents(r,s),this._injectStyles(r,o,u,s),this._mountChildren(r,l,a),this._isMounted?s.onUpdate&&s.onUpdate():(s.onMount&&s.onMount(),this._isMounted=!0)};return Object.values(n).forEach((e=>{e instanceof t&&i.push(e.watch(d))})),d(),{container:r,data:s,unmount:()=>{i.forEach((e=>e())),a.forEach((e=>e.unmount())),s.onUnmount&&s.onUnmount(),r.innerHTML=""}}},f=a(h);if(f&&"function"==typeof f.then)return f.then((e=>d(e)));return d(f||{})}_prepareLifecycleHooks(){return this._lifecycleHooks.reduce(((e,t)=>(e[t]=()=>{},e)),{})}_processEvents(t,n){t.querySelectorAll("*").forEach((t=>{[...t.attributes].forEach((({name:o,value:s})=>{if(o.startsWith("@")){const r=o.slice(1),i=e.evaluate(s,n);"function"==typeof i&&(t.addEventListener(r,i),t.removeAttribute(o))}}))}))}_injectStyles(t,n,o,s){if(o){let r=t.querySelector(`style[data-eleva-style="${n}"]`);r||(r=document.createElement("style"),r.setAttribute("data-eleva-style",n),t.appendChild(r)),r.textContent=e.parse(o(s),s)}}_mountChildren(e,t,n){n.forEach((e=>e.unmount())),n.length=0,Object.keys(t||{}).forEach((t=>{e.querySelectorAll(t).forEach((e=>{const o={};[...e.attributes].forEach((({name:e,value:t})=>{e.startsWith("eleva-prop-")&&(o[e.slice(11)]=t)}));const s=this.mount(e,t,o);n.push(s)}))}))}}}));
//# sourceMappingURL=eleva.min.js.map
