{"version":3,"file":"attr.umd.min.js","sources":["../../src/plugins/Attr.js"],"sourcesContent":["\"use strict\";\n\n/**\n * @module eleva/plugins/attr\n * @fileoverview Attribute plugin providing ARIA, data, boolean, and dynamic attribute handling.\n */\n\n// ============================================================================\n// TYPE DEFINITIONS\n// ============================================================================\n\n// -----------------------------------------------------------------------------\n// External Type Imports\n// -----------------------------------------------------------------------------\n\n/**\n * Type imports from the Eleva core library.\n * @typedef {import('eleva').Eleva} Eleva\n */\n\n// -----------------------------------------------------------------------------\n// Attr Type Definitions\n// -----------------------------------------------------------------------------\n\n/**\n * Configuration options for the AttrPlugin.\n * @typedef {Object} AttrPluginOptions\n * @property {boolean} [enableAria=true]\n *           Enable ARIA attribute handling.\n * @property {boolean} [enableData=true]\n *           Enable data attribute handling.\n * @property {boolean} [enableBoolean=true]\n *           Enable boolean attribute handling.\n * @property {boolean} [enableDynamic=true]\n *           Enable dynamic property detection.\n * @description Configuration options passed to AttrPlugin.install().\n */\n\n/**\n * Function signature for attribute update operations.\n * @typedef {(oldEl: HTMLElement, newEl: HTMLElement) => void} AttributeUpdateFunction\n * @description Updates attributes on oldEl to match newEl's attributes.\n */\n\n/**\n * A regular expression to match hyphenated lowercase letters.\n * @private\n * @type {RegExp}\n */\nconst CAMEL_RE = /-([a-z])/g;\n\n/**\n * @class ðŸŽ¯ AttrPlugin\n * @classdesc A plugin that provides advanced attribute handling for Eleva components.\n * This plugin extends the renderer with sophisticated attribute processing including:\n * - ARIA attribute handling with proper property mapping\n * - Data attribute management\n * - Boolean attribute processing\n * - Dynamic property detection and mapping\n * - Attribute cleanup and removal\n *\n * @example\n * // Install the plugin\n * const app = new Eleva(\"myApp\");\n * app.use(AttrPlugin);\n *\n * // Use advanced attributes in components\n * app.component(\"myComponent\", {\n *   template: (ctx) => `\n *     <button\n *       aria-expanded=\"${ctx.isExpanded.value}\"\n *       data-user-id=\"${ctx.userId.value}\"\n *       disabled=\"${ctx.isLoading.value}\"\n *       class=\"btn ${ctx.variant.value}\"\n *     >\n *       ${ctx.text.value}\n *     </button>\n *   `\n * });\n */\nexport const AttrPlugin = {\n  /**\n   * Unique identifier for the plugin\n   * @type {string}\n   */\n  name: \"attr\",\n\n  /**\n   * Plugin version\n   * @type {string}\n   */\n  version: \"1.1.1\",\n\n  /**\n   * Plugin description\n   * @type {string}\n   */\n  description: \"Advanced attribute handling for Eleva components\",\n\n  /**\n   * Installs the plugin into the Eleva instance.\n   *\n   * @public\n   * Method wrapping behavior:\n   * - Stores original `_patchNode` in `renderer._originalPatchNode`\n   * - Overrides `renderer._patchNode` to use enhanced attribute handling\n   * - Adds `renderer.updateAttributes` and `eleva.updateElementAttributes` helpers\n   * - Call `uninstall()` to restore original behavior\n   *\n   * @param {Eleva} eleva - The Eleva instance to enhance.\n   * @param {AttrPluginOptions} options - Plugin configuration options.\n   * @param {boolean} [options.enableAria=true] - Enable ARIA attribute handling.\n   *        Maps aria-* attributes to DOM properties (e.g., aria-expanded â†’ ariaExpanded).\n   * @param {boolean} [options.enableData=true] - Enable data attribute handling.\n   *        Syncs data-* attributes with element.dataset for consistent access.\n   * @param {boolean} [options.enableBoolean=true] - Enable boolean attribute handling.\n   *        Treats empty strings and attribute names as true, \"false\" string as false.\n   * @param {boolean} [options.enableDynamic=true] - Enable dynamic property detection.\n   *        Searches element prototype chain for property matches (useful for custom elements).\n   * @returns {void}\n   * @example\n   * // Basic installation with defaults\n   * app.use(AttrPlugin);\n   *\n   * @example\n   * // Custom configuration\n   * app.use(AttrPlugin, {\n   *   enableAria: true,\n   *   enableData: true,\n   *   enableBoolean: true,\n   *   enableDynamic: false  // Disable for performance\n   * });\n   *\n   * @example\n   * // Using ARIA attributes in templates\n   * template: (ctx) => `\n   *   <div role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"title\">\n   *     <h2 id=\"title\">Modal Title</h2>\n   *     <button aria-expanded=\"${ctx.isOpen.value}\">Toggle</button>\n   *   </div>\n   * `\n   * @see uninstall - Remove the plugin and restore original behavior.\n   */\n  install(eleva, options = {}) {\n    const {\n      enableAria = true,\n      enableData = true,\n      enableBoolean = true,\n      enableDynamic = true,\n    } = options;\n\n    /**\n     * Updates the attributes of an element to match a new element's attributes.\n     *\n     * Processing order:\n     * 1. Skip event attributes (@click, @input) - handled by Eleva's event system\n     * 2. Skip unchanged attributes - optimization\n     * 3. ARIA attributes (aria-*): Map to DOM properties (aria-expanded â†’ ariaExpanded)\n     * 4. Data attributes (data-*): Update both dataset and attribute\n     * 5. Boolean attributes: Handle empty string as true, \"false\" as false\n     * 6. Other attributes: Map to properties with dynamic detection for custom elements\n     * 7. Remove old attributes not present in new element\n     *\n     * Dynamic property detection (when enableDynamic=true):\n     * - Checks if property exists directly on element\n     * - Searches element's prototype chain for case-insensitive matches\n     * - Enables compatibility with custom elements and Web Components\n     *\n     * @inner\n     * @param {HTMLElement} oldEl - The original element to update (modified in-place).\n     * @param {HTMLElement} newEl - The reference element with desired attributes.\n     * @returns {void}\n     */\n    const updateAttributes = (oldEl, newEl) => {\n      const oldAttrs = oldEl.attributes;\n      const newAttrs = newEl.attributes;\n\n      // Process new attributes\n      for (let i = 0; i < newAttrs.length; i++) {\n        const { name, value } = newAttrs[i];\n\n        // Skip event attributes (handled by event system)\n        if (name.startsWith(\"@\")) continue;\n\n        // Skip if attribute hasn't changed\n        if (oldEl.getAttribute(name) === value) continue;\n\n        // Handle ARIA attributes\n        if (enableAria && name.startsWith(\"aria-\")) {\n          const prop =\n            \"aria\" + name.slice(5).replace(CAMEL_RE, (_, l) => l.toUpperCase());\n          oldEl[prop] = value;\n          oldEl.setAttribute(name, value);\n        }\n        // Handle data attributes\n        else if (enableData && name.startsWith(\"data-\")) {\n          oldEl.dataset[name.slice(5)] = value;\n          oldEl.setAttribute(name, value);\n        }\n        // Handle other attributes\n        else {\n          let prop = name.replace(CAMEL_RE, (_, l) => l.toUpperCase());\n\n          // Dynamic property detection\n          if (\n            enableDynamic &&\n            !(prop in oldEl) &&\n            !Object.getOwnPropertyDescriptor(Object.getPrototypeOf(oldEl), prop)\n          ) {\n            const elementProps = Object.getOwnPropertyNames(\n              Object.getPrototypeOf(oldEl)\n            );\n            const matchingProp = elementProps.find(\n              (p) =>\n                p.toLowerCase() === name.toLowerCase() ||\n                p.toLowerCase().includes(name.toLowerCase()) ||\n                name.toLowerCase().includes(p.toLowerCase())\n            );\n\n            if (matchingProp) {\n              prop = matchingProp;\n            }\n          }\n\n          const descriptor = Object.getOwnPropertyDescriptor(\n            Object.getPrototypeOf(oldEl),\n            prop\n          );\n          const hasProperty = prop in oldEl || descriptor;\n\n          if (hasProperty) {\n            // Boolean attribute handling\n            if (enableBoolean) {\n              const isBoolean =\n                typeof oldEl[prop] === \"boolean\" ||\n                (descriptor?.get &&\n                  typeof descriptor.get.call(oldEl) === \"boolean\");\n\n              if (isBoolean) {\n                const boolValue =\n                  value !== \"false\" &&\n                  (value === \"\" || value === prop || value === \"true\");\n                oldEl[prop] = boolValue;\n\n                if (boolValue) {\n                  oldEl.setAttribute(name, \"\");\n                } else {\n                  oldEl.removeAttribute(name);\n                }\n              } else {\n                oldEl[prop] = value;\n                oldEl.setAttribute(name, value);\n              }\n            } else {\n              oldEl[prop] = value;\n              oldEl.setAttribute(name, value);\n            }\n          } else {\n            oldEl.setAttribute(name, value);\n          }\n        }\n      }\n\n      // Remove old attributes that are no longer present\n      for (let i = oldAttrs.length - 1; i >= 0; i--) {\n        const name = oldAttrs[i].name;\n        if (!newEl.hasAttribute(name)) {\n          oldEl.removeAttribute(name);\n        }\n      }\n    };\n\n    // Extend the renderer with the advanced attribute handler\n    if (eleva.renderer) {\n      eleva.renderer.updateAttributes = updateAttributes;\n\n      // Store the original _patchNode method\n      const originalPatchNode = eleva.renderer._patchNode;\n      eleva.renderer._originalPatchNode = originalPatchNode;\n\n      /**\n       * Overridden _patchNode method that uses enhanced attribute handling.\n       * Delegates to `updateAttributes` instead of the basic `_updateAttributes`.\n       *\n       * @param {Node} oldNode - The original DOM node to update.\n       * @param {Node} newNode - The new DOM node with desired state.\n       * @returns {void}\n       */\n      eleva.renderer._patchNode = function (oldNode, newNode) {\n        if (oldNode?._eleva_instance) return;\n\n        if (oldNode.nodeType === Node.TEXT_NODE) {\n          if (oldNode.nodeValue !== newNode.nodeValue) {\n            oldNode.nodeValue = newNode.nodeValue;\n          }\n        } else if (oldNode.nodeType === Node.ELEMENT_NODE) {\n          // Use advanced attribute handler instead of basic _updateAttributes\n          updateAttributes(oldNode, newNode);\n          this._diff(oldNode, newNode);\n        }\n      };\n    }\n\n    // Add plugin metadata to the Eleva instance\n    if (!eleva.plugins) {\n      eleva.plugins = new Map();\n    }\n    eleva.plugins.set(this.name, {\n      name: this.name,\n      version: this.version,\n      description: this.description,\n      options,\n    });\n\n    // Add utility methods for manual attribute updates\n    /** @type {AttributeUpdateFunction} */\n    eleva.updateElementAttributes = updateAttributes;\n  },\n\n  /**\n   * Uninstalls the plugin from the Eleva instance.\n   *\n   * @public\n   * @param {Eleva} eleva - The Eleva instance.\n   * @returns {void}\n   * @description\n   * Restores the original renderer patching behavior and removes\n   * `eleva.updateElementAttributes`.\n   * @example\n   * // Uninstall the plugin\n   * AttrPlugin.uninstall(app);\n   * @see install - Install the plugin.\n   */\n  uninstall(eleva) {\n    // Restore original _patchNode method if it exists\n    if (eleva.renderer && eleva.renderer._originalPatchNode) {\n      eleva.renderer._patchNode = eleva.renderer._originalPatchNode;\n      delete eleva.renderer._originalPatchNode;\n    }\n\n    // Remove plugin metadata\n    if (eleva.plugins) {\n      eleva.plugins.delete(this.name);\n    }\n\n    // Remove utility methods\n    delete eleva.updateElementAttributes;\n  },\n};\n\n// Short name export for convenience\nexport { AttrPlugin as Attr };\n"],"names":["CAMEL_RE","AttrPlugin","name","version","description","install","eleva","options","enableAria","enableData","enableBoolean","enableDynamic","updateAttributes","oldEl","newEl","oldAttrs","attributes","newAttrs","i","length","value","startsWith","getAttribute","slice","replace","_","l","toUpperCase","setAttribute","dataset","prop","Object","getOwnPropertyDescriptor","getPrototypeOf","matchingProp","elementProps","getOwnPropertyNames","find","p","toLowerCase","includes","descriptor","get","call","boolValue","removeAttribute","hasAttribute","renderer","originalPatchNode","_patchNode","_originalPatchNode","oldNode","newNode","_eleva_instance","nodeType","Node","TEXT_NODE","nodeValue","ELEMENT_NODE","_diff","plugins","Map","set","updateElementAttributes","uninstall","delete"],"mappings":"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"}