!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Eleva=t()}(this,(function(){"use strict";class e{static parse(e,t){return e.trim()?e.replace(/\{\{\s*(.*?)\s*\}\}/g,((e,n)=>{const o=this.evaluate(n,t);return void 0===o?"":o})):""}static evaluate(e,t){try{if(!e.trim())return"";const n=Object.keys(t),o=Object.values(t),s=new Function(...n,`return ${e}`)(...o);return void 0===s?"":s}catch(n){return console.error("Template evaluation error:",{expression:e,data:t,error:n.message}),""}}}class t{constructor(e){this._value=e,this._watchers=new Set,this._pending=!1}get value(){return this._value}set value(e){e!==this._value&&(this._value=e,this._notifyWatchers())}watch(e){return this._watchers.add(e),()=>this._watchers.delete(e)}_notifyWatchers(){this._pending||(this._pending=!0,queueMicrotask((()=>{this._pending=!1,this._watchers.forEach((e=>e(this._value)))})))}}class n{constructor(){this.events={}}on(e,t){(this.events[e]||(this.events[e]=[])).push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter((e=>e!==t)))}emit(e,...t){(this.events[e]||[]).forEach((e=>e(...t)))}}class o{patchDOM(e,t){const n=document.createElement("div");n.innerHTML=t,this.diff(e,n)}diff(e,t){if(e.isEqualNode(t))return;const n=e&&e.childNodes?Array.from(e.childNodes):[],o=t&&t.childNodes?Array.from(t.childNodes):[],s=Math.max(n.length,o.length);for(let t=0;t<s;t++){const s=n[t],r=o[t];if(s||!r)if(!s||r){if(s.nodeType===Node.ELEMENT_NODE&&r.nodeType===Node.ELEMENT_NODE){const t=s.getAttribute("key"),n=r.getAttribute("key");if((t||n)&&t!==n){e.replaceChild(r.cloneNode(!0),s);continue}}s.nodeType===r.nodeType&&s.nodeName===r.nodeName?s.nodeType!==Node.TEXT_NODE?s.nodeType===Node.ELEMENT_NODE&&(this.updateAttributes(s,r),this.diff(s,r)):s.nodeValue!==r.nodeValue&&(s.nodeValue=r.nodeValue):e.replaceChild(r.cloneNode(!0),s)}else e.removeChild(s);else e.appendChild(r.cloneNode(!0))}}updateAttributes(e,t){const n={value:"value",checked:"checked",selected:"selected",disabled:"disabled"};Array.from(e.attributes).forEach((n=>{n.name.startsWith("@")||t.hasAttribute(n.name)||e.removeAttribute(n.name)})),Array.from(t.attributes).forEach((t=>{t.name.startsWith("@")||e.getAttribute(t.name)!==t.value&&(e.setAttribute(t.name,t.value),n[t.name]?e[n[t.name]]=t.value:t.name in e&&(e[t.name]=t.value))}))}}return class{constructor(e,t={}){this.name=e,this.config=t,this._components={},this._plugins=[],this._lifecycleHooks=["onBeforeMount","onMount","onBeforeUpdate","onUpdate","onUnmount"],this._isMounted=!1,this.emitter=new n,this.renderer=new o}use(e,t={}){return"function"==typeof e.install&&e.install(this,t),this._plugins.push(e),this}component(e,t){return this._components[e]=t,this}mount(n,o,s={}){if(!n)throw new Error(`Container not found: ${n}`);let r;if("string"==typeof o){if(r=this._components[o],!r)throw new Error(`Component "${o}" not registered.`)}else{if("object"!=typeof o)throw new Error("Invalid component parameter.");r=o}const{setup:i,template:a,style:c,children:u}=r,l={props:s,emitter:this.emitter,signal:e=>new t(e),...this._prepareLifecycleHooks()},h=s=>{const r={...l,...s},i=[],h=[],d=[];this._isMounted?r.onBeforeUpdate&&r.onBeforeUpdate():r.onBeforeMount&&r.onBeforeMount();const f=()=>{const t=e.parse(a(r),r);this.renderer.patchDOM(n,t),this._processEvents(n,r,d),this._injectStyles(n,o,c,r),this._mountChildren(n,u,h),this._isMounted?r.onUpdate&&r.onUpdate():(r.onMount&&r.onMount(),this._isMounted=!0)};return Object.values(s).forEach((e=>{e instanceof t&&i.push(e.watch(f))})),f(),{container:n,data:r,unmount:()=>{i.forEach((e=>e())),d.forEach((e=>e())),h.forEach((e=>e.unmount())),r.onUnmount&&r.onUnmount(),n.innerHTML=""}}};return Promise.resolve("function"==typeof i?i(l):{}).then((e=>h(e)))}_prepareLifecycleHooks(){return this._lifecycleHooks.reduce(((e,t)=>(e[t]=()=>{},e)),{})}_processEvents(t,n,o){t.querySelectorAll("*").forEach((t=>{[...t.attributes].forEach((({name:s,value:r})=>{if(s.startsWith("@")){const i=s.slice(1),a=e.evaluate(r,n);"function"==typeof a&&(t.addEventListener(i,a),t.removeAttribute(s),o.push((()=>t.removeEventListener(i,a))))}}))}))}_injectStyles(t,n,o,s){if(o){let r=t.querySelector(`style[data-eleva-style="${n}"]`);r||(r=document.createElement("style"),r.setAttribute("data-eleva-style",n),t.appendChild(r)),r.textContent=e.parse(o(s),s)}}_mountChildren(e,t,n){n.forEach((e=>e.unmount())),n.length=0,Object.keys(t||{}).forEach((o=>{e.querySelectorAll(o).forEach((e=>{const s={};[...e.attributes].forEach((({name:e,value:t})=>{e.startsWith("eleva-prop-")&&(s[e.slice(11)]=t)}));const r=this.mount(e,t[o],s);n.push(r)}))}))}}}));
//# sourceMappingURL=eleva.min.js.map
