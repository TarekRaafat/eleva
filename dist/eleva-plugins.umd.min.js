/*! Eleva Plugins v1.0.0-rc.5 | MIT License | https://elevajs.com */
var e,t;e=this,t=function(e){"use strict";const t=/-([a-z])/g,r={name:"attr",version:"1.0.0-rc.1",description:"Advanced attribute handling for Eleva components",install(e,r={}){const{enableAria:n=!0,enableData:o=!0,enableBoolean:i=!0,enableDynamic:a=!0}=r,s=(e,r)=>{const s=e.attributes,u=r.attributes;for(let r=0;r<u.length;r++){const{name:s,value:l}=u[r];if(!s.startsWith("@")&&e.getAttribute(s)!==l)if(n&&s.startsWith("aria-"))e["aria"+s.slice(5).replace(t,(e,t)=>t.toUpperCase())]=l,e.setAttribute(s,l);else if(o&&s.startsWith("data-"))e.dataset[s.slice(5)]=l,e.setAttribute(s,l);else{let r=s.replace(t,(e,t)=>t.toUpperCase());if(a&&!(r in e)&&!Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),r)){const t=Object.getOwnPropertyNames(Object.getPrototypeOf(e)).find(e=>e.toLowerCase()===s.toLowerCase()||e.toLowerCase().includes(s.toLowerCase())||s.toLowerCase().includes(e.toLowerCase()));t&&(r=t)}const n=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),r);if(r in e||n)if(i)if("boolean"==typeof e[r]||n?.get&&"boolean"==typeof n.get.call(e)){const t="false"!==l&&(""===l||l===r||"true"===l);e[r]=t,t?e.setAttribute(s,""):e.removeAttribute(s)}else e[r]=l,e.setAttribute(s,l);else e[r]=l,e.setAttribute(s,l);else e.setAttribute(s,l)}}for(let t=s.length-1;t>=0;t--){const n=s[t].name;r.hasAttribute(n)||e.removeAttribute(n)}};e.renderer&&(e.renderer.updateAttributes=s,e.renderer._originalPatchNode=e.renderer._patchNode,e.renderer._patchNode=function(e,t){e?._eleva_instance||(this._isSameNode(e,t)?e.nodeType===Node.ELEMENT_NODE?(s(e,t),this._diff(e,t)):e.nodeType===Node.TEXT_NODE&&e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.replaceWith(t.cloneNode(!0)))}),e.plugins||(e.plugins=new Map),e.plugins.set(this.name,{name:this.name,version:this.version,description:this.description,options:r}),e.updateElementAttributes=s},uninstall(e){e.renderer&&e.renderer._originalPatchNode&&(e.renderer._patchNode=e.renderer._originalPatchNode,delete e.renderer._originalPatchNode),e.plugins&&e.plugins.delete(this.name),delete e.updateElementAttributes}},n={handle(e,t,r={}){const n=new Error(`[ElevaRouter] ${t}: ${e.message}`);throw n.originalError=e,n.context=t,n.details=r,n},warn(e,t={}){},log(e,t,r={}){}};class o{constructor(e,t={}){this.eleva=e,this.options={mode:"hash",queryParam:"view",viewSelector:"root",...t},this.routes=this._processRoutes(t.routes||[]),this.emitter=this.eleva.emitter,this.isStarted=!1,this._isNavigating=!1,this.eventListeners=[],this.currentRoute=new this.eleva.signal(null),this.previousRoute=new this.eleva.signal(null),this.currentParams=new this.eleva.signal({}),this.currentQuery=new this.eleva.signal({}),this.currentLayout=new this.eleva.signal(null),this.currentView=new this.eleva.signal(null),this.plugins=new Map,this.errorHandler=n,this._validateOptions()}_validateOptions(){["hash","query","history"].includes(this.options.mode)||this.errorHandler.handle(new Error(`Invalid routing mode: ${this.options.mode}. Must be "hash", "query", or "history".`),"Configuration validation failed")}_processRoutes(e){const t=[];for(const r of e)try{t.push({...r,segments:this._parsePathIntoSegments(r.path)})}catch(e){this.errorHandler.warn(`Invalid path in route definition "${r.path||"undefined"}": ${e.message}`,{route:r,error:e})}return t}_parsePathIntoSegments(e){e&&"string"==typeof e||this.errorHandler.handle(new Error("Route path must be a non-empty string"),"Path parsing failed",{path:e});const t=e.replace(/\/+/g,"/").replace(/\/$/,"")||"/";return"/"===t?[]:t.split("/").filter(Boolean).map(t=>{if(t.startsWith(":")){const r=t.substring(1);return r||this.errorHandler.handle(new Error(`Invalid parameter segment: ${t}`),"Path parsing failed",{segment:t,path:e}),{type:"param",name:r}}return{type:"static",value:t}})}_findViewElement(e){const t=this.options.viewSelector;return e.querySelector(`#${t}`)||e.querySelector(`.${t}`)||e.querySelector(`[data-${t}]`)||e.querySelector(t)||e}async start(){if(this.isStarted)return void this.errorHandler.warn("Router is already started");if("undefined"==typeof window)return void this.errorHandler.warn("Router start skipped: `window` object not available (SSR environment)");if("undefined"!=typeof document&&!document.querySelector(this.options.mount))return void this.errorHandler.warn(`Mount element "${this.options.mount}" was not found in the DOM. The router will not start.`,{mountSelector:this.options.mount});const e=()=>this._handleRouteChange();"hash"===this.options.mode?(window.addEventListener("hashchange",e),this.eventListeners.push(()=>window.removeEventListener("hashchange",e))):(window.addEventListener("popstate",e),this.eventListeners.push(()=>window.removeEventListener("popstate",e))),this.isStarted=!0,await this._handleRouteChange()}async destroy(){if(this.isStarted){for(const e of this.plugins.values())if("function"==typeof e.destroy)try{await e.destroy(this)}catch(t){this.errorHandler.log(`Plugin ${e.name} destroy failed`,t)}this.eventListeners.forEach(e=>e()),this.eventListeners=[],this.currentLayout.value&&await this.currentLayout.value.unmount(),this.isStarted=!1}}async navigate(e,t={}){try{const r="string"==typeof e?{path:e,params:t}:e;let n=this._buildPath(r.path,r.params||{});const o=r.query||{};if(Object.keys(o).length>0){const e=new URLSearchParams(o).toString();e&&(n+=`?${e}`)}if(this._isSameRoute(n,r.params,o))return;if(await this._proceedWithNavigation(n)){this._isNavigating=!0;const e=r.state||{},t=r.replace||!1,o=t?"replaceState":"pushState";if("hash"===this.options.mode)if(t){const t=`${window.location.pathname}${window.location.search}#${n}`;window.history.replaceState(e,"",t)}else window.location.hash=n;else{const t="query"===this.options.mode?this._buildQueryUrl(n):n;history[o](e,"",t)}queueMicrotask(()=>{this._isNavigating=!1})}}catch(e){this.errorHandler.log("Navigation failed",e),await this.emitter.emit("router:onError",e)}}_buildQueryUrl(e){const t=new URLSearchParams(window.location.search);return t.set(this.options.queryParam,e.split("?")[0]),`${window.location.pathname}?${t.toString()}`}_isSameRoute(e,t,r){const n=this.currentRoute.value;if(!n)return!1;const[o,i]=e.split("?"),a=r||this._parseQuery(i||"");return n.path===o&&JSON.stringify(n.params)===JSON.stringify(t||{})&&JSON.stringify(n.query)===JSON.stringify(a)}_buildPath(e,t){let r=e;for(const[e,n]of Object.entries(t)){const t=encodeURIComponent(String(n));r=r.replace(new RegExp(`:${e}\\b`,"g"),t)}return r}async _handleRouteChange(){if(this._isNavigating)return;const e=this.currentRoute.value,t=this._getCurrentLocation();!await this._proceedWithNavigation(t.fullUrl)&&e&&this.navigate({path:e.path,query:e.query,replace:!0})}async _proceedWithNavigation(e){const t=this.currentRoute.value,[r,n]=(e||"/").split("?"),o={path:r.startsWith("/")?r:`/${r}`,query:this._parseQuery(n),fullUrl:e};let i=this._matchRoute(o.path);if(!i){const e=this.routes.find(e=>"*"===e.path);if(!e)return await this.emitter.emit("router:onError",new Error(`Route not found: ${o.path}`),o,t),!1;i={route:e,params:{pathMatch:o.path.substring(1)}}}const a={...o,params:i.params,meta:i.route.meta||{},name:i.route.name,matched:i.route};try{if(!await this._runGuards(a,t,i.route))return!1;const{layoutComponent:e,pageComponent:r}=await this._resolveComponents(i.route);if(t){const e=async e=>{if(e)try{await e.unmount()}catch(t){this.errorHandler.warn("Error during component unmount",{error:t,instance:e})}};(i.route.layout||this.options.globalLayout)!==(t.matched.layout||this.options.globalLayout)?(await e(this.currentLayout.value),this.currentLayout.value=null):(await e(this.currentView.value),this.currentView.value=null),t.matched.afterLeave&&(await t.matched.afterLeave(a,t),await this.emitter.emit("router:afterLeave",a,t))}return this.previousRoute.value=t,this.currentRoute.value=a,this.currentParams.value=a.params||{},this.currentQuery.value=a.query||{},await this._render(e,r,a),i.route.afterEnter&&(await i.route.afterEnter(a,t),await this.emitter.emit("router:afterEnter",a,t)),await this.emitter.emit("router:afterEach",a,t),!0}catch(e){return this.errorHandler.log("Error during navigation",e,{to:a,from:t}),await this.emitter.emit("router:onError",e,a,t),!1}}async _runGuards(e,t,r){const n=[...this.options.onBeforeEach?[this.options.onBeforeEach]:[],...t&&t.matched.beforeLeave?[t.matched.beforeLeave]:[],...r.beforeEnter?[r.beforeEnter]:[]];for(const r of n){const n=await r(e,t);if(!1===n)return!1;if("string"==typeof n||"object"==typeof n)return this.navigate(n),!1}return!0}_resolveStringComponent(e){const t=this.eleva._components.get(e);return t||this.errorHandler.handle(new Error(`Component "${e}" not registered.`),"Component resolution failed",{componentName:e,availableComponents:Array.from(this.eleva._components.keys())}),t}async _resolveFunctionComponent(e){try{const t=e.toString(),r=t.includes("import(")||t.startsWith("() =>"),n=await e();return r&&n.default||n}catch(t){this.errorHandler.handle(new Error(`Failed to load async component: ${t.message}`),"Component resolution failed",{function:e.toString(),error:t})}}_validateComponentDefinition(e){return e&&"object"==typeof e||this.errorHandler.handle(new Error("Invalid component definition: "+typeof e),"Component validation failed",{definition:e}),"function"!=typeof e.template&&"string"!=typeof e.template&&this.errorHandler.handle(new Error("Component missing template property"),"Component validation failed",{definition:e}),e}async _resolveComponent(e){return null==e?null:"string"==typeof e?this._resolveStringComponent(e):"function"==typeof e?await this._resolveFunctionComponent(e):e&&"object"==typeof e?this._validateComponentDefinition(e):void this.errorHandler.handle(new Error("Invalid component definition: "+typeof e),"Component resolution failed",{definition:e})}async _resolveComponents(e){const t=e.layout||this.options.globalLayout;try{const[r,n]=await Promise.all([this._resolveComponent(t),this._resolveComponent(e.component)]);return n||this.errorHandler.handle(new Error(`Page component is null or undefined for route: ${e.path}`),"Component resolution failed",{route:e.path}),{layoutComponent:r,pageComponent:n}}catch(t){throw this.errorHandler.log(`Error resolving components for route ${e.path}`,t,{route:e.path}),t}}async _render(e,t){const r=document.querySelector(this.options.mount);if(r||this.errorHandler.handle(new Error(`Mount element "${this.options.mount}" not found.`),{mountSelector:this.options.mount}),e){const n=await this.eleva.mount(r,this._wrapComponentWithChildren(e));this.currentLayout.value=n;const o=this._findViewElement(n.container),i=await this.eleva.mount(o,this._wrapComponentWithChildren(t));this.currentView.value=i}else{const e=await this.eleva.mount(r,this._wrapComponentWithChildren(t));this.currentView.value=e,this.currentLayout.value=null}}_createRouteGetter(e,t){return()=>this.currentRoute.value?.[e]??t}_wrapComponent(e){const t=e.setup,r=this;return{...e,setup:async e=>(e.router={navigate:r.navigate.bind(r),current:r.currentRoute,previous:r.previousRoute,get params(){return r._createRouteGetter("params",{})()},get query(){return r._createRouteGetter("query",{})()},get path(){return r._createRouteGetter("path","/")()},get fullUrl(){return r._createRouteGetter("fullUrl",window.location.href)()},get meta(){return r._createRouteGetter("meta",{})()}},t?await t(e):{})}}_wrapComponentWithChildren(e){const t=this._wrapComponent(e);if(t.children&&"object"==typeof t.children){const e={};for(const[r,n]of Object.entries(t.children))e[r]=this._wrapComponentWithChildren(n);t.children=e}return t}_getCurrentLocation(){if("undefined"==typeof window)return{path:"/",query:{},fullUrl:""};let e,t,r;switch(this.options.mode){case"hash":r=window.location.hash.slice(1)||"/",[e,t]=r.split("?");break;case"query":e=new URLSearchParams(window.location.search).get(this.options.queryParam)||"/",t=window.location.search.slice(1),r=e;break;default:e=window.location.pathname||"/",t=window.location.search.slice(1),r=`${e}${t?"?"+t:""}`}return{path:e.startsWith("/")?e:`/${e}`,query:this._parseQuery(t),fullUrl:r}}_parseQuery(e){const t={};return e&&new URLSearchParams(e).forEach((e,r)=>{t[r]=e}),t}_matchRoute(e){const t=e.split("/").filter(Boolean);for(const e of this.routes){if("/"===e.path){if(0===t.length)return{route:e,params:{}};continue}if(e.segments.length!==t.length)continue;const r={};let n=!0;for(let o=0;o<e.segments.length;o++){const i=e.segments[o],a=t[o];if("param"===i.type)r[i.name]=decodeURIComponent(a);else if(i.value!==a){n=!1;break}}if(n)return{route:e,params:r}}return null}onBeforeEach(e){this.options.onBeforeEach=e}onAfterEnter(e){this.emitter.on("router:afterEnter",e)}onAfterLeave(e){this.emitter.on("router:afterLeave",e)}onAfterEach(e){this.emitter.on("router:afterEach",e)}onError(e){this.emitter.on("router:onError",e)}use(e,t={}){"function"!=typeof e.install&&this.errorHandler.handle(new Error("Plugin must have an install method"),"Plugin registration failed",{plugin:e}),this.plugins.has(e.name)?this.errorHandler.warn(`Plugin "${e.name}" is already registered`,{existingPlugin:this.plugins.get(e.name)}):(this.plugins.set(e.name,e),e.install(this,t))}getPlugins(){return Array.from(this.plugins.values())}getPlugin(e){return this.plugins.get(e)}removePlugin(e){const t=this.plugins.get(e);if(!t)return!1;if("function"==typeof t.destroy)try{t.destroy(this)}catch(t){this.errorHandler.log(`Plugin ${e} destroy failed`,t)}return this.plugins.delete(e)}setErrorHandler(e){e&&"function"==typeof e.handle&&"function"==typeof e.warn&&"function"==typeof e.log&&(this.errorHandler=e)}}const i={name:"router",version:"1.0.0-rc.1",description:"Client-side routing for Eleva applications",install(e,t={}){if(!t.mount)throw new Error("[RouterPlugin] 'mount' option is required");if(!t.routes||!Array.isArray(t.routes))throw new Error("[RouterPlugin] 'routes' option must be an array");const r=(t,r)=>{if(!t)return null;if("object"==typeof t&&null!==t&&!t.name){const n=`Eleva${r}Component_${Math.random().toString(36).slice(2,11)}`;try{return e.component(n,t),n}catch(e){throw new Error(`[RouterPlugin] Failed to register ${r} component: ${e.message}`)}}return t};t.globalLayout&&(t.globalLayout=r(t.globalLayout,"GlobalLayout")),(t.routes||[]).forEach(e=>{e.component=r(e.component,"Route"),e.layout&&(e.layout=r(e.layout,"RouteLayout"))});const n=new o(e,t);return e.router=n,!1!==t.autoStart&&queueMicrotask(()=>n.start()),e.plugins||(e.plugins=new Map),e.plugins.set(this.name,{name:this.name,version:this.version,description:this.description,options:t}),e.navigate=n.navigate.bind(n),e.getCurrentRoute=()=>n.currentRoute.value,e.getRouteParams=()=>n.currentParams.value,e.getRouteQuery=()=>n.currentQuery.value,n},async uninstall(e){e.router&&(await e.router.destroy(),delete e.router),e.plugins&&e.plugins.delete(this.name),delete e.navigate,delete e.getCurrentRoute,delete e.getRouteParams,delete e.getRouteQuery}},a={name:"props",version:"1.0.0-rc.1",description:"Advanced props data handling for complex data structures with automatic type detection and reactivity",install(e,t={}){const{enableAutoParsing:r=!0,enableReactivity:n=!0,onError:o=null}=t,i=e=>{try{if("string"!=typeof e)return e;if("true"===e)return!0;if("false"===e)return!1;if("null"===e)return null;if("undefined"===e)return;if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch(t){throw new Error(`Invalid JSON: ${e}`)}if("1"===e)return!0;if("0"===e)return!1;if(""===e)return!0;if(!isNaN(e)&&""!==e&&!isNaN(parseFloat(e)))return Number(e);if(e.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)){const t=new Date(e);if(!isNaN(t.getTime()))return t}return e}catch(t){return o&&o(t,e),e}};e._extractProps=e=>{const t={},n=e.attributes;for(let o=n.length-1;o>=0;o--){const a=n[o];if(a.name.startsWith(":")){const n=a.name.slice(1),o=r?i(a.value):a.value;t[n]=o,e.removeAttribute(a.name)}}return t};const a=e.mount;e.mount=async(t,r,o={})=>{const i=n?(t=>{const r={};return Object.entries(t).forEach(([t,n])=>{r[t]=n&&"object"==typeof n&&"value"in n&&"watch"in n?n:new e.signal(n)}),r})(o):o;return await a.call(e,t,r,i)},e.props={parse:e=>r?i(e):e,detectType:e=>null===e?"null":void 0===e?"undefined":"boolean"==typeof e?"boolean":"number"==typeof e?"number":"string"==typeof e?"string":"function"==typeof e?"function":e instanceof Date?"date":e instanceof Map?"map":e instanceof Set?"set":Array.isArray(e)?"array":"object"==typeof e?"object":"unknown"},e._originalExtractProps=e._extractProps,e._originalMount=a},uninstall(e){e._originalExtractProps&&(e._extractProps=e._originalExtractProps,delete e._originalExtractProps),e._originalMount&&(e.mount=e._originalMount,delete e._originalMount),e.props&&delete e.props}};e.Attr=r,e.Props=a,e.Router=i},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ElevaPlugins={});
//# sourceMappingURL=eleva-plugins.umd.min.js.map
