var t,e;t=this,e=function(t){"use strict";let e={name:"store",version:"1.0.0-rc.12",description:"Reactive state management for sharing data across the entire Eleva application",install(t,e={}){let{state:s={},actions:i={},namespaces:r={},persistence:a={},devTools:o=!1,onError:n=null}=e,l=new class{_initializeState(e,s){Object.entries(e).forEach(([e,s])=>{this.state[e]=new t.signal(s)}),this.actions={...s}}_initializeNamespaces(e){Object.entries(e).forEach(([e,s])=>{let{state:i={},actions:r={}}=s;this.state[e]||(this.state[e]={}),this.actions[e]||(this.actions[e]={}),Object.entries(i).forEach(([s,i])=>{this.state[e][s]=new t.signal(i)}),this.actions[e]={...r}})}_loadPersistedState(){if(this.persistence.enabled&&"u">typeof window)try{let t=window[this.persistence.storage].getItem(this.persistence.key);if(t){let e=JSON.parse(t);this._applyPersistedData(e)}}catch(t){this.onError&&this.onError(t,"Failed to load persisted state")}}_applyPersistedData(t,e=this.state,s=""){Object.entries(t).forEach(([t,i])=>{let r=s?`${s}.${t}`:t;this._shouldPersist(r)&&(e[t]&&"object"==typeof e[t]&&"value"in e[t]?e[t].value=i:"object"==typeof i&&null!==i&&e[t]&&this._applyPersistedData(i,e[t],r))})}_shouldPersist(t){let{include:e,exclude:s}=this.persistence;return e&&e.length>0?e.some(e=>t.startsWith(e)):!s||!(s.length>0)||!s.some(e=>t.startsWith(e))}_saveState(){if(this.persistence.enabled&&"u">typeof window)try{let t=window[this.persistence.storage],e=this._extractPersistedData();t.setItem(this.persistence.key,JSON.stringify(e))}catch(t){this.onError&&this.onError(t,"Failed to save state")}}_extractPersistedData(t=this.state,e=""){let s={};return Object.entries(t).forEach(([t,i])=>{let r=e?`${e}.${t}`:t;if(this._shouldPersist(r)){if(i&&"object"==typeof i&&"value"in i)s[t]=i.value;else if("object"==typeof i&&null!==i){let e=this._extractPersistedData(i,r);Object.keys(e).length>0&&(s[t]=e)}}}),s}_setupDevTools(){this.devTools&&"u">typeof window&&window.__ELEVA_DEVTOOLS__&&window.__ELEVA_DEVTOOLS__.registerStore(this)}async dispatch(t,e){try{let s=this._getAction(t);if(!s){let e=Error(`Action "${t}" not found`);throw this.onError&&this.onError(e,t),e}let i={type:t,payload:e,timestamp:Date.now()};this.mutations.push(i),this.mutations.length>100&&this.mutations.shift();let r=await s.call(null,this.state,e);return this._saveState(),this.subscribers.forEach(t=>{try{t(i,this.state)}catch(t){this.onError&&this.onError(t,"Subscriber callback failed")}}),this.devTools&&"u">typeof window&&window.__ELEVA_DEVTOOLS__&&window.__ELEVA_DEVTOOLS__.notifyMutation(i,this.state),r}catch(e){throw this.onError&&this.onError(e,`Action dispatch failed: ${t}`),e}}_getAction(t){let e=t.split("."),s=this.actions;for(let t of e){if(void 0===s[t])return null;s=s[t]}return"function"==typeof s?s:null}subscribe(t){if("function"!=typeof t)throw Error("Subscribe callback must be a function");return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}getState(){return this._extractPersistedData()}replaceState(t){this._applyPersistedData(t),this._saveState()}clearPersistedState(){if(this.persistence.enabled&&"u">typeof window)try{window[this.persistence.storage].removeItem(this.persistence.key)}catch(t){this.onError&&this.onError(t,"Failed to clear persisted state")}}registerModule(t,e){this.state[t]||this.actions[t]||(this.state[t]={},this.actions[t]={},this._initializeNamespaces({[t]:e}),this._saveState())}unregisterModule(t){(this.state[t]||this.actions[t])&&(delete this.state[t],delete this.actions[t],this._saveState())}createState(e,s){return this.state[e]||(this.state[e]=new t.signal(s),this._saveState()),this.state[e]}createAction(t,e){if("function"!=typeof e)throw Error("Action must be a function");this.actions[t]=e}constructor(){this.state={},this.actions={},this.subscribers=new Set,this.mutations=[],this.persistence={enabled:!1,key:"eleva-store",storage:"localStorage",include:null,exclude:null,...a},this.devTools=o,this.onError=n,this._initializeState(s,i),this._initializeNamespaces(r),this._loadPersistedState(),this._setupDevTools()}},c=t.mount;t.mount=async(e,s,i={})=>{let r="string"==typeof s&&t._components.get(s)||s;if(!r)return await c.call(t,e,s,i);let a={...r,async setup(e){e.store={state:l.state,dispatch:l.dispatch.bind(l),subscribe:l.subscribe.bind(l),getState:l.getState.bind(l),registerModule:l.registerModule.bind(l),unregisterModule:l.unregisterModule.bind(l),createState:l.createState.bind(l),createAction:l.createAction.bind(l),signal:t.signal};let s=r.setup;return s?await s(e):{}}};return await c.call(t,e,a,i)};let h=t._mountComponents;t._mountComponents=async(e,s,i)=>{let r={};for(let[e,i]of Object.entries(s)){let s="string"==typeof i&&t._components.get(i)||i;s&&"object"==typeof s?r[e]={...s,async setup(e){e.store={state:l.state,dispatch:l.dispatch.bind(l),subscribe:l.subscribe.bind(l),getState:l.getState.bind(l),registerModule:l.registerModule.bind(l),unregisterModule:l.unregisterModule.bind(l),createState:l.createState.bind(l),createAction:l.createAction.bind(l),signal:t.signal};let i=s.setup;return i?await i(e):{}}}:r[e]=i}return await h.call(t,e,r,i)},t.store=l,t.createAction=(t,e)=>{l.actions[t]=e},t.dispatch=(t,e)=>l.dispatch(t,e),t.getState=()=>l.getState(),t.subscribe=t=>l.subscribe(t),t._originalMount=c,t._originalMountComponents=h},uninstall(t){t._originalMount&&(t.mount=t._originalMount,delete t._originalMount),t._originalMountComponents&&(t._mountComponents=t._originalMountComponents,delete t._originalMountComponents),t.store&&delete t.store,t.createAction&&delete t.createAction,t.dispatch&&delete t.dispatch,t.getState&&delete t.getState,t.subscribe&&delete t.subscribe}};t.Store=e,t.StorePlugin=e},"object"==typeof exports&&"u">typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="u">typeof globalThis?globalThis:t||self).ElevaStorePlugin={});
//# sourceMappingURL=store.umd.min.js.map
