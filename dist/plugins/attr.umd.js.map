{"version":3,"file":"attr.umd.js","sources":["../../src/plugins/Attr.js"],"sourcesContent":["\"use strict\";\n\n/**\n * A regular expression to match hyphenated lowercase letters.\n * @private\n * @type {RegExp}\n */\nconst CAMEL_RE = /-([a-z])/g;\n\n/**\n * @class ðŸŽ¯ AttrPlugin\n * @classdesc A plugin that provides advanced attribute handling for Eleva components.\n * This plugin extends the renderer with sophisticated attribute processing including:\n * - ARIA attribute handling with proper property mapping\n * - Data attribute management\n * - Boolean attribute processing\n * - Dynamic property detection and mapping\n * - Attribute cleanup and removal\n *\n * @example\n * // Install the plugin\n * const app = new Eleva(\"myApp\");\n * app.use(AttrPlugin);\n *\n * // Use advanced attributes in components\n * app.component(\"myComponent\", {\n *   template: (ctx) => `\n *     <button\n *       aria-expanded=\"${ctx.isExpanded.value}\"\n *       data-user-id=\"${ctx.userId.value}\"\n *       disabled=\"${ctx.isLoading.value}\"\n *       class=\"btn ${ctx.variant.value}\"\n *     >\n *       ${ctx.text.value}\n *     </button>\n *   `\n * });\n */\nexport const AttrPlugin = {\n  /**\n   * Unique identifier for the plugin\n   * @type {string}\n   */\n  name: \"attr\",\n\n  /**\n   * Plugin version\n   * @type {string}\n   */\n  version: \"1.0.0\",\n\n  /**\n   * Plugin description\n   * @type {string}\n   */\n  description: \"Advanced attribute handling for Eleva components\",\n\n  /**\n   * Installs the plugin into the Eleva instance\n   *\n   * @param {Object} eleva - The Eleva instance\n   * @param {Object} options - Plugin configuration options\n   * @param {boolean} [options.enableAria=true] - Enable ARIA attribute handling\n   * @param {boolean} [options.enableData=true] - Enable data attribute handling\n   * @param {boolean} [options.enableBoolean=true] - Enable boolean attribute handling\n   * @param {boolean} [options.enableDynamic=true] - Enable dynamic property detection\n   */\n  install(eleva, options = {}) {\n    const {\n      enableAria = true,\n      enableData = true,\n      enableBoolean = true,\n      enableDynamic = true,\n    } = options;\n\n    /**\n     * Updates the attributes of an element to match a new element's attributes.\n     * This method provides sophisticated attribute processing including:\n     * - ARIA attribute handling with proper property mapping\n     * - Data attribute management\n     * - Boolean attribute processing\n     * - Dynamic property detection and mapping\n     * - Attribute cleanup and removal\n     *\n     * @param {HTMLElement} oldEl - The original element to update\n     * @param {HTMLElement} newEl - The new element to update\n     * @returns {void}\n     */\n    const updateAttributes = (oldEl, newEl) => {\n      const oldAttrs = oldEl.attributes;\n      const newAttrs = newEl.attributes;\n\n      // Process new attributes\n      for (let i = 0; i < newAttrs.length; i++) {\n        const { name, value } = newAttrs[i];\n\n        // Skip event attributes (handled by event system)\n        if (name.startsWith(\"@\")) continue;\n\n        // Skip if attribute hasn't changed\n        if (oldEl.getAttribute(name) === value) continue;\n\n        // Handle ARIA attributes\n        if (enableAria && name.startsWith(\"aria-\")) {\n          const prop =\n            \"aria\" + name.slice(5).replace(CAMEL_RE, (_, l) => l.toUpperCase());\n          oldEl[prop] = value;\n          oldEl.setAttribute(name, value);\n        }\n        // Handle data attributes\n        else if (enableData && name.startsWith(\"data-\")) {\n          oldEl.dataset[name.slice(5)] = value;\n          oldEl.setAttribute(name, value);\n        }\n        // Handle other attributes\n        else {\n          let prop = name.replace(CAMEL_RE, (_, l) => l.toUpperCase());\n\n          // Dynamic property detection\n          if (\n            enableDynamic &&\n            !(prop in oldEl) &&\n            !Object.getOwnPropertyDescriptor(Object.getPrototypeOf(oldEl), prop)\n          ) {\n            const elementProps = Object.getOwnPropertyNames(\n              Object.getPrototypeOf(oldEl)\n            );\n            const matchingProp = elementProps.find(\n              (p) =>\n                p.toLowerCase() === name.toLowerCase() ||\n                p.toLowerCase().includes(name.toLowerCase()) ||\n                name.toLowerCase().includes(p.toLowerCase())\n            );\n\n            if (matchingProp) {\n              prop = matchingProp;\n            }\n          }\n\n          const descriptor = Object.getOwnPropertyDescriptor(\n            Object.getPrototypeOf(oldEl),\n            prop\n          );\n          const hasProperty = prop in oldEl || descriptor;\n\n          if (hasProperty) {\n            // Boolean attribute handling\n            if (enableBoolean) {\n              const isBoolean =\n                typeof oldEl[prop] === \"boolean\" ||\n                (descriptor?.get &&\n                  typeof descriptor.get.call(oldEl) === \"boolean\");\n\n              if (isBoolean) {\n                const boolValue =\n                  value !== \"false\" &&\n                  (value === \"\" || value === prop || value === \"true\");\n                oldEl[prop] = boolValue;\n\n                if (boolValue) {\n                  oldEl.setAttribute(name, \"\");\n                } else {\n                  oldEl.removeAttribute(name);\n                }\n              } else {\n                oldEl[prop] = value;\n                oldEl.setAttribute(name, value);\n              }\n            } else {\n              oldEl[prop] = value;\n              oldEl.setAttribute(name, value);\n            }\n          } else {\n            oldEl.setAttribute(name, value);\n          }\n        }\n      }\n\n      // Remove old attributes that are no longer present\n      for (let i = oldAttrs.length - 1; i >= 0; i--) {\n        const name = oldAttrs[i].name;\n        if (!newEl.hasAttribute(name)) {\n          oldEl.removeAttribute(name);\n        }\n      }\n    };\n\n    // Extend the renderer with the advanced attribute handler\n    if (eleva.renderer) {\n      eleva.renderer.updateAttributes = updateAttributes;\n\n      // Store the original _patchNode method\n      const originalPatchNode = eleva.renderer._patchNode;\n      eleva.renderer._originalPatchNode = originalPatchNode;\n\n      // Override the _patchNode method to use our attribute handler\n      eleva.renderer._patchNode = function (oldNode, newNode) {\n        if (oldNode?._eleva_instance) return;\n\n        if (oldNode.nodeType === Node.TEXT_NODE) {\n          if (oldNode.nodeValue !== newNode.nodeValue) {\n            oldNode.nodeValue = newNode.nodeValue;\n          }\n        } else if (oldNode.nodeType === Node.ELEMENT_NODE) {\n          // Use advanced attribute handler instead of basic _updateAttributes\n          updateAttributes(oldNode, newNode);\n          this._diff(oldNode, newNode);\n        }\n      };\n    }\n\n    // Add plugin metadata to the Eleva instance\n    if (!eleva.plugins) {\n      eleva.plugins = new Map();\n    }\n    eleva.plugins.set(this.name, {\n      name: this.name,\n      version: this.version,\n      description: this.description,\n      options,\n    });\n\n    // Add utility methods for manual attribute updates\n    eleva.updateElementAttributes = updateAttributes;\n  },\n\n  /**\n   * Uninstalls the plugin from the Eleva instance\n   *\n   * @param {Object} eleva - The Eleva instance\n   */\n  uninstall(eleva) {\n    // Restore original _patchNode method if it exists\n    if (eleva.renderer && eleva.renderer._originalPatchNode) {\n      eleva.renderer._patchNode = eleva.renderer._originalPatchNode;\n      delete eleva.renderer._originalPatchNode;\n    }\n\n    // Remove plugin metadata\n    if (eleva.plugins) {\n      eleva.plugins.delete(this.name);\n    }\n\n    // Remove utility methods\n    delete eleva.updateElementAttributes;\n  },\n};\n\n// Short name export for convenience\nexport { AttrPlugin as Attr };\n"],"names":["CAMEL_RE","AttrPlugin","name","version","description","install","eleva","options","enableAria","enableData","enableBoolean","enableDynamic","updateAttributes","oldEl","newEl","oldAttrs","attributes","newAttrs","i","length","value","startsWith","getAttribute","prop","slice","replace","_","l","toUpperCase","setAttribute","dataset","Object","getOwnPropertyDescriptor","getPrototypeOf","elementProps","getOwnPropertyNames","matchingProp","find","p","toLowerCase","includes","descriptor","hasProperty","isBoolean","get","call","boolValue","removeAttribute","hasAttribute","renderer","originalPatchNode","_patchNode","_originalPatchNode","oldNode","newNode","_eleva_instance","nodeType","Node","TEXT_NODE","nodeValue","ELEMENT_NODE","_diff","plugins","Map","set","updateElementAttributes","uninstall","delete"],"mappings":"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"}