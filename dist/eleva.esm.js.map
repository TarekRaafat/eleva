{"version":3,"file":"eleva.esm.js","sources":["../src/modules/TemplateEngine.js","../src/modules/Signal.js","../src/modules/Emitter.js","../src/modules/Renderer.js","../src/core/Eleva.js"],"sourcesContent":["\"use strict\";\n\n/**\n * üîí TemplateEngine: Secure interpolation & dynamic attribute parsing.\n *\n * This class provides methods to parse template strings by replacing\n * interpolation expressions with dynamic data values and to evaluate expressions\n * within a given data context.\n */\nexport class TemplateEngine {\n  /**\n   * Parses a template string and replaces interpolation expressions with corresponding values.\n   *\n   * @param {string} template - The template string containing expressions in the format {{ expression }}.\n   * @param {object} data - The data object to use for evaluating expressions.\n   * @returns {string} The resulting string with evaluated values.\n   */\n  static parse(template, data) {\n    return template.replace(/\\{\\{\\s*(.*?)\\s*\\}\\}/g, (_, expr) => {\n      const value = this.evaluate(expr, data);\n      return value === undefined ? \"\" : value;\n    });\n  }\n\n  /**\n   * Evaluates an expression using the provided data context.\n   *\n   * @param {string} expr - The JavaScript expression to evaluate.\n   * @param {object} data - The data context for evaluating the expression.\n   * @returns {*} The result of the evaluated expression, or an empty string if undefined or on error.\n   */\n  static evaluate(expr, data) {\n    try {\n      const keys = Object.keys(data);\n      const values = keys.map((k) => data[k]);\n      const result = new Function(...keys, `return ${expr}`)(...values);\n      return result === undefined ? \"\" : result;\n    } catch (error) {\n      console.error(`Template evaluation error:`, {\n        expression: expr,\n        data,\n        error: error.message,\n      });\n      return \"\";\n    }\n  }\n}\n","\"use strict\";\n\n/**\n * ‚ö° Signal: Fine-grained reactivity.\n *\n * A reactive data holder that notifies registered watchers when its value changes,\n * allowing for fine-grained DOM patching rather than full re-renders.\n */\nexport class Signal {\n  /**\n   * Creates a new Signal instance.\n   *\n   * @param {*} value - The initial value of the signal.\n   */\n  constructor(value) {\n    this._value = value;\n    this._watchers = new Set();\n  }\n\n  /**\n   * Gets the current value of the signal.\n   *\n   * @returns {*} The current value.\n   */\n  get value() {\n    return this._value;\n  }\n\n  /**\n   * Sets a new value for the signal and notifies all registered watchers if the value has changed.\n   *\n   * @param {*} newVal - The new value to set.\n   */\n  set value(newVal) {\n    if (newVal !== this._value) {\n      this._value = newVal;\n      this._watchers.forEach((fn) => fn(newVal));\n    }\n  }\n\n  /**\n   * Registers a watcher function that will be called whenever the signal's value changes.\n   *\n   * @param {Function} fn - The callback function to invoke on value change.\n   * @returns {Function} A function to unsubscribe the watcher.\n   */\n  watch(fn) {\n    this._watchers.add(fn);\n    return () => this._watchers.delete(fn);\n  }\n}\n","\"use strict\";\n\n/**\n * üéôÔ∏è Emitter: Robust inter-component communication with event bubbling.\n *\n * Implements a basic publish-subscribe pattern for event handling,\n * allowing components to communicate through custom events.\n */\nexport class Emitter {\n  /**\n   * Creates a new Emitter instance.\n   */\n  constructor() {\n    /** @type {Object.<string, Function[]>} */\n    this.events = {};\n  }\n\n  /**\n   * Registers an event handler for the specified event.\n   *\n   * @param {string} event - The name of the event.\n   * @param {Function} handler - The function to call when the event is emitted.\n   */\n  on(event, handler) {\n    (this.events[event] || (this.events[event] = [])).push(handler);\n  }\n\n  /**\n   * Removes a previously registered event handler.\n   *\n   * @param {string} event - The name of the event.\n   * @param {Function} handler - The handler function to remove.\n   */\n  off(event, handler) {\n    if (this.events[event]) {\n      this.events[event] = this.events[event].filter((h) => h !== handler);\n    }\n  }\n\n  /**\n   * Emits an event, invoking all handlers registered for that event.\n   *\n   * @param {string} event - The event name.\n   * @param {...*} args - Additional arguments to pass to the event handlers.\n   */\n  emit(event, ...args) {\n    (this.events[event] || []).forEach((handler) => handler(...args));\n  }\n}\n","\"use strict\";\n\n/**\n * üé® Renderer: Handles DOM patching, diffing, and attribute updates.\n *\n * Provides methods for efficient DOM updates by diffing the new and old DOM structures\n * and applying only the necessary changes.\n */\nexport class Renderer {\n  /**\n   * Patches the DOM of a container element with new HTML content.\n   *\n   * @param {HTMLElement} container - The container element to patch.\n   * @param {string} newHtml - The new HTML content to apply.\n   */\n  patchDOM(container, newHtml) {\n    const tempContainer = document.createElement(\"div\");\n    tempContainer.innerHTML = newHtml;\n    this.diff(container, tempContainer);\n  }\n\n  /**\n   * Diffs two DOM trees (old and new) and applies updates to the old DOM.\n   *\n   * @param {HTMLElement} oldParent - The original DOM element.\n   * @param {HTMLElement} newParent - The new DOM element.\n   */\n  diff(oldParent, newParent) {\n    const oldNodes = Array.from(oldParent.childNodes);\n    const newNodes = Array.from(newParent.childNodes);\n    const max = Math.max(oldNodes.length, newNodes.length);\n    for (let i = 0; i < max; i++) {\n      const oldNode = oldNodes[i];\n      const newNode = newNodes[i];\n\n      // Append new nodes that don't exist in the old tree.\n      if (!oldNode && newNode) {\n        oldParent.appendChild(newNode.cloneNode(true));\n        continue;\n      }\n      // Remove old nodes not present in the new tree.\n      if (oldNode && !newNode) {\n        oldParent.removeChild(oldNode);\n        continue;\n      }\n\n      // For element nodes, compare keys if available.\n      if (\n        oldNode.nodeType === Node.ELEMENT_NODE &&\n        newNode.nodeType === Node.ELEMENT_NODE\n      ) {\n        const oldKey = oldNode.getAttribute(\"key\");\n        const newKey = newNode.getAttribute(\"key\");\n        if (oldKey || newKey) {\n          if (oldKey !== newKey) {\n            oldParent.replaceChild(newNode.cloneNode(true), oldNode);\n            continue;\n          }\n        }\n      }\n\n      // Replace nodes if types or tag names differ.\n      if (\n        oldNode.nodeType !== newNode.nodeType ||\n        oldNode.nodeName !== newNode.nodeName\n      ) {\n        oldParent.replaceChild(newNode.cloneNode(true), oldNode);\n        continue;\n      }\n      // For text nodes, update content if different.\n      if (oldNode.nodeType === Node.TEXT_NODE) {\n        if (oldNode.nodeValue !== newNode.nodeValue) {\n          oldNode.nodeValue = newNode.nodeValue;\n        }\n        continue;\n      }\n      // For element nodes, update attributes and then diff children.\n      if (oldNode.nodeType === Node.ELEMENT_NODE) {\n        this.updateAttributes(oldNode, newNode);\n        this.diff(oldNode, newNode);\n      }\n    }\n  }\n\n  /**\n   * Updates the attributes of an element to match those of a new element.\n   *\n   * @param {HTMLElement} oldEl - The element to update.\n   * @param {HTMLElement} newEl - The element providing the updated attributes.\n   */\n  updateAttributes(oldEl, newEl) {\n    const attributeToPropertyMap = {\n      value: \"value\",\n      checked: \"checked\",\n      selected: \"selected\",\n      disabled: \"disabled\",\n    };\n\n    // Remove old attributes that no longer exist.\n    Array.from(oldEl.attributes).forEach((attr) => {\n      if (attr.name.startsWith(\"@\")) return;\n      if (!newEl.hasAttribute(attr.name)) {\n        oldEl.removeAttribute(attr.name);\n      }\n    });\n    // Add or update attributes from newEl.\n    Array.from(newEl.attributes).forEach((attr) => {\n      if (attr.name.startsWith(\"@\")) return;\n      if (oldEl.getAttribute(attr.name) !== attr.value) {\n        oldEl.setAttribute(attr.name, attr.value);\n        if (attributeToPropertyMap[attr.name]) {\n          oldEl[attributeToPropertyMap[attr.name]] = attr.value;\n        } else if (attr.name in oldEl) {\n          oldEl[attr.name] = attr.value;\n        }\n      }\n    });\n  }\n}\n","\"use strict\";\n\nimport { TemplateEngine } from \"../modules/TemplateEngine.js\";\nimport { Signal } from \"../modules/Signal.js\";\nimport { Emitter } from \"../modules/Emitter.js\";\nimport { Renderer } from \"../modules/Renderer.js\";\n\n/**\n * üß© Eleva Core: Signal-based component runtime framework with lifecycle, scoped styles, and plugins.\n *\n * The Eleva class is the core of the framework. It manages component registration,\n * plugin integration, lifecycle hooks, event handling, and DOM rendering.\n */\nexport class Eleva {\n  /**\n   * Creates a new Eleva instance.\n   *\n   * @param {string} name - The name of the Eleva instance.\n   * @param {object} [config={}] - Optional configuration for the instance.\n   */\n  constructor(name, config = {}) {\n    this.name = name;\n    this.config = config;\n    this._components = {};\n    this._plugins = [];\n    this._lifecycleHooks = [\n      \"onBeforeMount\",\n      \"onMount\",\n      \"onBeforeUpdate\",\n      \"onUpdate\",\n      \"onUnmount\",\n    ];\n    this._isMounted = false;\n    this.emitter = new Emitter();\n    this.renderer = new Renderer();\n  }\n\n  /**\n   * Integrates a plugin with the Eleva framework.\n   *\n   * @param {object} [plugin] - The plugin object which should have an install function.\n   * @param {object} [options={}] - Optional options to pass to the plugin.\n   * @returns {Eleva} The Eleva instance (for chaining).\n   */\n  use(plugin, options = {}) {\n    if (typeof plugin.install === \"function\") {\n      plugin.install(this, options);\n    }\n    this._plugins.push(plugin);\n    return this;\n  }\n\n  /**\n   * Registers a component with the Eleva instance.\n   *\n   * @param {string} name - The name of the component.\n   * @param {object} definition - The component definition including setup, template, style, and children.\n   * @returns {Eleva} The Eleva instance (for chaining).\n   */\n  component(name, definition) {\n    this._components[name] = definition;\n    return this;\n  }\n\n  /**\n   * Mounts a registered component to a DOM element.\n   *\n   * @param {string|HTMLElement} selectorOrElement - A CSS selector string or DOM element where the component will be mounted.\n   * @param {string} compName - The name of the component to mount.\n   * @param {object} [props={}] - Optional properties to pass to the component.\n   * @returns {object|Promise<object>} An object representing the mounted component instance, or a Promise that resolves to it for asynchronous setups.\n   * @throws Will throw an error if the container or component is not found.\n   */\n  mount(selectorOrElement, compName, props = {}) {\n    const container =\n      typeof selectorOrElement === \"string\"\n        ? document.querySelector(selectorOrElement)\n        : selectorOrElement;\n    if (!container)\n      throw new Error(`Container not found: ${selectorOrElement}`);\n\n    const definition = this._components[compName];\n    if (!definition) throw new Error(`Component \"${compName}\" not registered.`);\n\n    const { setup, template, style, children } = definition;\n    const context = {\n      props,\n      emit: this.emitter.emit.bind(this.emitter),\n      on: this.emitter.on.bind(this.emitter),\n      signal: (v) => new Signal(v),\n      ...this._prepareLifecycleHooks(),\n    };\n\n    /**\n     * Processes the mounting of the component.\n     *\n     * @param {object} data - Data returned from the component's setup function.\n     * @returns {object} An object with the container, merged context data, and an unmount function.\n     */\n    const processMount = (data) => {\n      const mergedContext = { ...context, ...data };\n      const watcherUnsubscribers = [];\n      const childInstances = [];\n\n      if (!this._isMounted) {\n        mergedContext.onBeforeMount && mergedContext.onBeforeMount();\n      } else {\n        mergedContext.onBeforeUpdate && mergedContext.onBeforeUpdate();\n      }\n\n      /**\n       * Renders the component by parsing the template, patching the DOM,\n       * processing events, injecting styles, and mounting child components.\n       */\n      const render = () => {\n        const newHtml = TemplateEngine.parse(\n          template(mergedContext),\n          mergedContext\n        );\n        this.renderer.patchDOM(container, newHtml);\n        this._processEvents(container, mergedContext);\n        this._injectStyles(container, compName, style, mergedContext);\n        this._mountChildren(container, children, childInstances);\n        if (!this._isMounted) {\n          mergedContext.onMount && mergedContext.onMount();\n          this._isMounted = true;\n        } else {\n          mergedContext.onUpdate && mergedContext.onUpdate();\n        }\n      };\n\n      Object.values(data).forEach((val) => {\n        if (val instanceof Signal) watcherUnsubscribers.push(val.watch(render));\n      });\n\n      render();\n\n      return {\n        container,\n        data: mergedContext,\n        /**\n         * Unmounts the component, cleaning up watchers, child components, and clearing the container.\n         */\n        unmount: () => {\n          watcherUnsubscribers.forEach((fn) => fn());\n          childInstances.forEach((child) => child.unmount());\n          mergedContext.onUnmount && mergedContext.onUnmount();\n          container.innerHTML = \"\";\n        },\n      };\n    };\n\n    // Handle asynchronous setup if needed.\n    const setupResult = setup(context);\n    if (setupResult && typeof setupResult.then === \"function\") {\n      return setupResult.then((data) => processMount(data));\n    } else {\n      const data = setupResult || {};\n      return processMount(data);\n    }\n  }\n\n  /**\n   * Prepares default no-operation lifecycle hook functions.\n   *\n   * @returns {object} An object with keys for lifecycle hooks mapped to empty functions.\n   * @private\n   */\n  _prepareLifecycleHooks() {\n    return this._lifecycleHooks.reduce((acc, hook) => {\n      acc[hook] = () => {};\n      return acc;\n    }, {});\n  }\n\n  /**\n   * Processes DOM elements for event binding based on attributes starting with \"@\".\n   *\n   * @param {HTMLElement} container - The container element in which to search for events.\n   * @param {object} context - The current context containing event handler definitions.\n   * @private\n   */\n  _processEvents(container, context) {\n    container.querySelectorAll(\"*\").forEach((el) => {\n      [...el.attributes].forEach(({ name, value }) => {\n        if (name.startsWith(\"@\")) {\n          const event = name.slice(1);\n          const handler = TemplateEngine.evaluate(value, context);\n          if (typeof handler === \"function\") {\n            el.addEventListener(event, handler);\n            el.removeAttribute(name);\n          }\n        }\n      });\n    });\n  }\n\n  /**\n   * Injects scoped styles into the component's container.\n   *\n   * @param {HTMLElement} container - The container element.\n   * @param {string} compName - The component name used to identify the style element.\n   * @param {Function} styleFn - A function that returns CSS styles as a string.\n   * @param {object} context - The current context for style interpolation.\n   * @private\n   */\n  _injectStyles(container, compName, styleFn, context) {\n    if (styleFn) {\n      let styleEl = container.querySelector(\n        `style[data-eleva-style=\"${compName}\"]`\n      );\n      if (!styleEl) {\n        styleEl = document.createElement(\"style\");\n        styleEl.setAttribute(\"data-eleva-style\", compName);\n        container.appendChild(styleEl);\n      }\n      styleEl.textContent = TemplateEngine.parse(styleFn(context), context);\n    }\n  }\n\n  /**\n   * Mounts child components within the parent component's container.\n   *\n   * @param {HTMLElement} container - The parent container element.\n   * @param {object} children - An object mapping child component selectors to their definitions.\n   * @param {Array} childInstances - An array to store the mounted child component instances.\n   * @private\n   */\n  _mountChildren(container, children, childInstances) {\n    childInstances.forEach((child) => child.unmount());\n    childInstances.length = 0;\n\n    Object.keys(children || {}).forEach((childName) => {\n      container.querySelectorAll(childName).forEach((childEl) => {\n        const props = {};\n        [...childEl.attributes].forEach(({ name, value }) => {\n          if (name.startsWith(\"eleva-prop-\")) {\n            props[name.slice(\"eleva-prop-\".length)] = value;\n          }\n        });\n        const instance = this.mount(childEl, childName, props);\n        childInstances.push(instance);\n      });\n    });\n  }\n}\n"],"names":["TemplateEngine","parse","template","data","replace","_","expr","value","evaluate","undefined","keys","Object","values","map","k","result","Function","error","console","expression","message","Signal","constructor","_value","_watchers","Set","newVal","forEach","fn","watch","add","delete","Emitter","events","on","event","handler","push","off","filter","h","emit","args","Renderer","patchDOM","container","newHtml","tempContainer","document","createElement","innerHTML","diff","oldParent","newParent","oldNodes","Array","from","childNodes","newNodes","max","Math","length","i","oldNode","newNode","appendChild","cloneNode","removeChild","nodeType","Node","ELEMENT_NODE","oldKey","getAttribute","newKey","replaceChild","nodeName","TEXT_NODE","nodeValue","updateAttributes","oldEl","newEl","attributeToPropertyMap","checked","selected","disabled","attributes","attr","name","startsWith","hasAttribute","removeAttribute","setAttribute","Eleva","config","_components","_plugins","_lifecycleHooks","_isMounted","emitter","renderer","use","plugin","options","install","component","definition","mount","selectorOrElement","compName","props","querySelector","Error","setup","style","children","context","bind","signal","v","_prepareLifecycleHooks","processMount","mergedContext","watcherUnsubscribers","childInstances","onBeforeMount","onBeforeUpdate","render","_processEvents","_injectStyles","_mountChildren","onMount","onUpdate","val","unmount","child","onUnmount","setupResult","then","reduce","acc","hook","querySelectorAll","el","slice","addEventListener","styleFn","styleEl","textContent","childName","childEl","instance"],"mappings":"AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMA,cAAc,CAAC;AAC1B;AACF;AACA;AACA;AACA;AACA;AACA;AACE,EAAA,OAAOC,KAAKA,CAACC,QAAQ,EAAEC,IAAI,EAAE;IAC3B,OAAOD,QAAQ,CAACE,OAAO,CAAC,sBAAsB,EAAE,CAACC,CAAC,EAAEC,IAAI,KAAK;MAC3D,MAAMC,KAAK,GAAG,IAAI,CAACC,QAAQ,CAACF,IAAI,EAAEH,IAAI,CAAC;AACvC,MAAA,OAAOI,KAAK,KAAKE,SAAS,GAAG,EAAE,GAAGF,KAAK;AACzC,KAAC,CAAC;AACJ;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACE,EAAA,OAAOC,QAAQA,CAACF,IAAI,EAAEH,IAAI,EAAE;IAC1B,IAAI;AACF,MAAA,MAAMO,IAAI,GAAGC,MAAM,CAACD,IAAI,CAACP,IAAI,CAAC;AAC9B,MAAA,MAAMS,MAAM,GAAGF,IAAI,CAACG,GAAG,CAAEC,CAAC,IAAKX,IAAI,CAACW,CAAC,CAAC,CAAC;AACvC,MAAA,MAAMC,MAAM,GAAG,IAAIC,QAAQ,CAAC,GAAGN,IAAI,EAAE,CAAA,OAAA,EAAUJ,IAAI,CAAE,CAAA,CAAC,CAAC,GAAGM,MAAM,CAAC;AACjE,MAAA,OAAOG,MAAM,KAAKN,SAAS,GAAG,EAAE,GAAGM,MAAM;KAC1C,CAAC,OAAOE,KAAK,EAAE;AACdC,MAAAA,OAAO,CAACD,KAAK,CAAC,CAAA,0BAAA,CAA4B,EAAE;AAC1CE,QAAAA,UAAU,EAAEb,IAAI;QAChBH,IAAI;QACJc,KAAK,EAAEA,KAAK,CAACG;AACf,OAAC,CAAC;AACF,MAAA,OAAO,EAAE;AACX;AACF;AACF;;AC5CA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMC,MAAM,CAAC;AAClB;AACF;AACA;AACA;AACA;EACEC,WAAWA,CAACf,KAAK,EAAE;IACjB,IAAI,CAACgB,MAAM,GAAGhB,KAAK;AACnB,IAAA,IAAI,CAACiB,SAAS,GAAG,IAAIC,GAAG,EAAE;AAC5B;;AAEA;AACF;AACA;AACA;AACA;EACE,IAAIlB,KAAKA,GAAG;IACV,OAAO,IAAI,CAACgB,MAAM;AACpB;;AAEA;AACF;AACA;AACA;AACA;EACE,IAAIhB,KAAKA,CAACmB,MAAM,EAAE;AAChB,IAAA,IAAIA,MAAM,KAAK,IAAI,CAACH,MAAM,EAAE;MAC1B,IAAI,CAACA,MAAM,GAAGG,MAAM;MACpB,IAAI,CAACF,SAAS,CAACG,OAAO,CAAEC,EAAE,IAAKA,EAAE,CAACF,MAAM,CAAC,CAAC;AAC5C;AACF;;AAEA;AACF;AACA;AACA;AACA;AACA;EACEG,KAAKA,CAACD,EAAE,EAAE;AACR,IAAA,IAAI,CAACJ,SAAS,CAACM,GAAG,CAACF,EAAE,CAAC;IACtB,OAAO,MAAM,IAAI,CAACJ,SAAS,CAACO,MAAM,CAACH,EAAE,CAAC;AACxC;AACF;;AChDA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMI,OAAO,CAAC;AACnB;AACF;AACA;AACEV,EAAAA,WAAWA,GAAG;AACZ;AACA,IAAA,IAAI,CAACW,MAAM,GAAG,EAAE;AAClB;;AAEA;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,EAAEA,CAACC,KAAK,EAAEC,OAAO,EAAE;IACjB,CAAC,IAAI,CAACH,MAAM,CAACE,KAAK,CAAC,KAAK,IAAI,CAACF,MAAM,CAACE,KAAK,CAAC,GAAG,EAAE,CAAC,EAAEE,IAAI,CAACD,OAAO,CAAC;AACjE;;AAEA;AACF;AACA;AACA;AACA;AACA;AACEE,EAAAA,GAAGA,CAACH,KAAK,EAAEC,OAAO,EAAE;AAClB,IAAA,IAAI,IAAI,CAACH,MAAM,CAACE,KAAK,CAAC,EAAE;MACtB,IAAI,CAACF,MAAM,CAACE,KAAK,CAAC,GAAG,IAAI,CAACF,MAAM,CAACE,KAAK,CAAC,CAACI,MAAM,CAAEC,CAAC,IAAKA,CAAC,KAAKJ,OAAO,CAAC;AACtE;AACF;;AAEA;AACF;AACA;AACA;AACA;AACA;AACEK,EAAAA,IAAIA,CAACN,KAAK,EAAE,GAAGO,IAAI,EAAE;AACnB,IAAA,CAAC,IAAI,CAACT,MAAM,CAACE,KAAK,CAAC,IAAI,EAAE,EAAER,OAAO,CAAES,OAAO,IAAKA,OAAO,CAAC,GAAGM,IAAI,CAAC,CAAC;AACnE;AACF;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMC,QAAQ,CAAC;AACpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,QAAQA,CAACC,SAAS,EAAEC,OAAO,EAAE;AAC3B,IAAA,MAAMC,aAAa,GAAGC,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC;IACnDF,aAAa,CAACG,SAAS,GAAGJ,OAAO;AACjC,IAAA,IAAI,CAACK,IAAI,CAACN,SAAS,EAAEE,aAAa,CAAC;AACrC;;AAEA;AACF;AACA;AACA;AACA;AACA;AACEI,EAAAA,IAAIA,CAACC,SAAS,EAAEC,SAAS,EAAE;IACzB,MAAMC,QAAQ,GAAGC,KAAK,CAACC,IAAI,CAACJ,SAAS,CAACK,UAAU,CAAC;IACjD,MAAMC,QAAQ,GAAGH,KAAK,CAACC,IAAI,CAACH,SAAS,CAACI,UAAU,CAAC;AACjD,IAAA,MAAME,GAAG,GAAGC,IAAI,CAACD,GAAG,CAACL,QAAQ,CAACO,MAAM,EAAEH,QAAQ,CAACG,MAAM,CAAC;IACtD,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,GAAG,EAAEG,CAAC,EAAE,EAAE;AAC5B,MAAA,MAAMC,OAAO,GAAGT,QAAQ,CAACQ,CAAC,CAAC;AAC3B,MAAA,MAAME,OAAO,GAAGN,QAAQ,CAACI,CAAC,CAAC;;AAE3B;AACA,MAAA,IAAI,CAACC,OAAO,IAAIC,OAAO,EAAE;QACvBZ,SAAS,CAACa,WAAW,CAACD,OAAO,CAACE,SAAS,CAAC,IAAI,CAAC,CAAC;AAC9C,QAAA;AACF;AACA;AACA,MAAA,IAAIH,OAAO,IAAI,CAACC,OAAO,EAAE;AACvBZ,QAAAA,SAAS,CAACe,WAAW,CAACJ,OAAO,CAAC;AAC9B,QAAA;AACF;;AAEA;AACA,MAAA,IACEA,OAAO,CAACK,QAAQ,KAAKC,IAAI,CAACC,YAAY,IACtCN,OAAO,CAACI,QAAQ,KAAKC,IAAI,CAACC,YAAY,EACtC;AACA,QAAA,MAAMC,MAAM,GAAGR,OAAO,CAACS,YAAY,CAAC,KAAK,CAAC;AAC1C,QAAA,MAAMC,MAAM,GAAGT,OAAO,CAACQ,YAAY,CAAC,KAAK,CAAC;QAC1C,IAAID,MAAM,IAAIE,MAAM,EAAE;UACpB,IAAIF,MAAM,KAAKE,MAAM,EAAE;YACrBrB,SAAS,CAACsB,YAAY,CAACV,OAAO,CAACE,SAAS,CAAC,IAAI,CAAC,EAAEH,OAAO,CAAC;AACxD,YAAA;AACF;AACF;AACF;;AAEA;AACA,MAAA,IACEA,OAAO,CAACK,QAAQ,KAAKJ,OAAO,CAACI,QAAQ,IACrCL,OAAO,CAACY,QAAQ,KAAKX,OAAO,CAACW,QAAQ,EACrC;QACAvB,SAAS,CAACsB,YAAY,CAACV,OAAO,CAACE,SAAS,CAAC,IAAI,CAAC,EAAEH,OAAO,CAAC;AACxD,QAAA;AACF;AACA;AACA,MAAA,IAAIA,OAAO,CAACK,QAAQ,KAAKC,IAAI,CAACO,SAAS,EAAE;AACvC,QAAA,IAAIb,OAAO,CAACc,SAAS,KAAKb,OAAO,CAACa,SAAS,EAAE;AAC3Cd,UAAAA,OAAO,CAACc,SAAS,GAAGb,OAAO,CAACa,SAAS;AACvC;AACA,QAAA;AACF;AACA;AACA,MAAA,IAAId,OAAO,CAACK,QAAQ,KAAKC,IAAI,CAACC,YAAY,EAAE;AAC1C,QAAA,IAAI,CAACQ,gBAAgB,CAACf,OAAO,EAAEC,OAAO,CAAC;AACvC,QAAA,IAAI,CAACb,IAAI,CAACY,OAAO,EAAEC,OAAO,CAAC;AAC7B;AACF;AACF;;AAEA;AACF;AACA;AACA;AACA;AACA;AACEc,EAAAA,gBAAgBA,CAACC,KAAK,EAAEC,KAAK,EAAE;AAC7B,IAAA,MAAMC,sBAAsB,GAAG;AAC7B1E,MAAAA,KAAK,EAAE,OAAO;AACd2E,MAAAA,OAAO,EAAE,SAAS;AAClBC,MAAAA,QAAQ,EAAE,UAAU;AACpBC,MAAAA,QAAQ,EAAE;KACX;;AAED;IACA7B,KAAK,CAACC,IAAI,CAACuB,KAAK,CAACM,UAAU,CAAC,CAAC1D,OAAO,CAAE2D,IAAI,IAAK;MAC7C,IAAIA,IAAI,CAACC,IAAI,CAACC,UAAU,CAAC,GAAG,CAAC,EAAE;MAC/B,IAAI,CAACR,KAAK,CAACS,YAAY,CAACH,IAAI,CAACC,IAAI,CAAC,EAAE;AAClCR,QAAAA,KAAK,CAACW,eAAe,CAACJ,IAAI,CAACC,IAAI,CAAC;AAClC;AACF,KAAC,CAAC;AACF;IACAhC,KAAK,CAACC,IAAI,CAACwB,KAAK,CAACK,UAAU,CAAC,CAAC1D,OAAO,CAAE2D,IAAI,IAAK;MAC7C,IAAIA,IAAI,CAACC,IAAI,CAACC,UAAU,CAAC,GAAG,CAAC,EAAE;AAC/B,MAAA,IAAIT,KAAK,CAACP,YAAY,CAACc,IAAI,CAACC,IAAI,CAAC,KAAKD,IAAI,CAAC/E,KAAK,EAAE;QAChDwE,KAAK,CAACY,YAAY,CAACL,IAAI,CAACC,IAAI,EAAED,IAAI,CAAC/E,KAAK,CAAC;AACzC,QAAA,IAAI0E,sBAAsB,CAACK,IAAI,CAACC,IAAI,CAAC,EAAE;UACrCR,KAAK,CAACE,sBAAsB,CAACK,IAAI,CAACC,IAAI,CAAC,CAAC,GAAGD,IAAI,CAAC/E,KAAK;AACvD,SAAC,MAAM,IAAI+E,IAAI,CAACC,IAAI,IAAIR,KAAK,EAAE;UAC7BA,KAAK,CAACO,IAAI,CAACC,IAAI,CAAC,GAAGD,IAAI,CAAC/E,KAAK;AAC/B;AACF;AACF,KAAC,CAAC;AACJ;AACF;;AC/GA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMqF,KAAK,CAAC;AACjB;AACF;AACA;AACA;AACA;AACA;AACEtE,EAAAA,WAAWA,CAACiE,IAAI,EAAEM,MAAM,GAAG,EAAE,EAAE;IAC7B,IAAI,CAACN,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACM,MAAM,GAAGA,MAAM;AACpB,IAAA,IAAI,CAACC,WAAW,GAAG,EAAE;IACrB,IAAI,CAACC,QAAQ,GAAG,EAAE;AAClB,IAAA,IAAI,CAACC,eAAe,GAAG,CACrB,eAAe,EACf,SAAS,EACT,gBAAgB,EAChB,UAAU,EACV,WAAW,CACZ;IACD,IAAI,CAACC,UAAU,GAAG,KAAK;AACvB,IAAA,IAAI,CAACC,OAAO,GAAG,IAAIlE,OAAO,EAAE;AAC5B,IAAA,IAAI,CAACmE,QAAQ,GAAG,IAAIxD,QAAQ,EAAE;AAChC;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACEyD,EAAAA,GAAGA,CAACC,MAAM,EAAEC,OAAO,GAAG,EAAE,EAAE;AACxB,IAAA,IAAI,OAAOD,MAAM,CAACE,OAAO,KAAK,UAAU,EAAE;AACxCF,MAAAA,MAAM,CAACE,OAAO,CAAC,IAAI,EAAED,OAAO,CAAC;AAC/B;AACA,IAAA,IAAI,CAACP,QAAQ,CAAC1D,IAAI,CAACgE,MAAM,CAAC;AAC1B,IAAA,OAAO,IAAI;AACb;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACEG,EAAAA,SAASA,CAACjB,IAAI,EAAEkB,UAAU,EAAE;AAC1B,IAAA,IAAI,CAACX,WAAW,CAACP,IAAI,CAAC,GAAGkB,UAAU;AACnC,IAAA,OAAO,IAAI;AACb;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEC,KAAKA,CAACC,iBAAiB,EAAEC,QAAQ,EAAEC,KAAK,GAAG,EAAE,EAAE;AAC7C,IAAA,MAAMhE,SAAS,GACb,OAAO8D,iBAAiB,KAAK,QAAQ,GACjC3D,QAAQ,CAAC8D,aAAa,CAACH,iBAAiB,CAAC,GACzCA,iBAAiB;IACvB,IAAI,CAAC9D,SAAS,EACZ,MAAM,IAAIkE,KAAK,CAAC,CAAA,qBAAA,EAAwBJ,iBAAiB,CAAA,CAAE,CAAC;AAE9D,IAAA,MAAMF,UAAU,GAAG,IAAI,CAACX,WAAW,CAACc,QAAQ,CAAC;IAC7C,IAAI,CAACH,UAAU,EAAE,MAAM,IAAIM,KAAK,CAAC,CAAA,WAAA,EAAcH,QAAQ,CAAA,iBAAA,CAAmB,CAAC;IAE3E,MAAM;MAAEI,KAAK;MAAE9G,QAAQ;MAAE+G,KAAK;AAAEC,MAAAA;AAAS,KAAC,GAAGT,UAAU;AACvD,IAAA,MAAMU,OAAO,GAAG;MACdN,KAAK;AACLpE,MAAAA,IAAI,EAAE,IAAI,CAACyD,OAAO,CAACzD,IAAI,CAAC2E,IAAI,CAAC,IAAI,CAAClB,OAAO,CAAC;AAC1ChE,MAAAA,EAAE,EAAE,IAAI,CAACgE,OAAO,CAAChE,EAAE,CAACkF,IAAI,CAAC,IAAI,CAAClB,OAAO,CAAC;AACtCmB,MAAAA,MAAM,EAAGC,CAAC,IAAK,IAAIjG,MAAM,CAACiG,CAAC,CAAC;MAC5B,GAAG,IAAI,CAACC,sBAAsB;KAC/B;;AAED;AACJ;AACA;AACA;AACA;AACA;IACI,MAAMC,YAAY,GAAIrH,IAAI,IAAK;AAC7B,MAAA,MAAMsH,aAAa,GAAG;AAAE,QAAA,GAAGN,OAAO;QAAE,GAAGhH;OAAM;MAC7C,MAAMuH,oBAAoB,GAAG,EAAE;MAC/B,MAAMC,cAAc,GAAG,EAAE;AAEzB,MAAA,IAAI,CAAC,IAAI,CAAC1B,UAAU,EAAE;AACpBwB,QAAAA,aAAa,CAACG,aAAa,IAAIH,aAAa,CAACG,aAAa,EAAE;AAC9D,OAAC,MAAM;AACLH,QAAAA,aAAa,CAACI,cAAc,IAAIJ,aAAa,CAACI,cAAc,EAAE;AAChE;;AAEA;AACN;AACA;AACA;MACM,MAAMC,MAAM,GAAGA,MAAM;AACnB,QAAA,MAAMhF,OAAO,GAAG9C,cAAc,CAACC,KAAK,CAClCC,QAAQ,CAACuH,aAAa,CAAC,EACvBA,aACF,CAAC;QACD,IAAI,CAACtB,QAAQ,CAACvD,QAAQ,CAACC,SAAS,EAAEC,OAAO,CAAC;AAC1C,QAAA,IAAI,CAACiF,cAAc,CAAClF,SAAS,EAAE4E,aAAa,CAAC;QAC7C,IAAI,CAACO,aAAa,CAACnF,SAAS,EAAE+D,QAAQ,EAAEK,KAAK,EAAEQ,aAAa,CAAC;QAC7D,IAAI,CAACQ,cAAc,CAACpF,SAAS,EAAEqE,QAAQ,EAAES,cAAc,CAAC;AACxD,QAAA,IAAI,CAAC,IAAI,CAAC1B,UAAU,EAAE;AACpBwB,UAAAA,aAAa,CAACS,OAAO,IAAIT,aAAa,CAACS,OAAO,EAAE;UAChD,IAAI,CAACjC,UAAU,GAAG,IAAI;AACxB,SAAC,MAAM;AACLwB,UAAAA,aAAa,CAACU,QAAQ,IAAIV,aAAa,CAACU,QAAQ,EAAE;AACpD;OACD;MAEDxH,MAAM,CAACC,MAAM,CAACT,IAAI,CAAC,CAACwB,OAAO,CAAEyG,GAAG,IAAK;AACnC,QAAA,IAAIA,GAAG,YAAY/G,MAAM,EAAEqG,oBAAoB,CAACrF,IAAI,CAAC+F,GAAG,CAACvG,KAAK,CAACiG,MAAM,CAAC,CAAC;AACzE,OAAC,CAAC;AAEFA,MAAAA,MAAM,EAAE;MAER,OAAO;QACLjF,SAAS;AACT1C,QAAAA,IAAI,EAAEsH,aAAa;AACnB;AACR;AACA;QACQY,OAAO,EAAEA,MAAM;UACbX,oBAAoB,CAAC/F,OAAO,CAAEC,EAAE,IAAKA,EAAE,EAAE,CAAC;UAC1C+F,cAAc,CAAChG,OAAO,CAAE2G,KAAK,IAAKA,KAAK,CAACD,OAAO,EAAE,CAAC;AAClDZ,UAAAA,aAAa,CAACc,SAAS,IAAId,aAAa,CAACc,SAAS,EAAE;UACpD1F,SAAS,CAACK,SAAS,GAAG,EAAE;AAC1B;OACD;KACF;;AAED;AACA,IAAA,MAAMsF,WAAW,GAAGxB,KAAK,CAACG,OAAO,CAAC;IAClC,IAAIqB,WAAW,IAAI,OAAOA,WAAW,CAACC,IAAI,KAAK,UAAU,EAAE;MACzD,OAAOD,WAAW,CAACC,IAAI,CAAEtI,IAAI,IAAKqH,YAAY,CAACrH,IAAI,CAAC,CAAC;AACvD,KAAC,MAAM;AACL,MAAA,MAAMA,IAAI,GAAGqI,WAAW,IAAI,EAAE;MAC9B,OAAOhB,YAAY,CAACrH,IAAI,CAAC;AAC3B;AACF;;AAEA;AACF;AACA;AACA;AACA;AACA;AACEoH,EAAAA,sBAAsBA,GAAG;IACvB,OAAO,IAAI,CAACvB,eAAe,CAAC0C,MAAM,CAAC,CAACC,GAAG,EAAEC,IAAI,KAAK;AAChDD,MAAAA,GAAG,CAACC,IAAI,CAAC,GAAG,MAAM,EAAE;AACpB,MAAA,OAAOD,GAAG;KACX,EAAE,EAAE,CAAC;AACR;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACEZ,EAAAA,cAAcA,CAAClF,SAAS,EAAEsE,OAAO,EAAE;IACjCtE,SAAS,CAACgG,gBAAgB,CAAC,GAAG,CAAC,CAAClH,OAAO,CAAEmH,EAAE,IAAK;MAC9C,CAAC,GAAGA,EAAE,CAACzD,UAAU,CAAC,CAAC1D,OAAO,CAAC,CAAC;QAAE4D,IAAI;AAAEhF,QAAAA;AAAM,OAAC,KAAK;AAC9C,QAAA,IAAIgF,IAAI,CAACC,UAAU,CAAC,GAAG,CAAC,EAAE;AACxB,UAAA,MAAMrD,KAAK,GAAGoD,IAAI,CAACwD,KAAK,CAAC,CAAC,CAAC;UAC3B,MAAM3G,OAAO,GAAGpC,cAAc,CAACQ,QAAQ,CAACD,KAAK,EAAE4G,OAAO,CAAC;AACvD,UAAA,IAAI,OAAO/E,OAAO,KAAK,UAAU,EAAE;AACjC0G,YAAAA,EAAE,CAACE,gBAAgB,CAAC7G,KAAK,EAAEC,OAAO,CAAC;AACnC0G,YAAAA,EAAE,CAACpD,eAAe,CAACH,IAAI,CAAC;AAC1B;AACF;AACF,OAAC,CAAC;AACJ,KAAC,CAAC;AACJ;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEyC,aAAaA,CAACnF,SAAS,EAAE+D,QAAQ,EAAEqC,OAAO,EAAE9B,OAAO,EAAE;AACnD,IAAA,IAAI8B,OAAO,EAAE;MACX,IAAIC,OAAO,GAAGrG,SAAS,CAACiE,aAAa,CACnC,CAAA,wBAAA,EAA2BF,QAAQ,CAAA,EAAA,CACrC,CAAC;MACD,IAAI,CAACsC,OAAO,EAAE;AACZA,QAAAA,OAAO,GAAGlG,QAAQ,CAACC,aAAa,CAAC,OAAO,CAAC;AACzCiG,QAAAA,OAAO,CAACvD,YAAY,CAAC,kBAAkB,EAAEiB,QAAQ,CAAC;AAClD/D,QAAAA,SAAS,CAACoB,WAAW,CAACiF,OAAO,CAAC;AAChC;AACAA,MAAAA,OAAO,CAACC,WAAW,GAAGnJ,cAAc,CAACC,KAAK,CAACgJ,OAAO,CAAC9B,OAAO,CAAC,EAAEA,OAAO,CAAC;AACvE;AACF;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACEc,EAAAA,cAAcA,CAACpF,SAAS,EAAEqE,QAAQ,EAAES,cAAc,EAAE;IAClDA,cAAc,CAAChG,OAAO,CAAE2G,KAAK,IAAKA,KAAK,CAACD,OAAO,EAAE,CAAC;IAClDV,cAAc,CAAC9D,MAAM,GAAG,CAAC;AAEzBlD,IAAAA,MAAM,CAACD,IAAI,CAACwG,QAAQ,IAAI,EAAE,CAAC,CAACvF,OAAO,CAAEyH,SAAS,IAAK;MACjDvG,SAAS,CAACgG,gBAAgB,CAACO,SAAS,CAAC,CAACzH,OAAO,CAAE0H,OAAO,IAAK;QACzD,MAAMxC,KAAK,GAAG,EAAE;QAChB,CAAC,GAAGwC,OAAO,CAAChE,UAAU,CAAC,CAAC1D,OAAO,CAAC,CAAC;UAAE4D,IAAI;AAAEhF,UAAAA;AAAM,SAAC,KAAK;AACnD,UAAA,IAAIgF,IAAI,CAACC,UAAU,CAAC,aAAa,CAAC,EAAE;YAClCqB,KAAK,CAACtB,IAAI,CAACwD,KAAK,CAAC,aAAa,CAAClF,MAAM,CAAC,CAAC,GAAGtD,KAAK;AACjD;AACF,SAAC,CAAC;QACF,MAAM+I,QAAQ,GAAG,IAAI,CAAC5C,KAAK,CAAC2C,OAAO,EAAED,SAAS,EAAEvC,KAAK,CAAC;AACtDc,QAAAA,cAAc,CAACtF,IAAI,CAACiH,QAAQ,CAAC;AAC/B,OAAC,CAAC;AACJ,KAAC,CAAC;AACJ;AACF;;;;"}