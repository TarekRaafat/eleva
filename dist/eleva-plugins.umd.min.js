/*! Eleva Plugins v1.0.0-rc.11 | MIT License | https://elevajs.com */
var t,e;t=this,e=function(t){"use strict";const e=/-([a-z])/g,r={name:"attr",version:"1.0.0-rc.11",description:"Advanced attribute handling for Eleva components",install(t,r={}){const{enableAria:n=!0,enableData:o=!0,enableBoolean:i=!0,enableDynamic:s=!0}=r,a=(t,r)=>{const a=t.attributes,u=r.attributes;for(let r=0;r<u.length;r++){const{name:a,value:l}=u[r];if(!a.startsWith("@")&&t.getAttribute(a)!==l)if(n&&a.startsWith("aria-"))t["aria"+a.slice(5).replace(e,(t,e)=>e.toUpperCase())]=l,t.setAttribute(a,l);else if(o&&a.startsWith("data-"))t.dataset[a.slice(5)]=l,t.setAttribute(a,l);else{let r=a.replace(e,(t,e)=>e.toUpperCase());if(s&&!(r in t)&&!Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),r)){const e=Object.getOwnPropertyNames(Object.getPrototypeOf(t)).find(t=>t.toLowerCase()===a.toLowerCase()||t.toLowerCase().includes(a.toLowerCase())||a.toLowerCase().includes(t.toLowerCase()));e&&(r=e)}const n=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),r);if(r in t||n)if(i)if("boolean"==typeof t[r]||n?.get&&"boolean"==typeof n.get.call(t)){const e="false"!==l&&(""===l||l===r||"true"===l);t[r]=e,e?t.setAttribute(a,""):t.removeAttribute(a)}else t[r]=l,t.setAttribute(a,l);else t[r]=l,t.setAttribute(a,l);else t.setAttribute(a,l)}}for(let e=a.length-1;e>=0;e--){const n=a[e].name;r.hasAttribute(n)||t.removeAttribute(n)}};t.renderer&&(t.renderer.updateAttributes=a,t.renderer._originalPatchNode=t.renderer._patchNode,t.renderer._patchNode=function(t,e){t?._eleva_instance||(this._isSameNode(t,e)?t.nodeType===Node.ELEMENT_NODE?(a(t,e),this._diff(t,e)):t.nodeType===Node.TEXT_NODE&&t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue):t.replaceWith(e.cloneNode(!0)))}),t.plugins||(t.plugins=new Map),t.plugins.set(this.name,{name:this.name,version:this.version,description:this.description,options:r}),t.updateElementAttributes=a},uninstall(t){t.renderer&&t.renderer._originalPatchNode&&(t.renderer._patchNode=t.renderer._originalPatchNode,delete t.renderer._originalPatchNode),t.plugins&&t.plugins.delete(this.name),delete t.updateElementAttributes}},n={handle(t,e,r={}){const n=new Error(`[ElevaRouter] ${e}: ${t.message}`);throw n.originalError=t,n.context=e,n.details=r,n},warn(t,e={}){},log(t,e,r={}){}};class o{constructor(t,e={}){this.eleva=t,this.options={mode:"hash",queryParam:"view",viewSelector:"root",...e},this.routes=this._processRoutes(e.routes||[]),this.emitter=this.eleva.emitter,this.isStarted=!1,this._isNavigating=!1,this._navigationId=0,this.eventListeners=[],this.currentRoute=new this.eleva.signal(null),this.previousRoute=new this.eleva.signal(null),this.currentParams=new this.eleva.signal({}),this.currentQuery=new this.eleva.signal({}),this.currentLayout=new this.eleva.signal(null),this.currentView=new this.eleva.signal(null),this.isReady=new this.eleva.signal(!1),this.plugins=new Map,this._beforeEachGuards=[],e.onBeforeEach&&this._beforeEachGuards.push(e.onBeforeEach),this.errorHandler=n,this._scrollPositions=new Map,this._validateOptions()}_validateOptions(){["hash","query","history"].includes(this.options.mode)||this.errorHandler.handle(new Error(`Invalid routing mode: ${this.options.mode}. Must be "hash", "query", or "history".`),"Configuration validation failed")}_processRoutes(t){const e=[];for(const r of t)try{e.push({...r,segments:this._parsePathIntoSegments(r.path)})}catch(t){this.errorHandler.warn(`Invalid path in route definition "${r.path||"undefined"}": ${t.message}`,{route:r,error:t})}return e}_parsePathIntoSegments(t){t&&"string"==typeof t||this.errorHandler.handle(new Error("Route path must be a non-empty string"),"Path parsing failed",{path:t});const e=t.replace(/\/+/g,"/").replace(/\/$/,"")||"/";return"/"===e?[]:e.split("/").filter(Boolean).map(e=>{if(e.startsWith(":")){const r=e.substring(1);return r||this.errorHandler.handle(new Error(`Invalid parameter segment: ${e}`),"Path parsing failed",{segment:e,path:t}),{type:"param",name:r}}return{type:"static",value:e}})}_findViewElement(t){const e=this.options.viewSelector;return t.querySelector(`#${e}`)||t.querySelector(`.${e}`)||t.querySelector(`[data-${e}]`)||t.querySelector(e)||t}async start(){if(this.isStarted)return this.errorHandler.warn("Router is already started"),this;if("undefined"==typeof window)return this.errorHandler.warn("Router start skipped: `window` object not available (SSR environment)"),this;if("undefined"!=typeof document&&!document.querySelector(this.options.mount))return this.errorHandler.warn(`Mount element "${this.options.mount}" was not found in the DOM. The router will not start.`,{mountSelector:this.options.mount}),this;const t=()=>this._handleRouteChange();return"hash"===this.options.mode?(window.addEventListener("hashchange",t),this.eventListeners.push(()=>window.removeEventListener("hashchange",t))):(window.addEventListener("popstate",t),this.eventListeners.push(()=>window.removeEventListener("popstate",t))),this.isStarted=!0,await this._handleRouteChange(!1),this.isReady.value=!0,await this.emitter.emit("router:ready",this),this}async destroy(){if(this.isStarted){for(const t of this.plugins.values())if("function"==typeof t.destroy)try{await t.destroy(this)}catch(e){this.errorHandler.log(`Plugin ${t.name} destroy failed`,e)}this.eventListeners.forEach(t=>t()),this.eventListeners=[],this.currentLayout.value&&await this.currentLayout.value.unmount(),this.isStarted=!1,this.isReady.value=!1}}async stop(){return this.destroy()}async navigate(t,e={}){try{const r="string"==typeof t?{path:t,params:e}:t;let n=this._buildPath(r.path,r.params||{});const o=r.query||{};if(Object.keys(o).length>0){const t=new URLSearchParams(o).toString();t&&(n+=`?${t}`)}if(this._isSameRoute(n,r.params,o))return!0;const i=await this._proceedWithNavigation(n);if(i){const t=++this._navigationId;this._isNavigating=!0;const e=r.state||{},o=r.replace||!1,i=o?"replaceState":"pushState";if("hash"===this.options.mode)if(o){const t=`${window.location.pathname}${window.location.search}#${n}`;window.history.replaceState(e,"",t)}else window.location.hash=n;else{const t="query"===this.options.mode?this._buildQueryUrl(n):n;history[i](e,"",t)}queueMicrotask(()=>{this._navigationId===t&&(this._isNavigating=!1)})}return i}catch(t){return this.errorHandler.log("Navigation failed",t),await this.emitter.emit("router:onError",t),!1}}_buildQueryUrl(t){const e=new URLSearchParams(window.location.search);return e.set(this.options.queryParam,t.split("?")[0]),`${window.location.pathname}?${e.toString()}`}_isSameRoute(t,e,r){const n=this.currentRoute.value;if(!n)return!1;const[o,i]=t.split("?"),s=r||this._parseQuery(i||"");return n.path===o&&JSON.stringify(n.params)===JSON.stringify(e||{})&&JSON.stringify(n.query)===JSON.stringify(s)}_buildPath(t,e){let r=t;for(const[t,n]of Object.entries(e)){const e=encodeURIComponent(String(n));r=r.replace(new RegExp(`:${t}\\b`,"g"),e)}return r}async _handleRouteChange(t=!0){if(!this._isNavigating)try{const e=this.currentRoute.value,r=this._getCurrentLocation();!await this._proceedWithNavigation(r.fullUrl,t)&&e&&this.navigate({path:e.path,query:e.query,replace:!0})}catch(t){this.errorHandler.log("Route change handling failed",t,{currentUrl:"undefined"!=typeof window?window.location.href:""}),await this.emitter.emit("router:onError",t)}}async _proceedWithNavigation(t,e=!1){const r=this.currentRoute.value,[n,o]=(t||"/").split("?"),i={path:n.startsWith("/")?n:`/${n}`,query:this._parseQuery(o),fullUrl:t};let s=this._matchRoute(i.path);if(!s){const t=this.routes.find(t=>"*"===t.path);if(!t)return await this.emitter.emit("router:onError",new Error(`Route not found: ${i.path}`),i,r),!1;s={route:t,params:{pathMatch:decodeURIComponent(i.path.substring(1))}}}const a={...i,params:s.params,meta:s.route.meta||{},name:s.route.name,matched:s.route};try{if(!await this._runGuards(a,r,s.route))return!1;r&&"undefined"!=typeof window&&this._scrollPositions.set(r.path,{x:window.scrollX||window.pageXOffset||0,y:window.scrollY||window.pageYOffset||0});const t={to:a,from:r,route:s.route,layoutComponent:null,pageComponent:null,cancelled:!1,redirectTo:null};if(await this.emitter.emit("router:beforeResolve",t),t.cancelled)return!1;if(t.redirectTo)return this.navigate(t.redirectTo),!1;const{layoutComponent:n,pageComponent:o}=await this._resolveComponents(s.route);if(t.layoutComponent=n,t.pageComponent=o,await this.emitter.emit("router:afterResolve",t),r){const t=async t=>{if(t)try{await t.unmount()}catch(e){this.errorHandler.warn("Error during component unmount",{error:e,instance:t})}};(s.route.layout||this.options.globalLayout)!==(r.matched.layout||this.options.globalLayout)?(await t(this.currentLayout.value),this.currentLayout.value=null):(await t(this.currentView.value),this.currentView.value=null),r.matched.afterLeave&&await r.matched.afterLeave(a,r),await this.emitter.emit("router:afterLeave",a,r)}this.previousRoute.value=r,this.currentRoute.value=a,this.currentParams.value=a.params||{},this.currentQuery.value=a.query||{};const i={to:a,from:r,layoutComponent:n,pageComponent:o};await this.emitter.emit("router:beforeRender",i),await this._render(n,o,a),await this.emitter.emit("router:afterRender",i);const u={to:a,from:r,savedPosition:e&&this._scrollPositions.get(a.path)||null};return await this.emitter.emit("router:scroll",u),s.route.afterEnter&&await s.route.afterEnter(a,r),await this.emitter.emit("router:afterEnter",a,r),await this.emitter.emit("router:afterEach",a,r),!0}catch(t){return this.errorHandler.log("Error during navigation",t,{to:a,from:r}),await this.emitter.emit("router:onError",t,a,r),!1}}async _runGuards(t,e,r){const n={to:t,from:e,cancelled:!1,redirectTo:null};if(await this.emitter.emit("router:beforeEach",n),n.cancelled)return!1;if(n.redirectTo)return this.navigate(n.redirectTo),!1;const o=[...this._beforeEachGuards,...e&&e.matched.beforeLeave?[e.matched.beforeLeave]:[],...r.beforeEnter?[r.beforeEnter]:[]];for(const r of o){const n=await r(t,e);if(!1===n)return!1;if("string"==typeof n||"object"==typeof n)return this.navigate(n),!1}return!0}_resolveStringComponent(t){const e=this.eleva._components.get(t);return e||this.errorHandler.handle(new Error(`Component "${t}" not registered.`),"Component resolution failed",{componentName:t,availableComponents:Array.from(this.eleva._components.keys())}),e}async _resolveFunctionComponent(t){try{const e=t.toString(),r=e.includes("import(")||e.startsWith("() =>"),n=await t();return r&&n.default||n}catch(e){this.errorHandler.handle(new Error(`Failed to load async component: ${e.message}`),"Component resolution failed",{function:t.toString(),error:e})}}_validateComponentDefinition(t){return t&&"object"==typeof t||this.errorHandler.handle(new Error("Invalid component definition: "+typeof t),"Component validation failed",{definition:t}),"function"!=typeof t.template&&"string"!=typeof t.template&&this.errorHandler.handle(new Error("Component missing template property"),"Component validation failed",{definition:t}),t}async _resolveComponent(t){return null==t?null:"string"==typeof t?this._resolveStringComponent(t):"function"==typeof t?await this._resolveFunctionComponent(t):t&&"object"==typeof t?this._validateComponentDefinition(t):void this.errorHandler.handle(new Error("Invalid component definition: "+typeof t),"Component resolution failed",{definition:t})}async _resolveComponents(t){const e=t.layout||this.options.globalLayout;try{const[r,n]=await Promise.all([this._resolveComponent(e),this._resolveComponent(t.component)]);return n||this.errorHandler.handle(new Error(`Page component is null or undefined for route: ${t.path}`),"Component resolution failed",{route:t.path}),{layoutComponent:r,pageComponent:n}}catch(e){throw this.errorHandler.log(`Error resolving components for route ${t.path}`,e,{route:t.path}),e}}async _render(t,e){const r=document.querySelector(this.options.mount);if(r||this.errorHandler.handle(new Error(`Mount element "${this.options.mount}" not found.`),{mountSelector:this.options.mount}),t){const n=await this.eleva.mount(r,this._wrapComponentWithChildren(t));this.currentLayout.value=n;const o=this._findViewElement(n.container),i=await this.eleva.mount(o,this._wrapComponentWithChildren(e));this.currentView.value=i}else{const t=await this.eleva.mount(r,this._wrapComponentWithChildren(e));this.currentView.value=t,this.currentLayout.value=null}}_createRouteGetter(t,e){return()=>this.currentRoute.value?.[t]??e}_wrapComponent(t){const e=t.setup,r=this;return{...t,setup:async t=>(t.router={navigate:r.navigate.bind(r),current:r.currentRoute,previous:r.previousRoute,get params(){return r._createRouteGetter("params",{})()},get query(){return r._createRouteGetter("query",{})()},get path(){return r._createRouteGetter("path","/")()},get fullUrl(){return r._createRouteGetter("fullUrl",window.location.href)()},get meta(){return r._createRouteGetter("meta",{})()}},e?await e(t):{})}}_wrapComponentWithChildren(t){if("string"==typeof t)return t;if(!t||"object"!=typeof t)return t;const e=this._wrapComponent(t);if(e.children&&"object"==typeof e.children){const t={};for(const[r,n]of Object.entries(e.children))t[r]=this._wrapComponentWithChildren(n);e.children=t}return e}_getCurrentLocation(){if("undefined"==typeof window)return{path:"/",query:{},fullUrl:""};let t,e,r;switch(this.options.mode){case"hash":r=window.location.hash.slice(1)||"/",[t,e]=r.split("?");break;case"query":t=new URLSearchParams(window.location.search).get(this.options.queryParam)||"/",e=window.location.search.slice(1),r=t;break;default:t=window.location.pathname||"/",e=window.location.search.slice(1),r=`${t}${e?"?"+e:""}`}return{path:t.startsWith("/")?t:`/${t}`,query:this._parseQuery(e),fullUrl:r}}_parseQuery(t){const e={};return t&&new URLSearchParams(t).forEach((t,r)=>{e[r]=t}),e}_matchRoute(t){const e=t.split("/").filter(Boolean);for(const t of this.routes){if("/"===t.path){if(0===e.length)return{route:t,params:{}};continue}if(t.segments.length!==e.length)continue;const r={};let n=!0;for(let o=0;o<t.segments.length;o++){const i=t.segments[o],s=e[o];if("param"===i.type)r[i.name]=decodeURIComponent(s);else if(i.value!==s){n=!1;break}}if(n)return{route:t,params:r}}return null}addRoute(t,e=null){if(!t||!t.path)return this.errorHandler.warn("Invalid route definition: missing path",{route:t}),()=>{};if(this.hasRoute(t.path))return this.errorHandler.warn(`Route "${t.path}" already exists`,{route:t}),()=>{};const r={...t,segments:this._parsePathIntoSegments(t.path)},n=this.routes.findIndex(t=>"*"===t.path);return-1!==n?this.routes.splice(n,0,r):this.routes.push(r),this.emitter.emit("router:routeAdded",r),()=>this.removeRoute(t.path)}removeRoute(t){const e=this.routes.findIndex(e=>e.path===t);if(-1===e)return!1;const[r]=this.routes.splice(e,1);return this.emitter.emit("router:routeRemoved",r),!0}hasRoute(t){return this.routes.some(e=>e.path===t)}getRoutes(){return[...this.routes]}getRoute(t){return this.routes.find(e=>e.path===t)}onBeforeEach(t){return this._beforeEachGuards.push(t),()=>{const e=this._beforeEachGuards.indexOf(t);e>-1&&this._beforeEachGuards.splice(e,1)}}onAfterEnter(t){return this.emitter.on("router:afterEnter",t)}onAfterLeave(t){return this.emitter.on("router:afterLeave",t)}onAfterEach(t){return this.emitter.on("router:afterEach",t)}onError(t){return this.emitter.on("router:onError",t)}use(t,e={}){"function"!=typeof t.install&&this.errorHandler.handle(new Error("Plugin must have an install method"),"Plugin registration failed",{plugin:t}),this.plugins.has(t.name)?this.errorHandler.warn(`Plugin "${t.name}" is already registered`,{existingPlugin:this.plugins.get(t.name)}):(this.plugins.set(t.name,t),t.install(this,e))}getPlugins(){return Array.from(this.plugins.values())}getPlugin(t){return this.plugins.get(t)}removePlugin(t){const e=this.plugins.get(t);if(!e)return!1;if("function"==typeof e.destroy)try{e.destroy(this)}catch(e){this.errorHandler.log(`Plugin ${t} destroy failed`,e)}return this.plugins.delete(t)}setErrorHandler(t){t&&"function"==typeof t.handle&&"function"==typeof t.warn&&"function"==typeof t.log&&(this.errorHandler=t)}}const i={name:"router",version:"1.0.0-rc.11",description:"Client-side routing for Eleva applications",install(t,e={}){if(!e.mount)throw new Error("[RouterPlugin] 'mount' option is required");if(!e.routes||!Array.isArray(e.routes))throw new Error("[RouterPlugin] 'routes' option must be an array");const r=(e,r)=>{if(!e)return null;if("object"==typeof e&&null!==e&&!e.name){const n=`Eleva${r}Component_${Math.random().toString(36).slice(2,11)}`;try{return t.component(n,e),n}catch(t){throw new Error(`[RouterPlugin] Failed to register ${r} component: ${t.message}`)}}return e};e.globalLayout&&(e.globalLayout=r(e.globalLayout,"GlobalLayout")),(e.routes||[]).forEach(t=>{t.component=r(t.component,"Route"),t.layout&&(t.layout=r(t.layout,"RouteLayout"))});const n=new o(t,e);return t.router=n,!1!==e.autoStart&&queueMicrotask(()=>n.start()),t.plugins||(t.plugins=new Map),t.plugins.set(this.name,{name:this.name,version:this.version,description:this.description,options:e}),t.navigate=n.navigate.bind(n),t.getCurrentRoute=()=>n.currentRoute.value,t.getRouteParams=()=>n.currentParams.value,t.getRouteQuery=()=>n.currentQuery.value,n},async uninstall(t){t.router&&(await t.router.destroy(),delete t.router),t.plugins&&t.plugins.delete(this.name),delete t.navigate,delete t.getCurrentRoute,delete t.getRouteParams,delete t.getRouteQuery}};class s{static expressionPattern=/\{\{\s*(.*?)\s*\}\}/g;static parse(t,e){return"string"!=typeof t?t:t.replace(this.expressionPattern,(t,r)=>this.evaluate(r,e))}static evaluate(t,e){if("string"!=typeof t)return t;try{return new Function("data",`with(data) { return ${t}; }`)(e)}catch{return""}}}const a={name:"props",version:"1.0.0-rc.11",description:"Advanced props data handling for complex data structures with automatic type detection and reactivity",install(t,e={}){const{enableAutoParsing:r=!0,enableReactivity:n=!0,onError:o=null}=e,i=t=>{try{if("string"!=typeof t)return t;if("true"===t)return!0;if("false"===t)return!1;if("null"===t)return null;if("undefined"===t)return;if(t.startsWith("{")||t.startsWith("["))try{return JSON.parse(t)}catch(e){throw new Error(`Invalid JSON: ${t}`)}if("1"===t)return!0;if("0"===t)return!1;if(""===t)return!0;if(!isNaN(t)&&""!==t&&!isNaN(parseFloat(t)))return Number(t);if(t.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)){const e=new Date(t);if(!isNaN(e.getTime()))return e}return t}catch(e){return o&&o(e,t),t}},a=e=>{const r={};return Object.entries(e).forEach(([e,n])=>{r[e]=n&&"object"==typeof n&&"value"in n&&"watch"in n?n:new t.signal(n)}),r};t._extractProps=t=>{const e={},n=t.attributes;for(let o=n.length-1;o>=0;o--){const s=n[o];if(s.name.startsWith(":")){const n=s.name.slice(1),o=r?i(s.value):s.value;e[n]=o,t.removeAttribute(s.name)}}return e};const u=t.mount;t.mount=async(e,r,o={})=>{const i=n?a(o):o;return await u.call(t,e,r,i)};const l=t._mountComponents,c=new WeakMap,h=new Set;t._mountComponents=async(e,r,o)=>{for(const[i,s]of Object.entries(r))if(i)for(const r of e.querySelectorAll(i)){if(!(r instanceof HTMLElement))continue;const i=t._extractProps(r);let u=i,l=c.get(e);if(!l){let t=e;for(;t&&!l;){if(t._eleva_instance&&t._eleva_instance.data){l=t._eleva_instance.data,c.set(e,l);break}t=t.parentElement}}if(n&&l){const e={};Object.keys(i).forEach(r=>{l[r]&&l[r]instanceof t.signal&&(e[r]=l[r])}),u={...i,...e}}let d=u;if(n){const t={};Object.entries(u).forEach(([e,r])=>{r&&"object"==typeof r&&"value"in r&&"watch"in r||(t[e]=r)}),d={...a(t),...u}}const p=await t.mount(r,s,d);p&&!o.includes(p)&&(o.push(p),n&&Object.keys(i).length>0&&!l&&h.add({instance:p,extractedProps:i,container:e,component:s}))}if(n&&h.size>0)for(const e of h){const{instance:r,extractedProps:n,container:o,component:i}=e;let a=c.get(o);if(!a){let t=o;for(;t&&!a;){if(t._eleva_instance&&t._eleva_instance.data){a=t._eleva_instance.data,c.set(o,a);break}t=t.parentElement}}if(a){const o={};if(Object.keys(n).forEach(e=>{a[e]&&a[e]instanceof t.signal&&(o[e]=a[e])}),Object.keys(o).length>0){Object.assign(r.data,o),Object.keys(o).forEach(e=>{const n=o[e];n&&"function"==typeof n.watch&&n.watch(()=>{const e=t._components.get(i)||i;if(e&&e.template){const n="function"==typeof e.template?e.template(r.data):e.template,o=s.parse(n,r.data);t.renderer.patchDOM(r.container,o)}})});const e=t._components.get(i)||i;if(e&&e.template){const n="function"==typeof e.template?e.template(r.data):e.template,o=s.parse(n,r.data);t.renderer.patchDOM(r.container,o)}}h.delete(e)}}},t.props={parse:t=>r?i(t):t,detectType:t=>null===t?"null":void 0===t?"undefined":"boolean"==typeof t?"boolean":"number"==typeof t?"number":"string"==typeof t?"string":"function"==typeof t?"function":t instanceof Date?"date":t instanceof Map?"map":t instanceof Set?"set":Array.isArray(t)?"array":"object"==typeof t?"object":"unknown"},t._originalExtractProps=t._extractProps,t._originalMount=u,t._originalMountComponents=l},uninstall(t){t._originalExtractProps&&(t._extractProps=t._originalExtractProps,delete t._originalExtractProps),t._originalMount&&(t.mount=t._originalMount,delete t._originalMount),t._originalMountComponents&&(t._mountComponents=t._originalMountComponents,delete t._originalMountComponents),t.props&&delete t.props}},u={name:"store",version:"1.0.0-rc.11",description:"Reactive state management for sharing data across the entire Eleva application",install(t,e={}){const{state:r={},actions:n={},namespaces:o={},persistence:i={},devTools:s=!1,onError:a=null}=e,u=new class{constructor(){this.state={},this.actions={},this.subscribers=new Set,this.mutations=[],this.persistence={enabled:!1,key:"eleva-store",storage:"localStorage",include:null,exclude:null,...i},this.devTools=s,this.onError=a,this._initializeState(r,n),this._initializeNamespaces(o),this._loadPersistedState(),this._setupDevTools()}_initializeState(e,r){Object.entries(e).forEach(([e,r])=>{this.state[e]=new t.signal(r)}),this.actions={...r}}_initializeNamespaces(e){Object.entries(e).forEach(([e,r])=>{const{state:n={},actions:o={}}=r;this.state[e]||(this.state[e]={}),this.actions[e]||(this.actions[e]={}),Object.entries(n).forEach(([r,n])=>{this.state[e][r]=new t.signal(n)}),this.actions[e]={...o}})}_loadPersistedState(){if(this.persistence.enabled&&"undefined"!=typeof window)try{const t=window[this.persistence.storage].getItem(this.persistence.key);if(t){const e=JSON.parse(t);this._applyPersistedData(e)}}catch(t){this.onError&&this.onError(t,"Failed to load persisted state")}}_applyPersistedData(t,e=this.state,r=""){Object.entries(t).forEach(([t,n])=>{const o=r?`${r}.${t}`:t;this._shouldPersist(o)&&(e[t]&&"object"==typeof e[t]&&"value"in e[t]?e[t].value=n:"object"==typeof n&&null!==n&&e[t]&&this._applyPersistedData(n,e[t],o))})}_shouldPersist(t){const{include:e,exclude:r}=this.persistence;return e&&e.length>0?e.some(e=>t.startsWith(e)):!(r&&r.length>0&&r.some(e=>t.startsWith(e)))}_saveState(){if(this.persistence.enabled&&"undefined"!=typeof window)try{const t=window[this.persistence.storage],e=this._extractPersistedData();t.setItem(this.persistence.key,JSON.stringify(e))}catch(t){this.onError&&this.onError(t,"Failed to save state")}}_extractPersistedData(t=this.state,e=""){const r={};return Object.entries(t).forEach(([t,n])=>{const o=e?`${e}.${t}`:t;if(this._shouldPersist(o))if(n&&"object"==typeof n&&"value"in n)r[t]=n.value;else if("object"==typeof n&&null!==n){const e=this._extractPersistedData(n,o);Object.keys(e).length>0&&(r[t]=e)}}),r}_setupDevTools(){this.devTools&&"undefined"!=typeof window&&window.__ELEVA_DEVTOOLS__&&window.__ELEVA_DEVTOOLS__.registerStore(this)}async dispatch(t,e){try{const r=this._getAction(t);if(!r){const e=new Error(`Action "${t}" not found`);throw this.onError&&this.onError(e,t),e}const n={type:t,payload:e,timestamp:Date.now()};this.mutations.push(n),this.mutations.length>100&&this.mutations.shift();const o=await r.call(null,this.state,e);return this._saveState(),this.subscribers.forEach(t=>{try{t(n,this.state)}catch(t){this.onError&&this.onError(t,"Subscriber callback failed")}}),this.devTools&&"undefined"!=typeof window&&window.__ELEVA_DEVTOOLS__&&window.__ELEVA_DEVTOOLS__.notifyMutation(n,this.state),o}catch(e){throw this.onError&&this.onError(e,`Action dispatch failed: ${t}`),e}}_getAction(t){const e=t.split(".");let r=this.actions;for(const t of e){if(void 0===r[t])return null;r=r[t]}return"function"==typeof r?r:null}subscribe(t){if("function"!=typeof t)throw new Error("Subscribe callback must be a function");return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}getState(){return this._extractPersistedData()}replaceState(t){this._applyPersistedData(t),this._saveState()}clearPersistedState(){if(this.persistence.enabled&&"undefined"!=typeof window)try{window[this.persistence.storage].removeItem(this.persistence.key)}catch(t){this.onError&&this.onError(t,"Failed to clear persisted state")}}registerModule(t,e){this.state[t]||this.actions[t]||(this.state[t]={},this.actions[t]={},this._initializeNamespaces({[t]:e}),this._saveState())}unregisterModule(t){(this.state[t]||this.actions[t])&&(delete this.state[t],delete this.actions[t],this._saveState())}createState(e,r){return this.state[e]||(this.state[e]=new t.signal(r),this._saveState()),this.state[e]}createAction(t,e){if("function"!=typeof e)throw new Error("Action must be a function");this.actions[t]=e}},l=t.mount;t.mount=async(e,r,n={})=>{const o="string"==typeof r&&t._components.get(r)||r;if(!o)return await l.call(t,e,r,n);const i={...o,async setup(e){e.store={state:u.state,dispatch:u.dispatch.bind(u),subscribe:u.subscribe.bind(u),getState:u.getState.bind(u),registerModule:u.registerModule.bind(u),unregisterModule:u.unregisterModule.bind(u),createState:u.createState.bind(u),createAction:u.createAction.bind(u),signal:t.signal};const r=o.setup;return r?await r(e):{}}};return await l.call(t,e,i,n)};const c=t._mountComponents;t._mountComponents=async(e,r,n)=>{const o={};for(const[e,n]of Object.entries(r)){const r="string"==typeof n&&t._components.get(n)||n;o[e]=r&&"object"==typeof r?{...r,async setup(e){e.store={state:u.state,dispatch:u.dispatch.bind(u),subscribe:u.subscribe.bind(u),getState:u.getState.bind(u),registerModule:u.registerModule.bind(u),unregisterModule:u.unregisterModule.bind(u),createState:u.createState.bind(u),createAction:u.createAction.bind(u),signal:t.signal};const n=r.setup;return n?await n(e):{}}}:n}return await c.call(t,e,o,n)},t.store=u,t.createAction=(t,e)=>{u.actions[t]=e},t.dispatch=(t,e)=>u.dispatch(t,e),t.getState=()=>u.getState(),t.subscribe=t=>u.subscribe(t),t._originalMount=l,t._originalMountComponents=c},uninstall(t){t._originalMount&&(t.mount=t._originalMount,delete t._originalMount),t._originalMountComponents&&(t._mountComponents=t._originalMountComponents,delete t._originalMountComponents),t.store&&delete t.store,t.createAction&&delete t.createAction,t.dispatch&&delete t.dispatch,t.getState&&delete t.getState,t.subscribe&&delete t.subscribe}};t.Attr=r,t.Props=a,t.Router=i,t.Store=u},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ElevaPlugins={});
//# sourceMappingURL=eleva-plugins.umd.min.js.map
