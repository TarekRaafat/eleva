{"version":3,"file":"eleva.esm.js","sources":["../src/modules/TemplateEngine.js","../src/modules/Signal.js","../src/modules/Emitter.js","../src/modules/Renderer.js","../src/core/Eleva.js"],"sourcesContent":["\"use strict\";\n\n/**\n * @class ðŸ”’ TemplateEngine\n * @classdesc A secure template engine that handles interpolation and dynamic attribute parsing.\n * Provides a safe way to evaluate expressions in templates while preventing XSS attacks.\n * All methods are static and can be called directly on the class.\n *\n * @example\n * const template = \"Hello, {{name}}!\";\n * const data = { name: \"World\" };\n * const result = TemplateEngine.parse(template, data); // Returns: \"Hello, World!\"\n */\nexport class TemplateEngine {\n  /**\n   * @private {RegExp} Regular expression for matching template expressions in the format {{ expression }}\n   */\n  static expressionPattern = /\\{\\{\\s*(.*?)\\s*\\}\\}/g;\n\n  /**\n   * Parses a template string, replacing expressions with their evaluated values.\n   * Expressions are evaluated in the provided data context.\n   *\n   * @public\n   * @static\n   * @param {string} template - The template string to parse.\n   * @param {Object} data - The data context for evaluating expressions.\n   * @returns {string} The parsed template with expressions replaced by their values.\n   * @example\n   * const result = TemplateEngine.parse(\"{{user.name}} is {{user.age}} years old\", {\n   *   user: { name: \"John\", age: 30 }\n   * }); // Returns: \"John is 30 years old\"\n   */\n  static parse(template, data) {\n    if (typeof template !== \"string\") return template;\n    return template.replace(this.expressionPattern, (_, expression) =>\n      this.evaluate(expression, data)\n    );\n  }\n\n  /**\n   * Evaluates an expression in the context of the provided data object.\n   * Note: This does not provide a true sandbox and evaluated expressions may access global scope.\n   *\n   * @public\n   * @static\n   * @param {string} expression - The expression to evaluate.\n   * @param {Object} data - The data context for evaluation.\n   * @returns {*} The result of the evaluation, or an empty string if evaluation fails.\n   * @example\n   * const result = TemplateEngine.evaluate(\"user.name\", { user: { name: \"John\" } }); // Returns: \"John\"\n   * const age = TemplateEngine.evaluate(\"user.age\", { user: { age: 30 } }); // Returns: 30\n   */\n  static evaluate(expression, data) {\n    if (typeof expression !== \"string\") return expression;\n    try {\n      return new Function(\"data\", `with(data) { return ${expression}; }`)(data);\n    } catch {\n      return \"\";\n    }\n  }\n}\n","\"use strict\";\n\n/**\n * @class âš¡ Signal\n * @classdesc A reactive data holder that enables fine-grained reactivity in the Eleva framework.\n * Signals notify registered watchers when their value changes, enabling efficient DOM updates\n * through targeted patching rather than full re-renders.\n *\n * @example\n * const count = new Signal(0);\n * count.watch((value) => console.log(`Count changed to: ${value}`));\n * count.value = 1; // Logs: \"Count changed to: 1\"\n */\nexport class Signal {\n  /**\n   * Creates a new Signal instance with the specified initial value.\n   *\n   * @public\n   * @param {*} value - The initial value of the signal.\n   */\n  constructor(value) {\n    /** @private {T} Internal storage for the signal's current value, where T is the type of the initial value */\n    this._value = value;\n    /** @private {Set<function(T): void>} Collection of callback functions to be notified when value changes, where T is the value type */\n    this._watchers = new Set();\n    /** @private {boolean} Flag to prevent multiple synchronous watcher notifications and batch updates into microtasks */\n    this._pending = false;\n  }\n\n  /**\n   * Gets the current value of the signal.\n   *\n   * @public\n   * @returns {T} The current value, where T is the type of the initial value.\n   */\n  get value() {\n    return this._value;\n  }\n\n  /**\n   * Sets a new value for the signal and notifies all registered watchers if the value has changed.\n   * The notification is batched using microtasks to prevent multiple synchronous updates.\n   *\n   * @public\n   * @param {T} newVal - The new value to set, where T is the type of the initial value.\n   * @returns {void}\n   */\n  set value(newVal) {\n    if (this._value === newVal) return;\n\n    this._value = newVal;\n    this._notify();\n  }\n\n  /**\n   * Registers a watcher function that will be called whenever the signal's value changes.\n   * The watcher will receive the new value as its argument.\n   *\n   * @public\n   * @param {function(T): void} fn - The callback function to invoke on value change, where T is the value type.\n   * @returns {function(): boolean} A function to unsubscribe the watcher.\n   * @example\n   * const unsubscribe = signal.watch((value) => console.log(value));\n   * // Later...\n   * unsubscribe(); // Stops watching for changes\n   */\n  watch(fn) {\n    this._watchers.add(fn);\n    return () => this._watchers.delete(fn);\n  }\n\n  /**\n   * Notifies all registered watchers of a value change using microtask scheduling.\n   * Uses a pending flag to batch multiple synchronous updates into a single notification.\n   * All watcher callbacks receive the current value when executed.\n   *\n   * @private\n   * @returns {void}\n   */\n  _notify() {\n    if (this._pending) return;\n\n    this._pending = true;\n    queueMicrotask(() => {\n      this._watchers.forEach((fn) => fn(this._value));\n      this._pending = false;\n    });\n  }\n}\n","\"use strict\";\n\n/**\n * @class ðŸ“¡ Emitter\n * @classdesc A robust event emitter that enables inter-component communication through a publish-subscribe pattern.\n * Components can emit events and listen for events from other components, facilitating loose coupling\n * and reactive updates across the application.\n *\n * @example\n * const emitter = new Emitter();\n * emitter.on('user:login', (user) => console.log(`User logged in: ${user.name}`));\n * emitter.emit('user:login', { name: 'John' }); // Logs: \"User logged in: John\"\n */\nexport class Emitter {\n  /**\n   * Creates a new Emitter instance.\n   *\n   * @public\n   */\n  constructor() {\n    /** @private {Map<string, Set<function(any): void>>} Map of event names to their registered handler functions */\n    this._events = new Map();\n  }\n\n  /**\n   * Registers an event handler for the specified event name.\n   * The handler will be called with the event data when the event is emitted.\n   *\n   * @public\n   * @param {string} event - The name of the event to listen for.\n   * @param {function(any): void} handler - The callback function to invoke when the event occurs.\n   * @returns {function(): boolean} A function to unsubscribe the event handler.\n   * @example\n   * const unsubscribe = emitter.on('user:login', (user) => console.log(user));\n   * // Later...\n   * unsubscribe(); // Stops listening for the event\n   */\n  on(event, handler) {\n    if (!this._events.has(event)) this._events.set(event, new Set());\n\n    this._events.get(event).add(handler);\n    return () => this.off(event, handler);\n  }\n\n  /**\n   * Removes an event handler for the specified event name.\n   * If no handler is provided, all handlers for the event are removed.\n   *\n   * @public\n   * @param {string} event - The name of the event.\n   * @param {function(any): void} [handler] - The specific handler function to remove.\n   * @returns {void}\n   */\n  off(event, handler) {\n    if (!this._events.has(event)) return;\n    if (handler) {\n      const handlers = this._events.get(event);\n      handlers.delete(handler);\n      // Remove the event if there are no handlers left\n      if (handlers.size === 0) this._events.delete(event);\n    } else {\n      this._events.delete(event);\n    }\n  }\n\n  /**\n   * Emits an event with the specified data to all registered handlers.\n   * Handlers are called synchronously in the order they were registered.\n   *\n   * @public\n   * @param {string} event - The name of the event to emit.\n   * @param {...any} args - Optional arguments to pass to the event handlers.\n   * @returns {void}\n   */\n  emit(event, ...args) {\n    if (!this._events.has(event)) return;\n    this._events.get(event).forEach((handler) => handler(...args));\n  }\n}\n","\"use strict\";\n\n/**\n * @class ðŸŽ¨ Renderer\n * @classdesc A DOM renderer that handles efficient DOM updates through patching and diffing.\n * Provides methods for updating the DOM by comparing new and old structures and applying\n * only the necessary changes, minimizing layout thrashing and improving performance.\n *\n * @example\n * const renderer = new Renderer();\n * const container = document.getElementById(\"app\");\n * const newHtml = \"<div>Updated content</div>\";\n * renderer.patchDOM(container, newHtml);\n */\nexport class Renderer {\n  /**\n   * Patches the DOM of a container element with new HTML content.\n   * This method efficiently updates the DOM by comparing the new content with the existing\n   * content and applying only the necessary changes.\n   *\n   * @public\n   * @param {HTMLElement} container - The container element to patch.\n   * @param {string} newHtml - The new HTML content to apply.\n   * @returns {void}\n   * @throws {Error} If container is not an HTMLElement or newHtml is not a string.\n   */\n  patchDOM(container, newHtml) {\n    if (!(container instanceof HTMLElement)) {\n      throw new Error(\"Container must be an HTMLElement\");\n    }\n    if (typeof newHtml !== \"string\") {\n      throw new Error(\"newHtml must be a string\");\n    }\n\n    const temp = document.createElement(\"div\");\n    temp.innerHTML = newHtml;\n    this.diff(container, temp);\n    temp.innerHTML = \"\";\n  }\n\n  /**\n   * Diffs two DOM trees (old and new) and applies updates to the old DOM.\n   * This method recursively compares nodes and their attributes, applying only\n   * the necessary changes to minimize DOM operations.\n   *\n   * @private\n   * @param {HTMLElement} oldParent - The original DOM element.\n   * @param {HTMLElement} newParent - The new DOM element.\n   * @returns {void}\n   * @throws {Error} If either parent is not an HTMLElement.\n   */\n  diff(oldParent, newParent) {\n    if (\n      !(oldParent instanceof HTMLElement) ||\n      !(newParent instanceof HTMLElement)\n    ) {\n      throw new Error(\"Both parents must be HTMLElements\");\n    }\n\n    if (oldParent.isEqualNode(newParent)) return;\n\n    const oldC = oldParent.childNodes;\n    const newC = newParent.childNodes;\n    const len = Math.max(oldC.length, newC.length);\n    const operations = [];\n\n    for (let i = 0; i < len; i++) {\n      const oldNode = oldC[i];\n      const newNode = newC[i];\n\n      if (!oldNode && newNode) {\n        operations.push(() => oldParent.appendChild(newNode.cloneNode(true)));\n        continue;\n      }\n      if (oldNode && !newNode) {\n        operations.push(() => oldParent.removeChild(oldNode));\n        continue;\n      }\n\n      const isSameType =\n        oldNode.nodeType === newNode.nodeType &&\n        oldNode.nodeName === newNode.nodeName;\n\n      if (!isSameType) {\n        operations.push(() =>\n          oldParent.replaceChild(newNode.cloneNode(true), oldNode)\n        );\n        continue;\n      }\n\n      if (oldNode.nodeType === Node.ELEMENT_NODE) {\n        const oldKey = oldNode.getAttribute(\"key\");\n        const newKey = newNode.getAttribute(\"key\");\n\n        if (oldKey !== newKey && (oldKey || newKey)) {\n          operations.push(() =>\n            oldParent.replaceChild(newNode.cloneNode(true), oldNode)\n          );\n          continue;\n        }\n\n        this.updateAttributes(oldNode, newNode);\n        this.diff(oldNode, newNode);\n      } else if (\n        oldNode.nodeType === Node.TEXT_NODE &&\n        oldNode.nodeValue !== newNode.nodeValue\n      ) {\n        oldNode.nodeValue = newNode.nodeValue;\n      }\n    }\n\n    if (operations.length) {\n      operations.forEach((op) => op());\n    }\n  }\n\n  /**\n   * Updates the attributes of an element to match those of a new element.\n   * Handles special cases for ARIA attributes, data attributes, and boolean properties.\n   *\n   * @private\n   * @param {HTMLElement} oldEl - The element to update.\n   * @param {HTMLElement} newEl - The element providing the updated attributes.\n   * @returns {void}\n   * @throws {Error} If either element is not an HTMLElement.\n   */\n  updateAttributes(oldEl, newEl) {\n    if (!(oldEl instanceof HTMLElement) || !(newEl instanceof HTMLElement)) {\n      throw new Error(\"Both elements must be HTMLElements\");\n    }\n\n    const oldAttrs = oldEl.attributes;\n    const newAttrs = newEl.attributes;\n    const operations = [];\n\n    // Remove old attributes\n    for (const { name } of oldAttrs) {\n      if (!newEl.hasAttribute(name)) {\n        operations.push(() => oldEl.removeAttribute(name));\n      }\n    }\n\n    // Update/add new attributes\n    for (const attr of newAttrs) {\n      const { name, value } = attr;\n      if (name.startsWith(\"@\")) continue;\n\n      if (oldEl.getAttribute(name) === value) continue;\n\n      operations.push(() => {\n        oldEl.setAttribute(name, value);\n\n        if (name.startsWith(\"aria-\")) {\n          const prop =\n            \"aria\" +\n            name.slice(5).replace(/-([a-z])/g, (_, l) => l.toUpperCase());\n          oldEl[prop] = value;\n        } else if (name.startsWith(\"data-\")) {\n          oldEl.dataset[name.slice(5)] = value;\n        } else {\n          const prop = name.replace(/-([a-z])/g, (_, l) => l.toUpperCase());\n          if (prop in oldEl) {\n            const descriptor = Object.getOwnPropertyDescriptor(\n              Object.getPrototypeOf(oldEl),\n              prop\n            );\n            const isBoolean =\n              typeof oldEl[prop] === \"boolean\" ||\n              (descriptor?.get &&\n                typeof descriptor.get.call(oldEl) === \"boolean\");\n\n            if (isBoolean) {\n              oldEl[prop] =\n                value !== \"false\" &&\n                (value === \"\" || value === prop || value === \"true\");\n            } else {\n              oldEl[prop] = value;\n            }\n          }\n        }\n      });\n    }\n\n    if (operations.length) {\n      operations.forEach((op) => op());\n    }\n  }\n}\n","\"use strict\";\n\nimport { TemplateEngine } from \"../modules/TemplateEngine.js\";\nimport { Signal } from \"../modules/Signal.js\";\nimport { Emitter } from \"../modules/Emitter.js\";\nimport { Renderer } from \"../modules/Renderer.js\";\n\n/**\n * @typedef {Object} ComponentDefinition\n * @property {function(Object<string, any>): (Object<string, any>|Promise<Object<string, any>>)} [setup]\n *           Optional setup function that initializes the component's state and returns reactive data\n * @property {function(Object<string, any>): string} template\n *           Required function that defines the component's HTML structure\n * @property {function(Object<string, any>): string} [style]\n *           Optional function that provides component-scoped CSS styles\n * @property {Object<string, ComponentDefinition>} [children]\n *           Optional object defining nested child components\n */\n\n/**\n * @typedef {Object} ElevaPlugin\n * @property {function(Eleva, Object<string, any>): void} install\n *           Function that installs the plugin into the Eleva instance\n * @property {string} name\n *           Unique identifier name for the plugin\n */\n\n/**\n * @typedef {Object} MountResult\n * @property {HTMLElement} container\n *           The DOM element where the component is mounted\n * @property {Object<string, any>} data\n *           The component's reactive state and context data\n * @property {function(): void} unmount\n *           Function to clean up and unmount the component\n */\n\n/**\n * @class ðŸ§© Eleva\n * @classdesc A modern, signal-based component runtime framework that provides lifecycle hooks,\n * scoped styles, and plugin support. Eleva manages component registration, plugin integration,\n * event handling, and DOM rendering with a focus on performance and developer experience.\n *\n * @example\n * const app = new Eleva(\"myApp\");\n * app.component(\"myComponent\", {\n *   template: (ctx) => `<div>Hello ${ctx.props.name}</div>`,\n *   setup: (ctx) => ({ count: new Signal(0) })\n * });\n * app.mount(document.getElementById(\"app\"), \"myComponent\", { name: \"World\" });\n */\nexport class Eleva {\n  /**\n   * Creates a new Eleva instance with the specified name and configuration.\n   *\n   * @public\n   * @param {string} name - The unique identifier name for this Eleva instance.\n   * @param {Object<string, any>} [config={}] - Optional configuration object for the instance.\n   *        May include framework-wide settings and default behaviors.\n   */\n  constructor(name, config = {}) {\n    /** @public {string} The unique identifier name for this Eleva instance */\n    this.name = name;\n    /** @public {Object<string, any>} Optional configuration object for the Eleva instance */\n    this.config = config;\n    /** @public {Emitter} Instance of the event emitter for handling component events */\n    this.emitter = new Emitter();\n    /** @public {typeof Signal} Static reference to the Signal class for creating reactive state */\n    this.signal = Signal;\n    /** @public {Renderer} Instance of the renderer for handling DOM updates and patching */\n    this.renderer = new Renderer();\n\n    /** @private {Map<string, ComponentDefinition>} Registry of all component definitions by name */\n    this._components = new Map();\n    /** @private {Map<string, ElevaPlugin>} Collection of installed plugin instances by name */\n    this._plugins = new Map();\n    /** @private {string[]} Array of lifecycle hook names supported by components */\n    this._lifecycleHooks = [\n      \"onBeforeMount\",\n      \"onMount\",\n      \"onBeforeUpdate\",\n      \"onUpdate\",\n      \"onUnmount\",\n    ];\n    /** @private {boolean} Flag indicating if the root component is currently mounted */\n    this._isMounted = false;\n  }\n\n  /**\n   * Integrates a plugin with the Eleva framework.\n   * The plugin's install function will be called with the Eleva instance and provided options.\n   * After installation, the plugin will be available for use by components.\n   *\n   * @public\n   * @param {ElevaPlugin} plugin - The plugin object which must have an `install` function.\n   * @param {Object<string, any>} [options={}] - Optional configuration options for the plugin.\n   * @returns {Eleva} The Eleva instance (for method chaining).\n   * @example\n   * app.use(myPlugin, { option1: \"value1\" });\n   */\n  use(plugin, options = {}) {\n    plugin.install(this, options);\n    this._plugins.set(plugin.name, plugin);\n\n    return this;\n  }\n\n  /**\n   * Registers a new component with the Eleva instance.\n   * The component will be available for mounting using its registered name.\n   *\n   * @public\n   * @param {string} name - The unique name of the component to register.\n   * @param {ComponentDefinition} definition - The component definition including setup, template, style, and children.\n   * @returns {Eleva} The Eleva instance (for method chaining).\n   * @throws {Error} If the component name is already registered.\n   * @example\n   * app.component(\"myButton\", {\n   *   template: (ctx) => `<button>${ctx.props.text}</button>`,\n   *   style: () => \"button { color: blue; }\"\n   * });\n   */\n  component(name, definition) {\n    /** @type {Map<string, ComponentDefinition>} */\n    this._components.set(name, definition);\n    return this;\n  }\n\n  /**\n   * Mounts a registered component to a DOM element.\n   * This will initialize the component, set up its reactive state, and render it to the DOM.\n   *\n   * @public\n   * @param {HTMLElement} container - The DOM element where the component will be mounted.\n   * @param {string|ComponentDefinition} compName - The name of the registered component or a direct component definition.\n   * @param {Object<string, any>} [props={}] - Optional properties to pass to the component.\n   * @returns {Promise<MountResult>}\n   *          A Promise that resolves to an object containing:\n   *          - container: The mounted component's container element\n   *          - data: The component's reactive state and context\n   *          - unmount: Function to clean up and unmount the component\n   * @throws {Error} If the container is not found, or component is not registered.\n   * @example\n   * const instance = await app.mount(document.getElementById(\"app\"), \"myComponent\", { text: \"Click me\" });\n   * // Later...\n   * instance.unmount();\n   */\n  async mount(container, compName, props = {}) {\n    if (!container) throw new Error(`Container not found: ${container}`);\n\n    /** @type {ComponentDefinition} */\n    const definition =\n      typeof compName === \"string\" ? this._components.get(compName) : compName;\n    if (!definition) throw new Error(`Component \"${compName}\" not registered.`);\n\n    if (typeof definition.template !== \"function\")\n      throw new Error(\"Component template must be a function\");\n\n    /**\n     * Destructure the component definition to access core functionality.\n     * - setup: Optional function for component initialization and state management\n     * - template: Required function that returns the component's HTML structure\n     * - style: Optional function for component-scoped CSS styles\n     * - children: Optional object defining nested child components\n     */\n    const { setup, template, style, children } = definition;\n\n    /**\n     * Creates the initial context object for the component instance.\n     * This context provides core functionality and will be merged with setup data.\n     * @type {Object<string, any>}\n     * @property {Object<string, any>} props - Component properties passed during mounting\n     * @property {Emitter} emitter - Event emitter instance for component event handling\n     * @property {function(any): Signal} signal - Factory function to create reactive Signal instances\n     * @property {Object<string, function(): void>} ...lifecycleHooks - Prepared lifecycle hook functions\n     */\n    const context = {\n      props,\n      emitter: this.emitter,\n      /** @type {(v: any) => Signal} */\n      signal: (v) => new this.signal(v),\n      ...this._prepareLifecycleHooks(),\n    };\n\n    /**\n     * Processes the mounting of the component.\n     * This function handles:\n     * 1. Merging setup data with the component context\n     * 2. Setting up reactive watchers\n     * 3. Rendering the component\n     * 4. Managing component lifecycle\n     *\n     * @param {Object<string, any>} data - Data returned from the component's setup function\n     * @returns {MountResult} An object containing:\n     *   - container: The mounted component's container element\n     *   - data: The component's reactive state and context\n     *   - unmount: Function to clean up and unmount the component\n     */\n    const processMount = async (data) => {\n      const mergedContext = { ...context, ...data };\n      /** @type {Array<() => void>} */\n      const watcherUnsubscribers = [];\n      /** @type {Array<MountResult>} */\n      const childInstances = [];\n      /** @type {Array<() => void>} */\n      const cleanupListeners = [];\n\n      // Execute before hooks\n      if (!this._isMounted) {\n        mergedContext.onBeforeMount && mergedContext.onBeforeMount();\n      } else {\n        mergedContext.onBeforeUpdate && mergedContext.onBeforeUpdate();\n      }\n\n      /**\n       * Renders the component by parsing the template, patching the DOM,\n       * processing events, injecting styles, and mounting child components.\n       */\n      const render = async () => {\n        const newHtml = TemplateEngine.parse(\n          template(mergedContext),\n          mergedContext\n        );\n        this.renderer.patchDOM(container, newHtml);\n        this._processEvents(container, mergedContext, cleanupListeners);\n        this._injectStyles(container, compName, style, mergedContext);\n        await this._mountComponents(container, children, childInstances);\n\n        if (!this._isMounted) {\n          mergedContext.onMount && mergedContext.onMount();\n          this._isMounted = true;\n        } else {\n          mergedContext.onUpdate && mergedContext.onUpdate();\n        }\n      };\n\n      /**\n       * Sets up reactive watchers for all Signal instances in the component's data.\n       * When a Signal's value changes, the component will re-render to reflect the updates.\n       * Stores unsubscribe functions to clean up watchers when component unmounts.\n       */\n      for (const val of Object.values(data)) {\n        if (val instanceof Signal) watcherUnsubscribers.push(val.watch(render));\n      }\n\n      await render();\n\n      return {\n        container,\n        data: mergedContext,\n        /**\n         * Unmounts the component, cleaning up watchers and listeners, child components, and clearing the container.\n         *\n         * @returns {void}\n         */\n        unmount: () => {\n          for (const fn of watcherUnsubscribers) fn();\n          for (const fn of cleanupListeners) fn();\n          for (const child of childInstances) child.unmount();\n          mergedContext.onUnmount && mergedContext.onUnmount();\n          container.innerHTML = \"\";\n        },\n      };\n    };\n\n    // Handle asynchronous setup.\n    const setupResult = typeof setup === \"function\" ? await setup(context) : {};\n    return await processMount(setupResult);\n  }\n\n  /**\n   * Prepares default no-operation lifecycle hook functions for a component.\n   * These hooks will be called at various stages of the component's lifecycle.\n   *\n   * @private\n   * @returns {Object<string, function(): void>} An object mapping lifecycle hook names to empty functions.\n   *         The returned object will be merged with the component's context.\n   */\n  _prepareLifecycleHooks() {\n    /** @type {Object<string, () => void>} */\n    const hooks = {};\n    for (const hook of this._lifecycleHooks) {\n      hooks[hook] = () => {};\n    }\n    return hooks;\n  }\n\n  /**\n   * Processes DOM elements for event binding based on attributes starting with \"@\".\n   * This method handles the event delegation system and ensures proper cleanup of event listeners.\n   *\n   * @private\n   * @param {HTMLElement} container - The container element in which to search for event attributes.\n   * @param {Object<string, any>} context - The current component context containing event handler definitions.\n   * @param {Array<Function>} cleanupListeners - Array to collect cleanup functions for each event listener.\n   * @returns {void}\n   */\n  _processEvents(container, context, cleanupListeners) {\n    const elements = container.querySelectorAll(\"*\");\n    for (const el of elements) {\n      const attrs = el.attributes;\n      for (let i = 0; i < attrs.length; i++) {\n        const attr = attrs[i];\n        if (attr.name.startsWith(\"@\")) {\n          const event = attr.name.slice(1);\n          const handler = TemplateEngine.evaluate(attr.value, context);\n          if (typeof handler === \"function\") {\n            el.addEventListener(event, handler);\n            el.removeAttribute(attr.name);\n            cleanupListeners.push(() => el.removeEventListener(event, handler));\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Injects scoped styles into the component's container.\n   * The styles are automatically prefixed to prevent style leakage to other components.\n   *\n   * @private\n   * @param {HTMLElement} container - The container element where styles should be injected.\n   * @param {string} compName - The component name used to identify the style element.\n   * @param {function(Object<string, any>): string} [styleFn] - Optional function that returns CSS styles as a string.\n   * @param {Object<string, any>} context - The current component context for style interpolation.\n   * @returns {void}\n   */\n  _injectStyles(container, compName, styleFn, context) {\n    if (!styleFn) return;\n\n    let styleEl = container.querySelector(\n      `style[data-eleva-style=\"${compName}\"]`\n    );\n    if (!styleEl) {\n      styleEl = document.createElement(\"style\");\n      styleEl.setAttribute(\"data-eleva-style\", compName);\n      container.appendChild(styleEl);\n    }\n    styleEl.textContent = TemplateEngine.parse(styleFn(context), context);\n  }\n\n  /**\n   * Extracts props from an element's attributes that start with 'eleva-prop-'.\n   * This method is used to collect component properties from DOM elements.\n   *\n   * @private\n   * @param {HTMLElement} element - The DOM element to extract props from\n   * @returns {Object<string, any>} An object containing the extracted props\n   * @example\n   * // For an element with attributes:\n   * // <div eleva-prop-name=\"John\" eleva-prop-age=\"25\">\n   * // Returns: { name: \"John\", age: \"25\" }\n   */\n  _extractProps(element) {\n    const props = {};\n    for (const { name, value } of element.attributes) {\n      if (name.startsWith(\"eleva-prop-\")) {\n        props[name.replace(\"eleva-prop-\", \"\")] = value;\n      }\n    }\n    return props;\n  }\n\n  /**\n   * Mounts a single component instance to a container element.\n   * This method handles the actual mounting of a component with its props.\n   *\n   * @private\n   * @param {HTMLElement} container - The container element to mount the component to\n   * @param {string|ComponentDefinition} component - The component to mount, either as a name or definition\n   * @param {Object<string, any>} props - The props to pass to the component\n   * @returns {Promise<MountResult>} A promise that resolves to the mounted component instance\n   * @throws {Error} If the container is not a valid HTMLElement\n   */\n  async _mountComponentInstance(container, component, props) {\n    if (!(container instanceof HTMLElement)) return null;\n    return await this.mount(container, component, props);\n  }\n\n  /**\n   * Mounts components found by a selector in the container.\n   * This method handles mounting multiple instances of the same component type.\n   *\n   * @private\n   * @param {HTMLElement} container - The container to search for components\n   * @param {string} selector - The CSS selector to find components\n   * @param {string|ComponentDefinition} component - The component to mount\n   * @param {Array<MountResult>} instances - Array to store the mounted component instances\n   * @returns {Promise<void>}\n   */\n  async _mountComponentsBySelector(container, selector, component, instances) {\n    for (const el of container.querySelectorAll(selector)) {\n      const props = this._extractProps(el);\n      const instance = await this._mountComponentInstance(el, component, props);\n      if (instance) instances.push(instance);\n    }\n  }\n\n  /**\n   * Mounts all components within the parent component's container.\n   * This method implements a dual mounting system that handles both:\n   * 1. Explicitly defined children components (passed through the children parameter)\n   * 2. Template-referenced components (found in the template using component names)\n   *\n   * The mounting process follows these steps:\n   * 1. Cleans up any existing component instances\n   * 2. Mounts explicitly defined children components\n   * 3. Mounts template-referenced components\n   *\n   * @private\n   * @param {HTMLElement} container - The container element to mount components in\n   * @param {Object<string, ComponentDefinition>} children - Map of selectors to component definitions for explicit children\n   * @param {Array<MountResult>} childInstances - Array to store all mounted component instances\n   * @returns {Promise<void>}\n   *\n   * @example\n   * // Explicit children mounting:\n   * const children = {\n   *   '.user-profile': UserProfileComponent,\n   *   '.settings-panel': SettingsComponent\n   * };\n   *\n   * // Template-referenced components:\n   * // <div>\n   * //   <user-profile eleva-prop-name=\"John\"></user-profile>\n   * //   <settings-panel eleva-prop-theme=\"dark\"></settings-panel>\n   * // </div>\n   */\n  async _mountComponents(container, children, childInstances) {\n    // Clean up existing instances\n    for (const child of childInstances) child.unmount();\n    childInstances.length = 0;\n\n    // Mount explicitly defined children components\n    if (children) {\n      for (const [selector, component] of Object.entries(children)) {\n        if (!selector) continue;\n        await this._mountComponentsBySelector(\n          container,\n          selector,\n          component,\n          childInstances\n        );\n      }\n    }\n\n    // Mount components referenced in the template\n    for (const [compName] of this._components) {\n      await this._mountComponentsBySelector(\n        container,\n        compName,\n        compName,\n        childInstances\n      );\n    }\n  }\n}\n"],"names":["TemplateEngine","expressionPattern","parse","template","data","replace","_","expression","evaluate","Function","Signal","constructor","value","_value","_watchers","Set","_pending","newVal","_notify","watch","fn","add","delete","queueMicrotask","forEach","Emitter","_events","Map","on","event","handler","has","set","get","off","handlers","size","emit","args","Renderer","patchDOM","container","newHtml","HTMLElement","Error","temp","document","createElement","innerHTML","diff","oldParent","newParent","isEqualNode","oldC","childNodes","newC","len","Math","max","length","operations","i","oldNode","newNode","push","appendChild","cloneNode","removeChild","isSameType","nodeType","nodeName","replaceChild","Node","ELEMENT_NODE","oldKey","getAttribute","newKey","updateAttributes","TEXT_NODE","nodeValue","op","oldEl","newEl","oldAttrs","attributes","newAttrs","name","hasAttribute","removeAttribute","attr","startsWith","setAttribute","prop","slice","l","toUpperCase","dataset","descriptor","Object","getOwnPropertyDescriptor","getPrototypeOf","isBoolean","call","Eleva","config","emitter","signal","renderer","_components","_plugins","_lifecycleHooks","_isMounted","use","plugin","options","install","component","definition","mount","compName","props","setup","style","children","context","v","_prepareLifecycleHooks","processMount","mergedContext","watcherUnsubscribers","childInstances","cleanupListeners","onBeforeMount","onBeforeUpdate","render","_processEvents","_injectStyles","_mountComponents","onMount","onUpdate","val","values","unmount","child","onUnmount","setupResult","hooks","hook","elements","querySelectorAll","el","attrs","addEventListener","removeEventListener","styleFn","styleEl","querySelector","textContent","_extractProps","element","_mountComponentInstance","_mountComponentsBySelector","selector","instances","instance","entries"],"mappings":"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"}