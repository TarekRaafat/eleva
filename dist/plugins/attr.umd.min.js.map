{"version":3,"file":"attr.umd.min.js","sources":["../../src/plugins/Attr.js"],"sourcesContent":["\"use strict\";\n\n/**\n * A regular expression to match hyphenated lowercase letters.\n * @private\n * @type {RegExp}\n */\nconst CAMEL_RE = /-([a-z])/g;\n\n/**\n * @class ðŸŽ¯ AttrPlugin\n * @classdesc A plugin that provides advanced attribute handling for Eleva components.\n * This plugin extends the renderer with sophisticated attribute processing including:\n * - ARIA attribute handling with proper property mapping\n * - Data attribute management\n * - Boolean attribute processing\n * - Dynamic property detection and mapping\n * - Attribute cleanup and removal\n *\n * @example\n * // Install the plugin\n * const app = new Eleva(\"myApp\");\n * app.use(AttrPlugin);\n *\n * // Use advanced attributes in components\n * app.component(\"myComponent\", {\n *   template: (ctx) => `\n *     <button\n *       aria-expanded=\"${ctx.isExpanded.value}\"\n *       data-user-id=\"${ctx.userId.value}\"\n *       disabled=\"${ctx.isLoading.value}\"\n *       class=\"btn ${ctx.variant.value}\"\n *     >\n *       ${ctx.text.value}\n *     </button>\n *   `\n * });\n */\nexport const AttrPlugin = {\n  /**\n   * Unique identifier for the plugin\n   * @type {string}\n   */\n  name: \"attr\",\n\n  /**\n   * Plugin version\n   * @type {string}\n   */\n  version: \"1.0.0-rc.12\",\n\n  /**\n   * Plugin description\n   * @type {string}\n   */\n  description: \"Advanced attribute handling for Eleva components\",\n\n  /**\n   * Installs the plugin into the Eleva instance\n   *\n   * @param {Object} eleva - The Eleva instance\n   * @param {Object} options - Plugin configuration options\n   * @param {boolean} [options.enableAria=true] - Enable ARIA attribute handling\n   * @param {boolean} [options.enableData=true] - Enable data attribute handling\n   * @param {boolean} [options.enableBoolean=true] - Enable boolean attribute handling\n   * @param {boolean} [options.enableDynamic=true] - Enable dynamic property detection\n   */\n  install(eleva, options = {}) {\n    const {\n      enableAria = true,\n      enableData = true,\n      enableBoolean = true,\n      enableDynamic = true,\n    } = options;\n\n    /**\n     * Updates the attributes of an element to match a new element's attributes.\n     * This method provides sophisticated attribute processing including:\n     * - ARIA attribute handling with proper property mapping\n     * - Data attribute management\n     * - Boolean attribute processing\n     * - Dynamic property detection and mapping\n     * - Attribute cleanup and removal\n     *\n     * @param {HTMLElement} oldEl - The original element to update\n     * @param {HTMLElement} newEl - The new element to update\n     * @returns {void}\n     */\n    const updateAttributes = (oldEl, newEl) => {\n      const oldAttrs = oldEl.attributes;\n      const newAttrs = newEl.attributes;\n\n      // Process new attributes\n      for (let i = 0; i < newAttrs.length; i++) {\n        const { name, value } = newAttrs[i];\n\n        // Skip event attributes (handled by event system)\n        if (name.startsWith(\"@\")) continue;\n\n        // Skip if attribute hasn't changed\n        if (oldEl.getAttribute(name) === value) continue;\n\n        // Handle ARIA attributes\n        if (enableAria && name.startsWith(\"aria-\")) {\n          const prop =\n            \"aria\" + name.slice(5).replace(CAMEL_RE, (_, l) => l.toUpperCase());\n          oldEl[prop] = value;\n          oldEl.setAttribute(name, value);\n        }\n        // Handle data attributes\n        else if (enableData && name.startsWith(\"data-\")) {\n          oldEl.dataset[name.slice(5)] = value;\n          oldEl.setAttribute(name, value);\n        }\n        // Handle other attributes\n        else {\n          let prop = name.replace(CAMEL_RE, (_, l) => l.toUpperCase());\n\n          // Dynamic property detection\n          if (\n            enableDynamic &&\n            !(prop in oldEl) &&\n            !Object.getOwnPropertyDescriptor(Object.getPrototypeOf(oldEl), prop)\n          ) {\n            const elementProps = Object.getOwnPropertyNames(\n              Object.getPrototypeOf(oldEl)\n            );\n            const matchingProp = elementProps.find(\n              (p) =>\n                p.toLowerCase() === name.toLowerCase() ||\n                p.toLowerCase().includes(name.toLowerCase()) ||\n                name.toLowerCase().includes(p.toLowerCase())\n            );\n\n            if (matchingProp) {\n              prop = matchingProp;\n            }\n          }\n\n          const descriptor = Object.getOwnPropertyDescriptor(\n            Object.getPrototypeOf(oldEl),\n            prop\n          );\n          const hasProperty = prop in oldEl || descriptor;\n\n          if (hasProperty) {\n            // Boolean attribute handling\n            if (enableBoolean) {\n              const isBoolean =\n                typeof oldEl[prop] === \"boolean\" ||\n                (descriptor?.get &&\n                  typeof descriptor.get.call(oldEl) === \"boolean\");\n\n              if (isBoolean) {\n                const boolValue =\n                  value !== \"false\" &&\n                  (value === \"\" || value === prop || value === \"true\");\n                oldEl[prop] = boolValue;\n\n                if (boolValue) {\n                  oldEl.setAttribute(name, \"\");\n                } else {\n                  oldEl.removeAttribute(name);\n                }\n              } else {\n                oldEl[prop] = value;\n                oldEl.setAttribute(name, value);\n              }\n            } else {\n              oldEl[prop] = value;\n              oldEl.setAttribute(name, value);\n            }\n          } else {\n            oldEl.setAttribute(name, value);\n          }\n        }\n      }\n\n      // Remove old attributes that are no longer present\n      for (let i = oldAttrs.length - 1; i >= 0; i--) {\n        const name = oldAttrs[i].name;\n        if (!newEl.hasAttribute(name)) {\n          oldEl.removeAttribute(name);\n        }\n      }\n    };\n\n    // Extend the renderer with the advanced attribute handler\n    if (eleva.renderer) {\n      eleva.renderer.updateAttributes = updateAttributes;\n\n      // Store the original _patchNode method\n      const originalPatchNode = eleva.renderer._patchNode;\n      eleva.renderer._originalPatchNode = originalPatchNode;\n\n      // Override the _patchNode method to use our attribute handler\n      eleva.renderer._patchNode = function (oldNode, newNode) {\n        if (oldNode?._eleva_instance) return;\n\n        if (oldNode.nodeType === 3) {\n          if (oldNode.nodeValue !== newNode.nodeValue) {\n            oldNode.nodeValue = newNode.nodeValue;\n          }\n        } else if (oldNode.nodeType === 1) {\n          // Use advanced attribute handler instead of basic _updateAttributes\n          updateAttributes(oldNode, newNode);\n          this._diff(oldNode, newNode);\n        }\n      };\n    }\n\n    // Add plugin metadata to the Eleva instance\n    if (!eleva.plugins) {\n      eleva.plugins = new Map();\n    }\n    eleva.plugins.set(this.name, {\n      name: this.name,\n      version: this.version,\n      description: this.description,\n      options,\n    });\n\n    // Add utility methods for manual attribute updates\n    eleva.updateElementAttributes = updateAttributes;\n  },\n\n  /**\n   * Uninstalls the plugin from the Eleva instance\n   *\n   * @param {Object} eleva - The Eleva instance\n   */\n  uninstall(eleva) {\n    // Restore original _patchNode method if it exists\n    if (eleva.renderer && eleva.renderer._originalPatchNode) {\n      eleva.renderer._patchNode = eleva.renderer._originalPatchNode;\n      delete eleva.renderer._originalPatchNode;\n    }\n\n    // Remove plugin metadata\n    if (eleva.plugins) {\n      eleva.plugins.delete(this.name);\n    }\n\n    // Remove utility methods\n    delete eleva.updateElementAttributes;\n  },\n};\n\n// Short name export for convenience\nexport { AttrPlugin as Attr };\n"],"names":["CAMEL_RE","AttrPlugin","name","version","description","install","eleva","options","enableAria","enableData","enableBoolean","enableDynamic","updateAttributes","oldEl","newEl","oldAttrs","attributes","newAttrs","i","length","value","startsWith","getAttribute","slice","replace","_","l","toUpperCase","setAttribute","dataset","prop","Object","getOwnPropertyDescriptor","getPrototypeOf","matchingProp","elementProps","getOwnPropertyNames","find","p","toLowerCase","includes","descriptor","get","call","boolValue","removeAttribute","hasAttribute","renderer","originalPatchNode","_patchNode","_originalPatchNode","oldNode","newNode","_eleva_instance","nodeType","nodeValue","_diff","plugins","Map","set","updateElementAttributes","uninstall","delete"],"mappings":"0CAOA,IAAMA,EAAW,YA+BJC,EAAa,CAKxBC,KAAM,OAMNC,QAAS,cAMTC,YAAa,mDAYbC,QAAQC,CAAK,CAAEC,EAAU,EAAE,EACzB,GAAM,CACJC,WAAAA,EAAa,CAAA,CAAI,CACjBC,WAAAA,EAAa,CAAA,CAAI,CACjBC,cAAAA,EAAgB,CAAA,CAAI,CACpBC,cAAAA,EAAgB,CAAA,CAAI,CACrB,CAAGJ,EAeEK,EAAmB,CAACC,EAAOC,KAC/B,IAAMC,EAAWF,EAAMG,UAAU,CAC3BC,EAAWH,EAAME,UAAU,CAGjC,IAAK,IAAIE,EAAI,EAAGA,EAAID,EAASE,MAAM,CAAED,IAAK,CACxC,GAAM,CAAEhB,KAAAA,CAAI,CAAEkB,MAAAA,CAAK,CAAE,CAAGH,CAAQ,CAACC,EAAE,CAGnC,IAAIhB,EAAKmB,UAAU,CAAC,MAGhBR,EAAMS,YAAY,CAACpB,KAAUkB,EAGjC,GAAIZ,GAAcN,EAAKmB,UAAU,CAAC,SAGhCR,CAAK,CADH,OAASX,EAAKqB,KAAK,CAAC,GAAGC,OAAO,CAACxB,EAAU,CAACyB,EAAGC,IAAMA,EAAEC,WAAW,IACvD,CAAGP,EACdP,EAAMe,YAAY,CAAC1B,EAAMkB,QAGtB,GAAIX,GAAcP,EAAKmB,UAAU,CAAC,SACrCR,EAAMgB,OAAO,CAAC3B,EAAKqB,KAAK,CAAC,GAAG,CAAGH,EAC/BP,EAAMe,YAAY,CAAC1B,EAAMkB,OAGtB,CACH,IAAIU,EAAO5B,EAAKsB,OAAO,CAACxB,EAAU,CAACyB,EAAGC,IAAMA,EAAEC,WAAW,IAGzD,GACEhB,GACA,CAAEmB,CAAAA,KAAQjB,CAAAA,GACV,CAACkB,OAAOC,wBAAwB,CAACD,OAAOE,cAAc,CAACpB,GAAQiB,GAC/D,CAIA,IAAMI,EAAeC,AAHAJ,OAAOK,mBAAmB,CAC7CL,OAAOE,cAAc,CAACpB,IAEUwB,IAAI,CACpC,AAACC,GACCA,EAAEC,WAAW,KAAOrC,EAAKqC,WAAW,IACpCD,EAAEC,WAAW,GAAGC,QAAQ,CAACtC,EAAKqC,WAAW,KACzCrC,EAAKqC,WAAW,GAAGC,QAAQ,CAACF,EAAEC,WAAW,IAGzCL,CAAAA,GACFJ,CAAAA,EAAOI,CAAAA,CAEX,CAEA,IAAMO,EAAaV,OAAOC,wBAAwB,CAChDD,OAAOE,cAAc,CAACpB,GACtBiB,GAIF,GAFoBA,KAAQjB,GAAS4B,EAInC,GAAI/B,EAMF,GAJE,AAAuB,WAAvB,OAAOG,CAAK,CAACiB,EAAK,EACjBW,GAAYC,KACX,AAAsC,WAAtC,OAAOD,EAAWC,GAAG,CAACC,IAAI,CAAC9B,GAEhB,CACb,IAAM+B,EACJxB,AAAU,UAAVA,GACCA,CAAAA,AAAU,KAAVA,GAAgBA,IAAUU,GAAQV,AAAU,SAAVA,EACrCP,CAAAA,CAAK,CAACiB,EAAK,CAAGc,EAEVA,EACF/B,EAAMe,YAAY,CAAC1B,EAAM,IAEzBW,EAAMgC,eAAe,CAAC3C,EAE1B,MACEW,CAAK,CAACiB,EAAK,CAAGV,EACdP,EAAMe,YAAY,CAAC1B,EAAMkB,QAG3BP,CAAK,CAACiB,EAAK,CAAGV,EACdP,EAAMe,YAAY,CAAC1B,EAAMkB,QAG3BP,EAAMe,YAAY,CAAC1B,EAAMkB,EAE7B,CACF,CAGA,IAAK,IAAIF,EAAIH,EAASI,MAAM,CAAG,EAAGD,GAAK,EAAGA,IAAK,CAC7C,IAAMhB,EAAOa,CAAQ,CAACG,EAAE,CAAChB,IAAI,AACzB,CAACY,EAAMgC,YAAY,CAAC5C,IACtBW,EAAMgC,eAAe,CAAC3C,EAE1B,CACF,EAGA,GAAII,EAAMyC,QAAQ,CAAE,CAClBzC,EAAMyC,QAAQ,CAACnC,gBAAgB,CAAGA,EAGlC,IAAMoC,EAAoB1C,EAAMyC,QAAQ,CAACE,UAAU,AACnD3C,CAAAA,EAAMyC,QAAQ,CAACG,kBAAkB,CAAGF,EAGpC1C,EAAMyC,QAAQ,CAACE,UAAU,CAAG,SAAUE,CAAO,CAAEC,CAAO,EAChDD,GAASE,kBAETF,AAAqB,IAArBA,EAAQG,QAAQ,CACdH,EAAQI,SAAS,GAAKH,EAAQG,SAAS,EACzCJ,CAAAA,EAAQI,SAAS,CAAGH,EAAQG,SAAS,AAATA,EAEA,IAArBJ,EAAQG,QAAQ,GAEzB1C,EAAiBuC,EAASC,GAC1B,IAAI,CAACI,KAAK,CAACL,EAASC,IAExB,CACF,CAGI,AAAC9C,EAAMmD,OAAO,EAChBnD,CAAAA,EAAMmD,OAAO,CAAG,IAAIC,GAAAA,EAEtBpD,EAAMmD,OAAO,CAACE,GAAG,CAAC,IAAI,CAACzD,IAAI,CAAE,CAC3BA,KAAM,IAAI,CAACA,IAAI,CACfC,QAAS,IAAI,CAACA,OAAO,CACrBC,YAAa,IAAI,CAACA,WAAW,CAC7BG,QAAAA,CACF,GAGAD,EAAMsD,uBAAuB,CAAGhD,CAClC,EAOAiD,UAAUvD,CAAK,EAETA,EAAMyC,QAAQ,EAAIzC,EAAMyC,QAAQ,CAACG,kBAAkB,GACrD5C,EAAMyC,QAAQ,CAACE,UAAU,CAAG3C,EAAMyC,QAAQ,CAACG,kBAAkB,CAC7D,OAAO5C,EAAMyC,QAAQ,CAACG,kBAAkB,EAItC5C,EAAMmD,OAAO,EACfnD,EAAMmD,OAAO,CAACK,MAAM,CAAC,IAAI,CAAC5D,IAAI,EAIhC,OAAOI,EAAMsD,uBAAuB,AACtC,CACF"}