/*! Eleva v1.0.0-rc.7 | MIT License | https://elevajs.com */
var e,t;e=this,t=function(){"use strict";function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},e.apply(null,arguments)}class t{static parse(e,t){return"string"!=typeof e?e:e.replace(this.expressionPattern,(e,n)=>this.evaluate(n,t))}static evaluate(e,t){if("string"!=typeof e)return e;try{return new Function("data",`with(data) { return ${e}; }`)(t)}catch(e){return""}}}t.expressionPattern=/\{\{\s*(.*?)\s*\}\}/g;class n{constructor(e){this._value=e,this._watchers=new Set,this._pending=!1}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this._notify())}watch(e){return this._watchers.add(e),()=>this._watchers.delete(e)}_notify(){this._pending||(this._pending=!0,queueMicrotask(()=>{this._watchers.forEach(e=>e(this._value)),this._pending=!1}))}}class s{constructor(){this._events=new Map}on(e,t){return this._events.has(e)||this._events.set(e,new Set),this._events.get(e).add(t),()=>this.off(e,t)}off(e,t){if(this._events.has(e))if(t){const n=this._events.get(e);n.delete(t),0===n.size&&this._events.delete(e)}else this._events.delete(e)}emit(e,...t){this._events.has(e)&&this._events.get(e).forEach(e=>e(...t))}}class o{constructor(){this._tempContainer=document.createElement("div")}patchDOM(e,t){if(!(e instanceof HTMLElement))throw new TypeError("Container must be an HTMLElement");if("string"!=typeof t)throw new TypeError("newHtml must be a string");try{this._tempContainer.innerHTML=t,this._diff(e,this._tempContainer)}catch(e){throw new Error(`Failed to patch DOM: ${e.message}`)}}_diff(e,t){if(e===t||null!=e.isEqualNode&&e.isEqualNode(t))return;const n=Array.from(e.childNodes),s=Array.from(t.childNodes);let o=0,i=0,r=n.length-1,a=s.length-1,c=null;for(;o<=r&&i<=a;){let t=n[o],a=s[i];if(t)if(this._isSameNode(t,a))this._patchNode(t,a),o++,i++;else{c||(c=this._createKeyMap(n,o,r));const s=this._getNodeKey(a),l=s?c.get(s):null;l?(this._patchNode(l,a),e.insertBefore(l,t),n[n.indexOf(l)]=null):e.insertBefore(a.cloneNode(!0),t),i++}else t=n[++o]}if(o>r){const t=s[a+1]?n[o]:null;for(let n=i;n<=a;n++)s[n]&&e.insertBefore(s[n].cloneNode(!0),t)}else if(i>a)for(let t=o;t<=r;t++)n[t]&&this._removeNode(e,n[t])}_patchNode(e,t){null!=e&&e._eleva_instance||(this._isSameNode(e,t)?e.nodeType===Node.ELEMENT_NODE?(this._updateAttributes(e,t),this._diff(e,t)):e.nodeType===Node.TEXT_NODE&&e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.replaceWith(t.cloneNode(!0)))}_removeNode(e,t){"STYLE"===t.nodeName&&t.hasAttribute("data-e-style")||e.removeChild(t)}_updateAttributes(e,t){const n=e.attributes,s=t.attributes;for(let t=0;t<s.length;t++){const{name:n,value:o}=s[t];n.startsWith("@")||e.getAttribute(n)!==o&&e.setAttribute(n,o)}for(let s=n.length-1;s>=0;s--){const o=n[s].name;t.hasAttribute(o)||e.removeAttribute(o)}}_isSameNode(e,t){if(!e||!t)return!1;const n=e.nodeType===Node.ELEMENT_NODE?e.getAttribute("key"):null,s=t.nodeType===Node.ELEMENT_NODE?t.getAttribute("key"):null;return n&&s?n===s:!n&&!s&&e.nodeType===t.nodeType&&e.nodeName===t.nodeName}_createKeyMap(e,t,n){const s=new Map;for(let o=t;o<=n;o++){const t=e[o],n=this._getNodeKey(t);n&&s.set(n,t)}return s}_getNodeKey(e){return(null==e?void 0:e.nodeType)===Node.ELEMENT_NODE?e.getAttribute("key"):null}}return class{constructor(e,t={}){this.name=e,this.config=t,this.emitter=new s,this.signal=n,this.renderer=new o,this._components=new Map,this._plugins=new Map,this._isMounted=!1,this._componentCounter=0}use(e,t={}){this._plugins.set(e.name,e);const n=e.install(this,t);return void 0!==n?n:this}component(e,t){return this._components.set(e,t),this}async mount(s,o,i={}){if(!s)throw new Error(`Container not found: ${s}`);if(s._eleva_instance)return s._eleva_instance;const r="string"==typeof o?this._components.get(o):o;if(!r)throw new Error(`Component "${o}" not registered.`);const a="c"+ ++this._componentCounter,{setup:c,template:l,style:u,children:h}=r,d={props:i,emitter:this.emitter,signal:e=>new this.signal(e)},f="function"==typeof c?await c(d):{};return await(async o=>{const i=e({},d,o),r=[],c=[],f=[];this._isMounted?await(null==i.onBeforeUpdate?void 0:i.onBeforeUpdate({container:s,context:i})):await(null==i.onBeforeMount?void 0:i.onBeforeMount({container:s,context:i}));const p=async()=>{const e="function"==typeof l?await l(i):l,n=t.parse(e,i);this.renderer.patchDOM(s,n),this._processEvents(s,i,f),u&&this._injectStyles(s,a,u,i),h&&await this._mountComponents(s,h,c),this._isMounted?await(null==i.onUpdate?void 0:i.onUpdate({container:s,context:i})):(await(null==i.onMount?void 0:i.onMount({container:s,context:i})),this._isMounted=!0)};for(const e of Object.values(o))e instanceof n&&r.push(e.watch(p));await p();const _={container:s,data:i,unmount:async()=>{await(null==i.onUnmount?void 0:i.onUnmount({container:s,context:i,cleanup:{watchers:r,listeners:f,children:c}}));for(const e of r)e();for(const e of f)e();for(const e of c)await e.unmount();s.innerHTML="",delete s._eleva_instance}};return s._eleva_instance=_,_})(f)}_processEvents(e,n,s){const o=e.querySelectorAll("*");for(const e of o){const o=e.attributes;for(let i=0;i<o.length;i++){const r=o[i];if(!r.name.startsWith("@"))continue;const a=r.name.slice(1),c=r.value,l=n[c]||t.evaluate(c,n);"function"==typeof l&&(e.addEventListener(a,l),e.removeAttribute(r.name),s.push(()=>e.removeEventListener(a,l)))}}}_injectStyles(e,n,s,o){const i="function"==typeof s?t.parse(s(o),o):s;let r=e.querySelector(`style[data-e-style="${n}"]`);r&&r.textContent===i||(r||(r=document.createElement("style"),r.setAttribute("data-e-style",n),e.appendChild(r)),r.textContent=i)}_extractProps(e){if(!e.attributes)return{};const t={},n=e.attributes;for(let s=n.length-1;s>=0;s--){const o=n[s];o.name.startsWith(":")&&(t[o.name.slice(1)]=o.value,e.removeAttribute(o.name))}return t}async _mountComponents(e,t,n){for(const[s,o]of Object.entries(t))if(s)for(const t of e.querySelectorAll(s)){if(!(t instanceof HTMLElement))continue;const e=this._extractProps(t),s=await this.mount(t,o,e);s&&!n.includes(s)&&n.push(s)}}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Eleva=t();
//# sourceMappingURL=eleva.umd.min.js.map
