/*! Eleva v1.2.18-beta | MIT License | https://elevajs.com */
var e,t;e=this,t=function(){"use strict";class e{static expressionPattern=/\{\{\s*(.*?)\s*\}\}/g;static parse(e,t){return"string"!=typeof e?e:e.replace(this.expressionPattern,((e,n)=>this.evaluate(n,t)))}static evaluate(e,t){if("string"!=typeof e)return e;try{return new Function("data",`with(data) { return ${e}; }`)(t)}catch{return""}}}class t{constructor(e){this._value=e,this._watchers=new Set,this._pending=!1}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this._notify())}watch(e){return this._watchers.add(e),()=>this._watchers.delete(e)}_notify(){this._pending||(this._pending=!0,queueMicrotask((()=>{this._watchers.forEach((e=>e(this._value))),this._pending=!1})))}}class n{constructor(){this._events=new Map}on(e,t){return this._events.has(e)||this._events.set(e,new Set),this._events.get(e).add(t),()=>this.off(e,t)}off(e,t){if(this._events.has(e))if(t){const n=this._events.get(e);n.delete(t),0===n.size&&this._events.delete(e)}else this._events.delete(e)}emit(e,...t){this._events.has(e)&&this._events.get(e).forEach((e=>e(...t)))}}const s=/-([a-z])/g;class o{constructor(){this._tempContainer=document.createElement("div")}patchDOM(e,t){if(!(e instanceof HTMLElement))throw new TypeError("Container must be an HTMLElement");if("string"!=typeof t)throw new TypeError("newHtml must be a string");try{this._tempContainer.innerHTML=t,this._diff(e,this._tempContainer)}catch(e){throw new Error(`Failed to patch DOM: ${e.message}`)}}_diff(e,t){if(e===t||e.isEqualNode?.(t))return;const n=Array.from(e.childNodes),s=Array.from(t.childNodes);let o=0,i=0,r=n.length-1,a=s.length-1,c=null;for(;o<=r&&i<=a;){let t=n[o],a=s[i];if(t)if(a)if(this._keysMatch(t,a))this._patchNode(t,a),o++,i++;else{c??=this._createKeyMap(n,o,r);const s=a.nodeType===Node.ELEMENT_NODE?a.getAttribute("key"):null,l=s?c.get(s):void 0,u=void 0!==l?n[l]:null;u?(this._patchNode(u,a),e.insertBefore(u,t),void 0!==l&&(n[l]=null)):e.insertBefore(a.cloneNode(!0),t),i++}else i++;else o++}if(o>r){const t=s[a+1]?n[o]:null;for(let n=i;n<=a;n++)s[n]&&e.insertBefore(s[n].cloneNode(!0),t)}else if(i>a)for(let t=o;t<=r;t++){const s=n[t];!s||"STYLE"===s.nodeName&&s.hasAttribute("data-e-style")||e.removeChild(s)}}_keysMatch(e,t){return e.nodeType!==Node.ELEMENT_NODE||e.getAttribute("key")===t.getAttribute("key")}_patchNode(e,t){if(!e?._eleva_instance)if(e.nodeType===t.nodeType&&e.nodeName===t.nodeName)if(e.nodeType===Node.ELEMENT_NODE){const n=e,s=t;this._updateAttributes(n,s),this._diff(n,s)}else e.nodeType===Node.TEXT_NODE&&e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue);else e.replaceWith(t.cloneNode(!0))}_updateAttributes(e,t){const n=e.attributes,o=t.attributes;for(let t=0;t<o.length;t++){const{name:n,value:i}=o[t];if("@"!==n[0]&&e.getAttribute(n)!==i)if(e.setAttribute(n,i),"a"===n[0]&&"-"===n[4])e["aria"+n.slice(5).replace(s,((e,t)=>t.toUpperCase()))]=i;else if("d"===n[0]&&"-"===n[3])e.dataset[n.slice(5)]=i;else{const t=n.includes("-")?n.replace(s,((e,t)=>t.toUpperCase())):n;if(t in e){const n=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t),s="boolean"==typeof e[t]||n?.get&&"boolean"==typeof n.get.call(e);e[t]=s?"false"!==i&&(""===i||i===t||"true"===i):i}}}for(let s=n.length-1;s>=0;s--){const o=n[s].name;t.hasAttribute(o)||e.removeAttribute(o)}}_createKeyMap(e,t,n){const s=new Map;for(let o=t;o<=n;o++){const t=e[o];if(t?.nodeType===Node.ELEMENT_NODE){const e=t.getAttribute("key");e&&s.set(e,o)}}return s}}return class{constructor(e,s={}){this.name=e,this.config=s,this.emitter=new n,this.signal=t,this.renderer=new o,this._components=new Map,this._plugins=new Map,this._isMounted=!1}use(e,t={}){return e.install(this,t),this._plugins.set(e.name,e),this}component(e,t){return this._components.set(e,t),this}async mount(n,s,o={}){if(!n)throw new Error(`Container not found: ${n}`);if(n._eleva_instance)return n._eleva_instance;const i="string"==typeof s?this._components.get(s):s;if(!i)throw new Error(`Component "${s}" not registered.`);const{setup:r,template:a,style:c,children:l}=i,u={props:o,emitter:this.emitter,signal:e=>new this.signal(e)},h="function"==typeof r?await r(u):{};return await(async o=>{const i={...u,...o},r=[],h=[],f=[];this._isMounted?await(i.onBeforeUpdate?.({container:n,context:i})):await(i.onBeforeMount?.({container:n,context:i}));const d=async()=>{const t="function"==typeof a?await a(i):a,o=e.parse(t,i);this.renderer.patchDOM(n,o),this._processEvents(n,i,f),c&&this._injectStyles(n,s,c,i),l&&await this._mountComponents(n,l,h),this._isMounted?await(i.onUpdate?.({container:n,context:i})):(await(i.onMount?.({container:n,context:i})),this._isMounted=!0)};for(const e of Object.values(o))e instanceof t&&r.push(e.watch(d));await d();const p={container:n,data:i,unmount:async()=>{await(i.onUnmount?.({container:n,context:i,cleanup:{watchers:r,listeners:f,children:h}}));for(const e of r)e();for(const e of f)e();for(const e of h)await e.unmount();n.innerHTML="",delete n._eleva_instance}};return n._eleva_instance=p,p})(h)}_processEvents(t,n,s){const o=t.querySelectorAll("*");for(const t of o){const o=t.attributes;for(let i=0;i<o.length;i++){const r=o[i];if(!r.name.startsWith("@"))continue;const a=r.name.slice(1),c=r.value,l=n[c]||e.evaluate(c,n);"function"==typeof l&&(t.addEventListener(a,l),t.removeAttribute(r.name),s.push((()=>t.removeEventListener(a,l))))}}}_injectStyles(t,n,s,o){const i="function"==typeof s?e.parse(s(o),o):s;let r=t.querySelector(`style[data-e-style="${n}"]`);r&&r.textContent===i||(r||(r=document.createElement("style"),r.setAttribute("data-e-style",n),t.appendChild(r)),r.textContent=i)}_extractProps(e,t){const n={};for(const{name:s,value:o}of e.attributes)s.startsWith(t)&&(n[s.replace(t,"")]=o);return n}async _mountComponents(e,t,n){for(const[s,o]of Object.entries(t))if(s)for(const t of e.querySelectorAll(s)){if(!(t instanceof HTMLElement))continue;const e=this._extractProps(t,":"),s=await this.mount(t,o,e);s&&!n.includes(s)&&n.push(s)}}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Eleva=t();
//# sourceMappingURL=eleva.umd.min.js.map
