/*! Eleva v1.2.8-alpha | MIT License | https://elevajs.com */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Eleva=t()}(this,(function(){"use strict";class e{static expressionPattern=/\{\{\s*(.*?)\s*\}\}/g;static parse(e,t){return"string"!=typeof e?e:e.replace(this.expressionPattern,((e,n)=>this.evaluate(n,t)))}static evaluate(e,t){if("string"!=typeof e)return e;try{return new Function("data",`with(data) { return ${e}; }`)(t)}catch{return""}}}class t{constructor(e){this._value=e,this._watchers=new Set,this._pending=!1}get value(){return this._value}set value(e){e!==this._value&&(this._value=e,this._notifyWatchers())}watch(e){return this._watchers.add(e),()=>this._watchers.delete(e)}_notifyWatchers(){this._pending||(this._pending=!0,queueMicrotask((()=>{this._pending=!1,this._watchers.forEach((e=>e(this._value)))})))}}class n{constructor(){this._events=new Map}on(e,t){return this._events.has(e)||this._events.set(e,new Set),this._events.get(e).add(t),()=>this.off(e,t)}off(e,t){if(this._events.has(e))if(t){const n=this._events.get(e);n.delete(t),0===n.size&&this._events.delete(e)}else this._events.delete(e)}emit(e,...t){this._events.has(e)&&this._events.get(e).forEach((e=>e(...t)))}}class s{patchDOM(e,t){if(!(e instanceof HTMLElement))throw new Error("Container must be an HTMLElement");if("string"!=typeof t)throw new Error("newHtml must be a string");const n=document.createElement("div");n.innerHTML=t,this.diff(e,n),n.innerHTML=""}diff(e,t){if(!(e instanceof HTMLElement&&t instanceof HTMLElement))throw new Error("Both parents must be HTMLElements");if(e.isEqualNode(t))return;const n=e.childNodes,s=t.childNodes,o=Math.max(n.length,s.length),i=[];for(let t=0;t<o;t++){const o=n[t],r=s[t];if(!o&&r){i.push((()=>e.appendChild(r.cloneNode(!0))));continue}if(o&&!r){i.push((()=>e.removeChild(o)));continue}if(o.nodeType===r.nodeType&&o.nodeName===r.nodeName)if(o.nodeType===Node.ELEMENT_NODE){const t=o.getAttribute("key"),n=r.getAttribute("key");if(t!==n&&(t||n)){i.push((()=>e.replaceChild(r.cloneNode(!0),o)));continue}this.updateAttributes(o,r),this.diff(o,r)}else o.nodeType===Node.TEXT_NODE&&o.nodeValue!==r.nodeValue&&(o.nodeValue=r.nodeValue);else i.push((()=>e.replaceChild(r.cloneNode(!0),o)))}i.length&&i.forEach((e=>e()))}updateAttributes(e,t){if(!(e instanceof HTMLElement&&t instanceof HTMLElement))throw new Error("Both elements must be HTMLElements");const n=e.attributes,s=t.attributes,o=[];for(const{name:s}of n)s.startsWith("@")||t.hasAttribute(s)||o.push((()=>e.removeAttribute(s)));for(const t of s){const{name:n,value:s}=t;n.startsWith("@")||e.getAttribute(n)!==s&&o.push((()=>{if(e.setAttribute(n,s),n.startsWith("aria-")){const t="aria"+n.slice(5).replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));e[t]=s}else if(n.startsWith("data-"))e.dataset[n.slice(5)]=s;else{const t=n.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));if(t in e){const n=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t),o="boolean"==typeof e[t]||n?.get&&"boolean"==typeof n.get.call(e);e[t]=o?"false"!==s&&(""===s||s===t||"true"===s):s}}}))}o.length&&o.forEach((e=>e()))}}return class{constructor(e,o={}){this.name=e,this.config=o,this.emitter=new n,this.signal=t,this.renderer=new s,this._components=new Map,this._plugins=new Map,this._lifecycleHooks=["onBeforeMount","onMount","onBeforeUpdate","onUpdate","onUnmount"],this._isMounted=!1}use(e,t={}){return e.install(this,t),this._plugins.set(e.name,e),this}component(e,t){return this._components.set(e,t),this}async mount(n,s,o={}){if(!n)throw new Error(`Container not found: ${n}`);const i="string"==typeof s?this._components.get(s):s;if(!i)throw new Error(`Component "${s}" not registered.`);if("function"!=typeof i.template)throw new Error("Component template must be a function");const{setup:r,template:a,style:c,children:l}=i,h={props:o,emitter:this.emitter,signal:e=>new this.signal(e),...this._prepareLifecycleHooks()};return Promise.resolve("function"==typeof r?r(h):{}).then((o=>{const i={...h,...o},r=[],u=[],f=[];this._isMounted?i.onBeforeUpdate&&i.onBeforeUpdate():i.onBeforeMount&&i.onBeforeMount();const p=()=>{const t=e.parse(a(i),i);this.renderer.patchDOM(n,t),this._processEvents(n,i,f),this._injectStyles(n,s,c,i),this._mountChildren(n,l,u),this._isMounted?i.onUpdate&&i.onUpdate():(i.onMount&&i.onMount(),this._isMounted=!0)};for(const e of Object.values(o))e instanceof t&&r.push(e.watch(p));return p(),{container:n,data:i,unmount:()=>{for(const e of r)e();for(const e of f)e();for(const e of u)e.unmount();i.onUnmount&&i.onUnmount(),n.innerHTML=""}}}))}_prepareLifecycleHooks(){const e={};for(const t of this._lifecycleHooks)e[t]=()=>{};return e}_processEvents(t,n,s){const o=t.querySelectorAll("*");for(const t of o){const o=t.attributes;for(let i=0;i<o.length;i++){const r=o[i];if(r.name.startsWith("@")){const o=r.name.slice(1),i=e.evaluate(r.value,n);"function"==typeof i&&(t.addEventListener(o,i),t.removeAttribute(r.name),s.push((()=>t.removeEventListener(o,i))))}}}}_injectStyles(t,n,s,o){if(!s)return;let i=t.querySelector(`style[data-eleva-style="${n}"]`);i||(i=document.createElement("style"),i.setAttribute("data-eleva-style",n),t.appendChild(i)),i.textContent=e.parse(s(o),o)}async _mountChildren(e,t,n){for(const e of n)e.unmount();if(n.length=0,t)for(const s of Object.keys(t))if(s)for(const o of e.querySelectorAll(s)){if(!(o instanceof HTMLElement))continue;const e={};for(const{name:t,value:n}of[...o.attributes])t.startsWith("eleva-prop-")&&(e[t.replace("eleva-prop-","")]=n);const i=await this.mount(o,t[s],e);n.push(i)}}}}));
//# sourceMappingURL=eleva.min.js.map
