!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Eleva=t()}(this,(function(){"use strict";class e{static parse(e,t){return e&&"string"==typeof e?e.replace(/\{\{\s*(.*?)\s*\}\}/g,((e,n)=>this.evaluate(n,t))):e}static evaluate(e,t){if(!e||"string"!=typeof e)return e;try{return new Function("data",`with(data) { return ${e} }`)(t)}catch(n){return console.error("Template evaluation error:",{expression:e,data:t,error:n.message}),""}}}class t{constructor(e){this._value=e,this._watchers=new Set,this._pending=!1}get value(){return this._value}set value(e){e!==this._value&&(this._value=e,this._notifyWatchers())}watch(e){return this._watchers.add(e),()=>this._watchers.delete(e)}_notifyWatchers(){this._pending||(this._pending=!0,queueMicrotask((()=>{this._pending=!1,this._watchers.forEach((e=>e(this._value)))})))}}class n{constructor(){this.events={}}on(e,t){(this.events[e]||(this.events[e]=[])).push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter((e=>e!==t)))}emit(e,...t){(this.events[e]||[]).forEach((e=>e(...t)))}}class s{patchDOM(e,t){if(!(e instanceof HTMLElement))throw new Error("Container must be an HTMLElement");if("string"!=typeof t)throw new Error("newHtml must be a string");const n=document.createElement("div");try{n.innerHTML=t,this.diff(e,n)}catch(e){throw new Error(`Failed to patch DOM: ${e.message}`)}finally{n.innerHTML=""}}diff(e,t){if(!(e instanceof HTMLElement&&t instanceof HTMLElement))throw new Error("Both parents must be HTMLElements");if(e.isEqualNode(t))return;const n=Array.from(e.childNodes),s=Array.from(t.childNodes),o=Math.max(n.length,s.length),r=[];for(let t=0;t<o;t++){const o=n[t],i=s[t];if(o||!i)if(!o||i){if(o?.nodeType===Node.ELEMENT_NODE&&i?.nodeType===Node.ELEMENT_NODE){const t=o.getAttribute("key"),n=i.getAttribute("key");if((t||n)&&t!==n){r.push((()=>e.replaceChild(i.cloneNode(!0),o)));continue}}o?.nodeType===i?.nodeType&&o?.nodeName===i?.nodeName?o?.nodeType!==Node.TEXT_NODE?o?.nodeType===Node.ELEMENT_NODE&&(this.updateAttributes(o,i),this.diff(o,i)):o.nodeValue!==i.nodeValue&&(o.nodeValue=i.nodeValue):r.push((()=>e.replaceChild(i.cloneNode(!0),o)))}else r.push((()=>e.removeChild(o)));else r.push((()=>e.appendChild(i.cloneNode(!0))))}r.forEach((e=>e()))}updateAttributes(e,t){if(!(e instanceof HTMLElement&&t instanceof HTMLElement))throw new Error("Both elements must be HTMLElements");const n={value:!0,checked:!0,selected:!0,disabled:!0,readOnly:!0,multiple:!0},s=[];Array.from(e.attributes).forEach((n=>{n.name.startsWith("@")||t.hasAttribute(n.name)||s.push((()=>e.removeAttribute(n.name)))})),Array.from(t.attributes).forEach((t=>{t.name.startsWith("@")||e.getAttribute(t.name)!==t.value&&s.push((()=>{e.setAttribute(t.name,t.value);const s=t.name.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));if(n[s])e[s]=""===t.value||t.value;else if(t.name.startsWith("aria-")){const n="aria"+t.name.slice(5).replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));e[n]=t.value}else if(t.name.startsWith("data-")){const n=t.name.slice(5);e.dataset[n]=t.value}else s in e&&(e[s]=t.value)}))})),s.forEach((e=>e()))}}return class{constructor(e,t={}){this.name=e,this.config=t,this._components={},this._plugins=[],this._lifecycleHooks=["onBeforeMount","onMount","onBeforeUpdate","onUpdate","onUnmount"],this._isMounted=!1,this.emitter=new n,this.renderer=new s}use(e,t={}){return"function"==typeof e.install&&e.install(this,t),this._plugins.push(e),this}component(e,t){return this._components[e]=t,this}mount(n,s,o={}){if(!n)throw new Error(`Container not found: ${n}`);const r="string"==typeof s?this._components[s]:s;if(!r)throw new Error(`Component "${s}" not registered.`);if("function"!=typeof r.template)throw new Error("Component template must be a function");const{setup:i,template:a,style:l,children:u}=r,c={props:o,emitter:this.emitter,signal:e=>new t(e),...this._prepareLifecycleHooks()};return Promise.resolve("function"==typeof i?i(c):{}).then((o=>{const r={...c,...o},i=[],h=[],f=[];this._isMounted?r.onBeforeUpdate&&r.onBeforeUpdate():r.onBeforeMount&&r.onBeforeMount();const p=()=>{const t=e.parse(a(r),r);this.renderer.patchDOM(n,t),this._processEvents(n,r,f),this._injectStyles(n,s,l,r),this._mountChildren(n,u,h),this._isMounted?r.onUpdate&&r.onUpdate():(r.onMount&&r.onMount(),this._isMounted=!0)};return Object.values(o).forEach((e=>{e instanceof t&&i.push(e.watch(p))})),p(),{container:n,data:r,unmount:()=>{i.forEach((e=>e())),f.forEach((e=>e())),h.forEach((e=>e.unmount())),r.onUnmount&&r.onUnmount(),n.innerHTML=""}}}))}_prepareLifecycleHooks(){return this._lifecycleHooks.reduce(((e,t)=>(e[t]=()=>{},e)),{})}_processEvents(t,n,s){const o=t.querySelectorAll("*");for(const t of o){const o=t.attributes;for(let r=0;r<o.length;r++){const i=o[r];if(i.name.startsWith("@")){const o=i.name.slice(1),r=e.evaluate(i.value,n);"function"==typeof r&&(t.addEventListener(o,r),t.removeAttribute(i.name),s.push((()=>t.removeEventListener(o,r))))}}}}_injectStyles(t,n,s,o){if(!s)return;let r=t.querySelector(`style[data-eleva-style="${n}"]`);r||(r=document.createElement("style"),r.setAttribute("data-eleva-style",n),t.appendChild(r)),r.textContent=e.parse(s(o),o)}_mountChildren(e,t,n){n.forEach((e=>e.unmount())),n.length=0,Object.keys(t||{}).forEach((s=>{e.querySelectorAll(s).forEach((e=>{const o={};[...e.attributes].forEach((({name:e,value:t})=>{e.startsWith("eleva-prop-")&&(o[e.replace("eleva-prop-","")]=t)}));const r=this.mount(e,t[s],o);n.push(r)}))}))}}}));
//# sourceMappingURL=eleva.min.js.map
