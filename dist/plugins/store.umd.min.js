/*! Eleva Store Plugin v1.0.0-rc.1 | MIT License | https://elevajs.com */
var t,e;t=this,e=function(t){"use strict";t.StorePlugin={name:"store",version:"1.0.0-rc.1",description:"Reactive state management for sharing data across the entire Eleva application",install(t,e={}){const{state:s={},actions:i={},namespaces:n={},persistence:o={},devTools:a=!1,onError:r=null}=e,c=new class{constructor(){this.state={},this.actions={},this.subscribers=new Set,this.mutations=[],this.persistence={enabled:!1,key:"eleva-store",storage:"localStorage",include:null,exclude:null,...o},this.devTools=a,this.onError=r,this._initializeState(s,i),this._initializeNamespaces(n),this._loadPersistedState(),this._setupDevTools()}_initializeState(e,s){Object.entries(e).forEach(([e,s])=>{this.state[e]=new t.signal(s)}),this.actions={...s}}_initializeNamespaces(e){Object.entries(e).forEach(([e,s])=>{const{state:i={},actions:n={}}=s;this.state[e]||(this.state[e]={}),this.actions[e]||(this.actions[e]={}),Object.entries(i).forEach(([s,i])=>{this.state[e][s]=new t.signal(i)}),this.actions[e]={...n}})}_loadPersistedState(){if(this.persistence.enabled&&"undefined"!=typeof window)try{const t=window[this.persistence.storage].getItem(this.persistence.key);if(t){const e=JSON.parse(t);this._applyPersistedData(e)}}catch(t){this.onError&&this.onError(t,"Failed to load persisted state")}}_applyPersistedData(t,e=this.state,s=""){Object.entries(t).forEach(([t,i])=>{const n=s?`${s}.${t}`:t;this._shouldPersist(n)&&(e[t]&&"object"==typeof e[t]&&"value"in e[t]?e[t].value=i:"object"==typeof i&&null!==i&&e[t]&&this._applyPersistedData(i,e[t],n))})}_shouldPersist(t){const{include:e,exclude:s}=this.persistence;return e&&e.length>0?e.some(e=>t.startsWith(e)):!(s&&s.length>0&&s.some(e=>t.startsWith(e)))}_saveState(){if(this.persistence.enabled&&"undefined"!=typeof window)try{const t=window[this.persistence.storage],e=this._extractPersistedData();t.setItem(this.persistence.key,JSON.stringify(e))}catch(t){this.onError&&this.onError(t,"Failed to save state")}}_extractPersistedData(t=this.state,e=""){const s={};return Object.entries(t).forEach(([t,i])=>{const n=e?`${e}.${t}`:t;if(this._shouldPersist(n))if(i&&"object"==typeof i&&"value"in i)s[t]=i.value;else if("object"==typeof i&&null!==i){const e=this._extractPersistedData(i,n);Object.keys(e).length>0&&(s[t]=e)}}),s}_setupDevTools(){this.devTools&&"undefined"!=typeof window&&window.__ELEVA_DEVTOOLS__&&window.__ELEVA_DEVTOOLS__.registerStore(this)}async dispatch(t,e){try{const s=this._getAction(t);if(!s){const e=new Error(`Action "${t}" not found`);throw this.onError&&this.onError(e,t),e}const i={type:t,payload:e,timestamp:Date.now()};this.mutations.push(i),this.mutations.length>100&&this.mutations.shift();const n=await s.call(null,this.state,e);return this._saveState(),this.subscribers.forEach(t=>{try{t(i,this.state)}catch(t){this.onError&&this.onError(t,"Subscriber callback failed")}}),this.devTools&&"undefined"!=typeof window&&window.__ELEVA_DEVTOOLS__&&window.__ELEVA_DEVTOOLS__.notifyMutation(i,this.state),n}catch(e){throw this.onError&&this.onError(e,`Action dispatch failed: ${t}`),e}}_getAction(t){const e=t.split(".");let s=this.actions;for(const t of e){if(void 0===s[t])return null;s=s[t]}return"function"==typeof s?s:null}subscribe(t){if("function"!=typeof t)throw new Error("Subscribe callback must be a function");return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}getState(){return this._extractPersistedData()}replaceState(t){this._applyPersistedData(t),this._saveState()}clearPersistedState(){if(this.persistence.enabled&&"undefined"!=typeof window)try{window[this.persistence.storage].removeItem(this.persistence.key)}catch(t){this.onError&&this.onError(t,"Failed to clear persisted state")}}registerModule(t,e){this.state[t]||this.actions[t]||(this.state[t]={},this.actions[t]={},this._initializeNamespaces({[t]:e}),this._saveState())}unregisterModule(t){(this.state[t]||this.actions[t])&&(delete this.state[t],delete this.actions[t],this._saveState())}},l=t.mount;t.mount=async(e,s,i={})=>{const n="string"==typeof s&&t._components.get(s)||s;if(!n)return await l.call(t,e,s,i);const o={...n,async setup(e){e.store={state:c.state,dispatch:c.dispatch.bind(c),subscribe:c.subscribe.bind(c),getState:c.getState.bind(c),registerModule:c.registerModule.bind(c),unregisterModule:c.unregisterModule.bind(c),createState:(e,s)=>(c.state[e]||(c.state[e]=new t.signal(s)),c.state[e]),createAction:(t,e)=>{c.actions[t]=e},signal:t.signal};const s=n.setup;return s?await s(e):{}}};return await l.call(t,e,o,i)};const h=t._mountComponents;t._mountComponents=async(e,s,i)=>{const n={};for(const[e,i]of Object.entries(s)){const s="string"==typeof i&&t._components.get(i)||i;n[e]=s&&"object"==typeof s?{...s,async setup(e){e.store={state:c.state,dispatch:c.dispatch.bind(c),subscribe:c.subscribe.bind(c),getState:c.getState.bind(c),registerModule:c.registerModule.bind(c),unregisterModule:c.unregisterModule.bind(c),createState:(e,s)=>(c.state[e]||(c.state[e]=new t.signal(s)),c.state[e]),createAction:(t,e)=>{c.actions[t]=e},signal:t.signal};const i=s.setup;return i?await i(e):{}}}:i}return await h.call(t,e,n,i)},t.store=c,t.createAction=(t,e)=>{c.actions[t]=e},t.dispatch=(t,e)=>c.dispatch(t,e),t.getState=()=>c.getState(),t.subscribe=t=>c.subscribe(t),t._originalMount=l,t._originalMountComponents=h},uninstall(t){t._originalMount&&(t.mount=t._originalMount,delete t._originalMount),t._originalMountComponents&&(t._mountComponents=t._originalMountComponents,delete t._originalMountComponents),t.store&&delete t.store,t.createAction&&delete t.createAction,t.dispatch&&delete t.dispatch,t.getState&&delete t.getState,t.subscribe&&delete t.subscribe}}},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ElevaStorePlugin={});
//# sourceMappingURL=store.umd.min.js.map
