!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Eleva=e()}(this,(function(){"use strict";class t{static parse(t,e){return t&&"string"==typeof t?t.replace(/\{\{\s*(.*?)\s*\}\}/g,((t,n)=>this.evaluate(n,e))):t}static evaluate(t,e){if(!t||"string"!=typeof t)return t;try{return Function("data",`with(data) { return ${t} }`)(e)}catch(n){return console.error("Template evaluation error:",{expression:t,data:e,error:n.message}),""}}}class e{constructor(t){this.t=t,this.o=new Set,this.i=!1}get value(){return this.t}set value(t){t!==this.t&&(this.t=t,this.h())}watch(t){return this.o.add(t),()=>this.o.delete(t)}h(){this.i||(this.i=!0,queueMicrotask((()=>{this.i=!1,this.o.forEach((t=>t(this.t)))})))}}class n{constructor(){this.events={}}on(t,e){(this.events[t]||(this.events[t]=[])).push(e)}off(t,e){this.events[t]&&(this.events[t]=this.events[t].filter((t=>t!==e)))}emit(t,...e){(this.events[t]||[]).forEach((t=>t(...e)))}}class s{patchDOM(t,e){if(!(t instanceof HTMLElement))throw Error("Container must be an HTMLElement");if("string"!=typeof e)throw Error("newHtml must be a string");const n=document.createElement("div");n.innerHTML=e,this.diff(t,n),n.innerHTML=""}diff(t,e){if(!(t instanceof HTMLElement&&e instanceof HTMLElement))throw Error("Both parents must be HTMLElements");if(t.isEqualNode(e))return;const n=t.childNodes,s=e.childNodes,o=Math.max(n.length,s.length),i=[];for(let e=0;o>e;e++){const o=n[e],r=s[e];if(!o&&r){i.push((()=>t.appendChild(r.cloneNode(!0))));continue}if(o&&!r){i.push((()=>t.removeChild(o)));continue}if(o.nodeType===r.nodeType&&o.nodeName===r.nodeName)if(o.nodeType===Node.ELEMENT_NODE){const e=o.getAttribute("key"),n=r.getAttribute("key");if(e!==n&&(e||n)){i.push((()=>t.replaceChild(r.cloneNode(!0),o)));continue}this.updateAttributes(o,r),this.diff(o,r)}else o.nodeType===Node.TEXT_NODE&&o.nodeValue!==r.nodeValue&&(o.nodeValue=r.nodeValue);else i.push((()=>t.replaceChild(r.cloneNode(!0),o)))}i.length&&i.forEach((t=>t()))}updateAttributes(t,e){if(!(t instanceof HTMLElement&&e instanceof HTMLElement))throw Error("Both elements must be HTMLElements");const n=t.attributes,s=e.attributes,o=[];for(const{name:s}of n)s.startsWith("@")||e.hasAttribute(s)||o.push((()=>t.removeAttribute(s)));for(const e of s){const{name:n,value:s}=e;n.startsWith("@")||t.getAttribute(n)!==s&&o.push((()=>{if(t.setAttribute(n,s),n.startsWith("aria-")){const e="aria"+n.slice(5).replace(/-([a-z])/g,((t,e)=>e.toUpperCase()));t[e]=s}else if(n.startsWith("data-"))t.dataset[n.slice(5)]=s;else{const e=n.replace(/-([a-z])/g,((t,e)=>e.toUpperCase()));if(e in t){const n=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),e),o="boolean"==typeof t[e]||n?.get&&"boolean"==typeof n.get.call(t);t[e]=o?"false"!==s&&(""===s||s===e||"true"===s):s}}}))}o.length&&o.forEach((t=>t()))}}return class{constructor(t,e={}){this.name=t,this.config=e,this.u={},this.l=[],this.p=["onBeforeMount","onMount","onBeforeUpdate","onUpdate","onUnmount"],this.m=!1,this.emitter=new n,this.renderer=new s}use(t,e={}){return"function"==typeof t.install&&t.install(this,e),this.l.push(t),this}component(t,e){return this.u[t]=e,this}mount(n,s,o={}){if(!n)throw Error("Container not found: "+n);const i="string"==typeof s?this.u[s]:s;if(!i)throw Error(`Component "${s}" not registered.`);if("function"!=typeof i.template)throw Error("Component template must be a function");const{setup:r,template:c,style:a,children:f}=i,h={props:o,emitter:this.emitter,signal:t=>new e(t),...this.M()};return Promise.resolve("function"==typeof r?r(h):{}).then((o=>{const i={...h,...o},r=[],u=[],l=[];this.m?i.onBeforeUpdate&&i.onBeforeUpdate():i.onBeforeMount&&i.onBeforeMount();const p=()=>{const e=t.parse(c(i),i);this.renderer.patchDOM(n,e),this.v(n,i,l),this.T(n,s,a,i),this.H(n,f,u),this.m?i.onUpdate&&i.onUpdate():(i.onMount&&i.onMount(),this.m=!0)};return Object.values(o).forEach((t=>{t instanceof e&&r.push(t.watch(p))})),p(),{container:n,data:i,unmount:()=>{r.forEach((t=>t())),l.forEach((t=>t())),u.forEach((t=>t.unmount())),i.onUnmount&&i.onUnmount(),n.innerHTML=""}}}))}M(){return this.p.reduce(((t,e)=>(t[e]=()=>{},t)),{})}v(e,n,s){const o=e.querySelectorAll("*");for(const e of o){const o=e.attributes;for(let i=0;o.length>i;i++){const r=o[i];if(r.name.startsWith("@")){const o=r.name.slice(1),i=t.evaluate(r.value,n);"function"==typeof i&&(e.addEventListener(o,i),e.removeAttribute(r.name),s.push((()=>e.removeEventListener(o,i))))}}}}T(e,n,s,o){if(!s)return;let i=e.querySelector(`style[data-eleva-style="${n}"]`);i||(i=document.createElement("style"),i.setAttribute("data-eleva-style",n),e.appendChild(i)),i.textContent=t.parse(s(o),o)}H(t,e,n){n.forEach((t=>t.unmount())),n.length=0,Object.keys(e||{}).forEach((s=>{t.querySelectorAll(s).forEach((t=>{const o={};[...t.attributes].forEach((({name:t,value:e})=>{t.startsWith("eleva-prop-")&&(o[t.replace("eleva-prop-","")]=e)}));const i=this.mount(t,e[s],o);n.push(i)}))}))}}}));
//# sourceMappingURL=eleva.min.js.map
