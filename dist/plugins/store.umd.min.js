/*! Eleva Store Plugin v1.0.0-rc.1 | MIT License | https://elevajs.com */
var t,e;t=this,e=function(t){"use strict";function e(){return e=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)({}).hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},e.apply(null,arguments)}t.StorePlugin={name:"store",version:"1.0.0-rc.1",description:"Reactive state management for sharing data across the entire Eleva application",install(t,s={}){const{state:i={},actions:n={},namespaces:o={},persistence:a={},devTools:r=!1,onError:c=null}=s,l=new class{constructor(){this.state={},this.actions={},this.subscribers=new Set,this.mutations=[],this.persistence=e({enabled:!1,key:"eleva-store",storage:"localStorage",include:null,exclude:null},a),this.devTools=r,this.onError=c,this._initializeState(i,n),this._initializeNamespaces(o),this._loadPersistedState(),this._setupDevTools()}_initializeState(s,i){Object.entries(s).forEach(([e,s])=>{this.state[e]=new t.signal(s)}),this.actions=e({},i)}_initializeNamespaces(s){Object.entries(s).forEach(([s,i])=>{const{state:n={},actions:o={}}=i;this.state[s]||(this.state[s]={}),this.actions[s]||(this.actions[s]={}),Object.entries(n).forEach(([e,i])=>{this.state[s][e]=new t.signal(i)}),this.actions[s]=e({},o)})}_loadPersistedState(){if(this.persistence.enabled&&"undefined"!=typeof window)try{const t=window[this.persistence.storage].getItem(this.persistence.key);if(t){const e=JSON.parse(t);this._applyPersistedData(e)}}catch(t){this.onError&&this.onError(t,"Failed to load persisted state")}}_applyPersistedData(t,e=this.state,s=""){Object.entries(t).forEach(([t,i])=>{const n=s?`${s}.${t}`:t;this._shouldPersist(n)&&(e[t]&&"object"==typeof e[t]&&"value"in e[t]?e[t].value=i:"object"==typeof i&&null!==i&&e[t]&&this._applyPersistedData(i,e[t],n))})}_shouldPersist(t){const{include:e,exclude:s}=this.persistence;return e&&e.length>0?e.some(e=>t.startsWith(e)):!(s&&s.length>0&&s.some(e=>t.startsWith(e)))}_saveState(){if(this.persistence.enabled&&"undefined"!=typeof window)try{const t=window[this.persistence.storage],e=this._extractPersistedData();t.setItem(this.persistence.key,JSON.stringify(e))}catch(t){this.onError&&this.onError(t,"Failed to save state")}}_extractPersistedData(t=this.state,e=""){const s={};return Object.entries(t).forEach(([t,i])=>{const n=e?`${e}.${t}`:t;if(this._shouldPersist(n))if(i&&"object"==typeof i&&"value"in i)s[t]=i.value;else if("object"==typeof i&&null!==i){const e=this._extractPersistedData(i,n);Object.keys(e).length>0&&(s[t]=e)}}),s}_setupDevTools(){this.devTools&&"undefined"!=typeof window&&window.__ELEVA_DEVTOOLS__&&window.__ELEVA_DEVTOOLS__.registerStore(this)}async dispatch(t,e){try{const s=this._getAction(t);if(!s){const e=new Error(`Action "${t}" not found`);throw this.onError&&this.onError(e,t),e}const i={type:t,payload:e,timestamp:Date.now()};this.mutations.push(i),this.mutations.length>100&&this.mutations.shift();const n=await s.call(null,this.state,e);return this._saveState(),this.subscribers.forEach(t=>{try{t(i,this.state)}catch(t){this.onError&&this.onError(t,"Subscriber callback failed")}}),this.devTools&&"undefined"!=typeof window&&window.__ELEVA_DEVTOOLS__&&window.__ELEVA_DEVTOOLS__.notifyMutation(i,this.state),n}catch(e){throw this.onError&&this.onError(e,`Action dispatch failed: ${t}`),e}}_getAction(t){const e=t.split(".");let s=this.actions;for(const t of e){if(void 0===s[t])return null;s=s[t]}return"function"==typeof s?s:null}subscribe(t){if("function"!=typeof t)throw new Error("Subscribe callback must be a function");return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}getState(){return this._extractPersistedData()}replaceState(t){this._applyPersistedData(t),this._saveState()}clearPersistedState(){if(this.persistence.enabled&&"undefined"!=typeof window)try{window[this.persistence.storage].removeItem(this.persistence.key)}catch(t){this.onError&&this.onError(t,"Failed to clear persisted state")}}registerModule(t,e){this.state[t]||this.actions[t]||(this.state[t]={},this.actions[t]={},this._initializeNamespaces({[t]:e}),this._saveState())}unregisterModule(t){(this.state[t]||this.actions[t])&&(delete this.state[t],delete this.actions[t],this._saveState())}createState(e,s){return this.state[e]||(this.state[e]=new t.signal(s),this._saveState()),this.state[e]}createAction(t,e){if("function"!=typeof e)throw new Error("Action must be a function");this.actions[t]=e}},h=t.mount;t.mount=async(s,i,n={})=>{const o="string"==typeof i&&t._components.get(i)||i;if(!o)return await h.call(t,s,i,n);const a=e({},o,{async setup(e){e.store={state:l.state,dispatch:l.dispatch.bind(l),subscribe:l.subscribe.bind(l),getState:l.getState.bind(l),registerModule:l.registerModule.bind(l),unregisterModule:l.unregisterModule.bind(l),createState:l.createState.bind(l),createAction:l.createAction.bind(l),signal:t.signal};const s=o.setup;return s?await s(e):{}}});return await h.call(t,s,a,n)};const d=t._mountComponents;t._mountComponents=async(s,i,n)=>{const o={};for(const[s,n]of Object.entries(i)){const i="string"==typeof n&&t._components.get(n)||n;o[s]=i&&"object"==typeof i?e({},i,{async setup(e){e.store={state:l.state,dispatch:l.dispatch.bind(l),subscribe:l.subscribe.bind(l),getState:l.getState.bind(l),registerModule:l.registerModule.bind(l),unregisterModule:l.unregisterModule.bind(l),createState:l.createState.bind(l),createAction:l.createAction.bind(l),signal:t.signal};const s=i.setup;return s?await s(e):{}}}):n}return await d.call(t,s,o,n)},t.store=l,t.createAction=(t,e)=>{l.actions[t]=e},t.dispatch=(t,e)=>l.dispatch(t,e),t.getState=()=>l.getState(),t.subscribe=t=>l.subscribe(t),t._originalMount=h,t._originalMountComponents=d},uninstall(t){t._originalMount&&(t.mount=t._originalMount,delete t._originalMount),t._originalMountComponents&&(t._mountComponents=t._originalMountComponents,delete t._originalMountComponents),t.store&&delete t.store,t.createAction&&delete t.createAction,t.dispatch&&delete t.dispatch,t.getState&&delete t.getState,t.subscribe&&delete t.subscribe}}},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ElevaStorePlugin={});
//# sourceMappingURL=store.umd.min.js.map
