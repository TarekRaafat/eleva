/*! Eleva v1.2.10-alpha | MIT License | https://elevajs.com */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Eleva=e()}(this,(function(){"use strict";class t{static expressionPattern=/\{\{\s*(.*?)\s*\}\}/g;static parse(t,e){return"string"!=typeof t?t:t.replace(this.expressionPattern,((t,n)=>this.evaluate(n,e)))}static evaluate(t,e){if("string"!=typeof t)return t;try{return new Function("data",`with(data) { return ${t}; }`)(e)}catch{return""}}}class e{constructor(t){this._value=t,this._watchers=new Set,this._pending=!1}get value(){return this._value}set value(t){this._value!==t&&(this._value=t,this._notify())}watch(t){return this._watchers.add(t),()=>this._watchers.delete(t)}_notify(){this._pending||(this._pending=!0,queueMicrotask((()=>{this._watchers.forEach((t=>t(this._value))),this._pending=!1})))}}class n{constructor(){this._events=new Map}on(t,e){return this._events.has(t)||this._events.set(t,new Set),this._events.get(t).add(e),()=>this.off(t,e)}off(t,e){if(this._events.has(t))if(e){const n=this._events.get(t);n.delete(e),0===n.size&&this._events.delete(t)}else this._events.delete(t)}emit(t,...e){this._events.has(t)&&this._events.get(t).forEach((t=>t(...e)))}}class o{patchDOM(t,e){if(!(t instanceof HTMLElement))throw new Error("Container must be an HTMLElement");if("string"!=typeof e)throw new Error("newHtml must be a string");const n=document.createElement("div");n.innerHTML=e,this.diff(t,n),n.innerHTML=""}diff(t,e){if(!(t instanceof HTMLElement&&e instanceof HTMLElement))throw new Error("Both parents must be HTMLElements");if(t.isEqualNode(e))return;const n=t.childNodes,o=e.childNodes,s=Math.max(n.length,o.length),i=[];for(let e=0;e<s;e++){const s=n[e],r=o[e];if(!s&&r){i.push((()=>t.appendChild(r.cloneNode(!0))));continue}if(s&&!r){i.push((()=>t.removeChild(s)));continue}if(s.nodeType===r.nodeType&&s.nodeName===r.nodeName)if(s.nodeType===Node.ELEMENT_NODE){const e=s.getAttribute("key"),n=r.getAttribute("key");if(e!==n&&(e||n)){i.push((()=>t.replaceChild(r.cloneNode(!0),s)));continue}this.updateAttributes(s,r),this.diff(s,r)}else s.nodeType===Node.TEXT_NODE&&s.nodeValue!==r.nodeValue&&(s.nodeValue=r.nodeValue);else i.push((()=>t.replaceChild(r.cloneNode(!0),s)))}i.length&&i.forEach((t=>t()))}updateAttributes(t,e){if(!(t instanceof HTMLElement&&e instanceof HTMLElement))throw new Error("Both elements must be HTMLElements");const n=t.attributes,o=e.attributes,s=[];for(const{name:o}of n)o.startsWith("@")||e.hasAttribute(o)||s.push((()=>t.removeAttribute(o)));for(const e of o){const{name:n,value:o}=e;n.startsWith("@")||t.getAttribute(n)!==o&&s.push((()=>{if(t.setAttribute(n,o),n.startsWith("aria-")){const e="aria"+n.slice(5).replace(/-([a-z])/g,((t,e)=>e.toUpperCase()));t[e]=o}else if(n.startsWith("data-"))t.dataset[n.slice(5)]=o;else{const e=n.replace(/-([a-z])/g,((t,e)=>e.toUpperCase()));if(e in t){const n=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),e),s="boolean"==typeof t[e]||n?.get&&"boolean"==typeof n.get.call(t);t[e]=s?"false"!==o&&(""===o||o===e||"true"===o):o}}}))}s.length&&s.forEach((t=>t()))}}return class{constructor(t,s={}){this.name=t,this.config=s,this.emitter=new n,this.signal=e,this.renderer=new o,this._components=new Map,this._plugins=new Map,this._lifecycleHooks=["onBeforeMount","onMount","onBeforeUpdate","onUpdate","onUnmount"],this._isMounted=!1}use(t,e={}){return t.install(this,e),this._plugins.set(t.name,t),this}component(t,e){return this._components.set(t,e),this}async mount(n,o,s={}){if(!n)throw new Error(`Container not found: ${n}`);const i="string"==typeof o?this._components.get(o):o;if(!i)throw new Error(`Component "${o}" not registered.`);if("function"!=typeof i.template)throw new Error("Component template must be a function");const{setup:r,template:a,style:c,children:u}=i,l={props:s,emitter:this.emitter,signal:t=>new this.signal(t),...this._prepareLifecycleHooks()},h="function"==typeof r?await r(l):{};return await(async s=>{const i={...l,...s},r=[],h=[],f=[];this._isMounted?i.onBeforeUpdate&&i.onBeforeUpdate():i.onBeforeMount&&i.onBeforeMount();const p=async()=>{const e=t.parse(a(i),i);this.renderer.patchDOM(n,e),this._processEvents(n,i,f),this._injectStyles(n,o,c,i),await this._mountComponents(n,u,h),this._isMounted?i.onUpdate&&i.onUpdate():(i.onMount&&i.onMount(),this._isMounted=!0)};for(const t of Object.values(s))t instanceof e&&r.push(t.watch(p));return await p(),{container:n,data:i,unmount:()=>{for(const t of r)t();for(const t of f)t();for(const t of h)t.unmount();i.onUnmount&&i.onUnmount(),n.innerHTML=""}}})(h)}_prepareLifecycleHooks(){const t={};for(const e of this._lifecycleHooks)t[e]=()=>{};return t}_processEvents(e,n,o){const s=e.querySelectorAll("*");for(const e of s){const s=e.attributes;for(let i=0;i<s.length;i++){const r=s[i];if(r.name.startsWith("@")){const s=r.name.slice(1),i=t.evaluate(r.value,n);"function"==typeof i&&(e.addEventListener(s,i),e.removeAttribute(r.name),o.push((()=>e.removeEventListener(s,i))))}}}}_injectStyles(e,n,o,s){if(!o)return;let i=e.querySelector(`style[data-eleva-style="${n}"]`);i||(i=document.createElement("style"),i.setAttribute("data-eleva-style",n),e.appendChild(i)),i.textContent=t.parse(o(s),s)}_extractProps(t){const e={};for(const{name:n,value:o}of[...t.attributes])n.startsWith("eleva-prop-")&&(e[n.replace("eleva-prop-","")]=o);return e}async _mountComponentInstance(t,e,n){return t instanceof HTMLElement?await this.mount(t,e,n):null}async _mountComponentsBySelector(t,e,n,o){for(const s of t.querySelectorAll(e)){const t=this._extractProps(s),e=await this._mountComponentInstance(s,n,t);e&&o.push(e)}}async _mountComponents(t,e,n){for(const t of n)t.unmount();if(n.length=0,e)for(const[o,s]of Object.entries(e))o&&await this._mountComponentsBySelector(t,o,s,n);for(const[e]of this._components)await this._mountComponentsBySelector(t,e,e,n)}}}));
//# sourceMappingURL=eleva.min.js.map
