/*! Eleva Plugins v1.0.0-rc.7 | MIT License | https://elevajs.com */
var t,e;t=this,e=function(t){"use strict";const e=/-([a-z])/g,n={name:"attr",version:"1.0.0-rc.1",description:"Advanced attribute handling for Eleva components",install(t,n={}){const{enableAria:r=!0,enableData:o=!0,enableBoolean:i=!0,enableDynamic:s=!0}=n,a=(t,n)=>{const a=t.attributes,l=n.attributes;for(let n=0;n<l.length;n++){const{name:a,value:u}=l[n];if(!a.startsWith("@")&&t.getAttribute(a)!==u)if(r&&a.startsWith("aria-"))t["aria"+a.slice(5).replace(e,(t,e)=>e.toUpperCase())]=u,t.setAttribute(a,u);else if(o&&a.startsWith("data-"))t.dataset[a.slice(5)]=u,t.setAttribute(a,u);else{let n=a.replace(e,(t,e)=>e.toUpperCase());if(s&&!(n in t)&&!Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),n)){const e=Object.getOwnPropertyNames(Object.getPrototypeOf(t)).find(t=>t.toLowerCase()===a.toLowerCase()||t.toLowerCase().includes(a.toLowerCase())||a.toLowerCase().includes(t.toLowerCase()));e&&(n=e)}const r=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),n);if(n in t||r)if(i)if("boolean"==typeof t[n]||r?.get&&"boolean"==typeof r.get.call(t)){const e="false"!==u&&(""===u||u===n||"true"===u);t[n]=e,e?t.setAttribute(a,""):t.removeAttribute(a)}else t[n]=u,t.setAttribute(a,u);else t[n]=u,t.setAttribute(a,u);else t.setAttribute(a,u)}}for(let e=a.length-1;e>=0;e--){const r=a[e].name;n.hasAttribute(r)||t.removeAttribute(r)}};t.renderer&&(t.renderer.updateAttributes=a,t.renderer._originalPatchNode=t.renderer._patchNode,t.renderer._patchNode=function(t,e){t?._eleva_instance||(this._isSameNode(t,e)?t.nodeType===Node.ELEMENT_NODE?(a(t,e),this._diff(t,e)):t.nodeType===Node.TEXT_NODE&&t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue):t.replaceWith(e.cloneNode(!0)))}),t.plugins||(t.plugins=new Map),t.plugins.set(this.name,{name:this.name,version:this.version,description:this.description,options:n}),t.updateElementAttributes=a},uninstall(t){t.renderer&&t.renderer._originalPatchNode&&(t.renderer._patchNode=t.renderer._originalPatchNode,delete t.renderer._originalPatchNode),t.plugins&&t.plugins.delete(this.name),delete t.updateElementAttributes}},r={handle(t,e,n={}){const r=new Error(`[ElevaRouter] ${e}: ${t.message}`);throw r.originalError=t,r.context=e,r.details=n,r},warn(t,e={}){},log(t,e,n={}){}};class o{constructor(t,e={}){this.eleva=t,this.options={mode:"hash",queryParam:"view",viewSelector:"root",...e},this.routes=this._processRoutes(e.routes||[]),this.emitter=this.eleva.emitter,this.isStarted=!1,this._isNavigating=!1,this.eventListeners=[],this.currentRoute=new this.eleva.signal(null),this.previousRoute=new this.eleva.signal(null),this.currentParams=new this.eleva.signal({}),this.currentQuery=new this.eleva.signal({}),this.currentLayout=new this.eleva.signal(null),this.currentView=new this.eleva.signal(null),this.plugins=new Map,this.errorHandler=r,this._validateOptions()}_validateOptions(){["hash","query","history"].includes(this.options.mode)||this.errorHandler.handle(new Error(`Invalid routing mode: ${this.options.mode}. Must be "hash", "query", or "history".`),"Configuration validation failed")}_processRoutes(t){const e=[];for(const n of t)try{e.push({...n,segments:this._parsePathIntoSegments(n.path)})}catch(t){this.errorHandler.warn(`Invalid path in route definition "${n.path||"undefined"}": ${t.message}`,{route:n,error:t})}return e}_parsePathIntoSegments(t){t&&"string"==typeof t||this.errorHandler.handle(new Error("Route path must be a non-empty string"),"Path parsing failed",{path:t});const e=t.replace(/\/+/g,"/").replace(/\/$/,"")||"/";return"/"===e?[]:e.split("/").filter(Boolean).map(e=>{if(e.startsWith(":")){const n=e.substring(1);return n||this.errorHandler.handle(new Error(`Invalid parameter segment: ${e}`),"Path parsing failed",{segment:e,path:t}),{type:"param",name:n}}return{type:"static",value:e}})}_findViewElement(t){const e=this.options.viewSelector;return t.querySelector(`#${e}`)||t.querySelector(`.${e}`)||t.querySelector(`[data-${e}]`)||t.querySelector(e)||t}async start(){if(this.isStarted)return void this.errorHandler.warn("Router is already started");if("undefined"==typeof window)return void this.errorHandler.warn("Router start skipped: `window` object not available (SSR environment)");if("undefined"!=typeof document&&!document.querySelector(this.options.mount))return void this.errorHandler.warn(`Mount element "${this.options.mount}" was not found in the DOM. The router will not start.`,{mountSelector:this.options.mount});const t=()=>this._handleRouteChange();"hash"===this.options.mode?(window.addEventListener("hashchange",t),this.eventListeners.push(()=>window.removeEventListener("hashchange",t))):(window.addEventListener("popstate",t),this.eventListeners.push(()=>window.removeEventListener("popstate",t))),this.isStarted=!0,await this._handleRouteChange()}async destroy(){if(this.isStarted){for(const t of this.plugins.values())if("function"==typeof t.destroy)try{await t.destroy(this)}catch(e){this.errorHandler.log(`Plugin ${t.name} destroy failed`,e)}this.eventListeners.forEach(t=>t()),this.eventListeners=[],this.currentLayout.value&&await this.currentLayout.value.unmount(),this.isStarted=!1}}async navigate(t,e={}){try{const n="string"==typeof t?{path:t,params:e}:t;let r=this._buildPath(n.path,n.params||{});const o=n.query||{};if(Object.keys(o).length>0){const t=new URLSearchParams(o).toString();t&&(r+=`?${t}`)}if(this._isSameRoute(r,n.params,o))return;if(await this._proceedWithNavigation(r)){this._isNavigating=!0;const t=n.state||{},e=n.replace||!1,o=e?"replaceState":"pushState";if("hash"===this.options.mode)if(e){const e=`${window.location.pathname}${window.location.search}#${r}`;window.history.replaceState(t,"",e)}else window.location.hash=r;else{const e="query"===this.options.mode?this._buildQueryUrl(r):r;history[o](t,"",e)}queueMicrotask(()=>{this._isNavigating=!1})}}catch(t){this.errorHandler.log("Navigation failed",t),await this.emitter.emit("router:onError",t)}}_buildQueryUrl(t){const e=new URLSearchParams(window.location.search);return e.set(this.options.queryParam,t.split("?")[0]),`${window.location.pathname}?${e.toString()}`}_isSameRoute(t,e,n){const r=this.currentRoute.value;if(!r)return!1;const[o,i]=t.split("?"),s=n||this._parseQuery(i||"");return r.path===o&&JSON.stringify(r.params)===JSON.stringify(e||{})&&JSON.stringify(r.query)===JSON.stringify(s)}_buildPath(t,e){let n=t;for(const[t,r]of Object.entries(e)){const e=encodeURIComponent(String(r));n=n.replace(new RegExp(`:${t}\\b`,"g"),e)}return n}async _handleRouteChange(){if(this._isNavigating)return;const t=this.currentRoute.value,e=this._getCurrentLocation();!await this._proceedWithNavigation(e.fullUrl)&&t&&this.navigate({path:t.path,query:t.query,replace:!0})}async _proceedWithNavigation(t){const e=this.currentRoute.value,[n,r]=(t||"/").split("?"),o={path:n.startsWith("/")?n:`/${n}`,query:this._parseQuery(r),fullUrl:t};let i=this._matchRoute(o.path);if(!i){const t=this.routes.find(t=>"*"===t.path);if(!t)return await this.emitter.emit("router:onError",new Error(`Route not found: ${o.path}`),o,e),!1;i={route:t,params:{pathMatch:o.path.substring(1)}}}const s={...o,params:i.params,meta:i.route.meta||{},name:i.route.name,matched:i.route};try{if(!await this._runGuards(s,e,i.route))return!1;const{layoutComponent:t,pageComponent:n}=await this._resolveComponents(i.route);if(e){const t=async t=>{if(t)try{await t.unmount()}catch(e){this.errorHandler.warn("Error during component unmount",{error:e,instance:t})}};(i.route.layout||this.options.globalLayout)!==(e.matched.layout||this.options.globalLayout)?(await t(this.currentLayout.value),this.currentLayout.value=null):(await t(this.currentView.value),this.currentView.value=null),e.matched.afterLeave&&(await e.matched.afterLeave(s,e),await this.emitter.emit("router:afterLeave",s,e))}return this.previousRoute.value=e,this.currentRoute.value=s,this.currentParams.value=s.params||{},this.currentQuery.value=s.query||{},await this._render(t,n,s),i.route.afterEnter&&(await i.route.afterEnter(s,e),await this.emitter.emit("router:afterEnter",s,e)),await this.emitter.emit("router:afterEach",s,e),!0}catch(t){return this.errorHandler.log("Error during navigation",t,{to:s,from:e}),await this.emitter.emit("router:onError",t,s,e),!1}}async _runGuards(t,e,n){const r=[...this.options.onBeforeEach?[this.options.onBeforeEach]:[],...e&&e.matched.beforeLeave?[e.matched.beforeLeave]:[],...n.beforeEnter?[n.beforeEnter]:[]];for(const n of r){const r=await n(t,e);if(!1===r)return!1;if("string"==typeof r||"object"==typeof r)return this.navigate(r),!1}return!0}_resolveStringComponent(t){const e=this.eleva._components.get(t);return e||this.errorHandler.handle(new Error(`Component "${t}" not registered.`),"Component resolution failed",{componentName:t,availableComponents:Array.from(this.eleva._components.keys())}),e}async _resolveFunctionComponent(t){try{const e=t.toString(),n=e.includes("import(")||e.startsWith("() =>"),r=await t();return n&&r.default||r}catch(e){this.errorHandler.handle(new Error(`Failed to load async component: ${e.message}`),"Component resolution failed",{function:t.toString(),error:e})}}_validateComponentDefinition(t){return t&&"object"==typeof t||this.errorHandler.handle(new Error("Invalid component definition: "+typeof t),"Component validation failed",{definition:t}),"function"!=typeof t.template&&"string"!=typeof t.template&&this.errorHandler.handle(new Error("Component missing template property"),"Component validation failed",{definition:t}),t}async _resolveComponent(t){return null==t?null:"string"==typeof t?this._resolveStringComponent(t):"function"==typeof t?await this._resolveFunctionComponent(t):t&&"object"==typeof t?this._validateComponentDefinition(t):void this.errorHandler.handle(new Error("Invalid component definition: "+typeof t),"Component resolution failed",{definition:t})}async _resolveComponents(t){const e=t.layout||this.options.globalLayout;try{const[n,r]=await Promise.all([this._resolveComponent(e),this._resolveComponent(t.component)]);return r||this.errorHandler.handle(new Error(`Page component is null or undefined for route: ${t.path}`),"Component resolution failed",{route:t.path}),{layoutComponent:n,pageComponent:r}}catch(e){throw this.errorHandler.log(`Error resolving components for route ${t.path}`,e,{route:t.path}),e}}async _render(t,e){const n=document.querySelector(this.options.mount);if(n||this.errorHandler.handle(new Error(`Mount element "${this.options.mount}" not found.`),{mountSelector:this.options.mount}),t){const r=await this.eleva.mount(n,this._wrapComponentWithChildren(t));this.currentLayout.value=r;const o=this._findViewElement(r.container),i=await this.eleva.mount(o,this._wrapComponentWithChildren(e));this.currentView.value=i}else{const t=await this.eleva.mount(n,this._wrapComponentWithChildren(e));this.currentView.value=t,this.currentLayout.value=null}}_createRouteGetter(t,e){return()=>this.currentRoute.value?.[t]??e}_wrapComponent(t){const e=t.setup,n=this;return{...t,setup:async t=>(t.router={navigate:n.navigate.bind(n),current:n.currentRoute,previous:n.previousRoute,get params(){return n._createRouteGetter("params",{})()},get query(){return n._createRouteGetter("query",{})()},get path(){return n._createRouteGetter("path","/")()},get fullUrl(){return n._createRouteGetter("fullUrl",window.location.href)()},get meta(){return n._createRouteGetter("meta",{})()}},e?await e(t):{})}}_wrapComponentWithChildren(t){const e=this._wrapComponent(t);if(e.children&&"object"==typeof e.children){const t={};for(const[n,r]of Object.entries(e.children))t[n]=this._wrapComponentWithChildren(r);e.children=t}return e}_getCurrentLocation(){if("undefined"==typeof window)return{path:"/",query:{},fullUrl:""};let t,e,n;switch(this.options.mode){case"hash":n=window.location.hash.slice(1)||"/",[t,e]=n.split("?");break;case"query":t=new URLSearchParams(window.location.search).get(this.options.queryParam)||"/",e=window.location.search.slice(1),n=t;break;default:t=window.location.pathname||"/",e=window.location.search.slice(1),n=`${t}${e?"?"+e:""}`}return{path:t.startsWith("/")?t:`/${t}`,query:this._parseQuery(e),fullUrl:n}}_parseQuery(t){const e={};return t&&new URLSearchParams(t).forEach((t,n)=>{e[n]=t}),e}_matchRoute(t){const e=t.split("/").filter(Boolean);for(const t of this.routes){if("/"===t.path){if(0===e.length)return{route:t,params:{}};continue}if(t.segments.length!==e.length)continue;const n={};let r=!0;for(let o=0;o<t.segments.length;o++){const i=t.segments[o],s=e[o];if("param"===i.type)n[i.name]=decodeURIComponent(s);else if(i.value!==s){r=!1;break}}if(r)return{route:t,params:n}}return null}onBeforeEach(t){this.options.onBeforeEach=t}onAfterEnter(t){this.emitter.on("router:afterEnter",t)}onAfterLeave(t){this.emitter.on("router:afterLeave",t)}onAfterEach(t){this.emitter.on("router:afterEach",t)}onError(t){this.emitter.on("router:onError",t)}use(t,e={}){"function"!=typeof t.install&&this.errorHandler.handle(new Error("Plugin must have an install method"),"Plugin registration failed",{plugin:t}),this.plugins.has(t.name)?this.errorHandler.warn(`Plugin "${t.name}" is already registered`,{existingPlugin:this.plugins.get(t.name)}):(this.plugins.set(t.name,t),t.install(this,e))}getPlugins(){return Array.from(this.plugins.values())}getPlugin(t){return this.plugins.get(t)}removePlugin(t){const e=this.plugins.get(t);if(!e)return!1;if("function"==typeof e.destroy)try{e.destroy(this)}catch(e){this.errorHandler.log(`Plugin ${t} destroy failed`,e)}return this.plugins.delete(t)}setErrorHandler(t){t&&"function"==typeof t.handle&&"function"==typeof t.warn&&"function"==typeof t.log&&(this.errorHandler=t)}}const i={name:"router",version:"1.0.0-rc.1",description:"Client-side routing for Eleva applications",install(t,e={}){if(!e.mount)throw new Error("[RouterPlugin] 'mount' option is required");if(!e.routes||!Array.isArray(e.routes))throw new Error("[RouterPlugin] 'routes' option must be an array");const n=(e,n)=>{if(!e)return null;if("object"==typeof e&&null!==e&&!e.name){const r=`Eleva${n}Component_${Math.random().toString(36).slice(2,11)}`;try{return t.component(r,e),r}catch(t){throw new Error(`[RouterPlugin] Failed to register ${n} component: ${t.message}`)}}return e};e.globalLayout&&(e.globalLayout=n(e.globalLayout,"GlobalLayout")),(e.routes||[]).forEach(t=>{t.component=n(t.component,"Route"),t.layout&&(t.layout=n(t.layout,"RouteLayout"))});const r=new o(t,e);return t.router=r,!1!==e.autoStart&&queueMicrotask(()=>r.start()),t.plugins||(t.plugins=new Map),t.plugins.set(this.name,{name:this.name,version:this.version,description:this.description,options:e}),t.navigate=r.navigate.bind(r),t.getCurrentRoute=()=>r.currentRoute.value,t.getRouteParams=()=>r.currentParams.value,t.getRouteQuery=()=>r.currentQuery.value,r},async uninstall(t){t.router&&(await t.router.destroy(),delete t.router),t.plugins&&t.plugins.delete(this.name),delete t.navigate,delete t.getCurrentRoute,delete t.getRouteParams,delete t.getRouteQuery}};class s{static expressionPattern=/\{\{\s*(.*?)\s*\}\}/g;static parse(t,e){return"string"!=typeof t?t:t.replace(this.expressionPattern,(t,n)=>this.evaluate(n,e))}static evaluate(t,e){if("string"!=typeof t)return t;try{return new Function("data",`with(data) { return ${t}; }`)(e)}catch{return""}}}const a={name:"props",version:"1.0.0-rc.2",description:"Advanced props data handling for complex data structures with automatic type detection and reactivity",install(t,e={}){const{enableAutoParsing:n=!0,enableReactivity:r=!0,onError:o=null}=e,i=t=>{try{if("string"!=typeof t)return t;if("true"===t)return!0;if("false"===t)return!1;if("null"===t)return null;if("undefined"===t)return;if(t.startsWith("{")||t.startsWith("["))try{return JSON.parse(t)}catch(e){throw new Error(`Invalid JSON: ${t}`)}if("1"===t)return!0;if("0"===t)return!1;if(""===t)return!0;if(!isNaN(t)&&""!==t&&!isNaN(parseFloat(t)))return Number(t);if(t.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)){const e=new Date(t);if(!isNaN(e.getTime()))return e}return t}catch(e){return o&&o(e,t),t}},a=e=>{const n={};return Object.entries(e).forEach(([e,r])=>{n[e]=r&&"object"==typeof r&&"value"in r&&"watch"in r?r:new t.signal(r)}),n};t._extractProps=t=>{const e={},r=t.attributes;for(let o=r.length-1;o>=0;o--){const s=r[o];if(s.name.startsWith(":")){const r=s.name.slice(1),o=n?i(s.value):s.value;e[r]=o,t.removeAttribute(s.name)}}return e};const l=t.mount;t.mount=async(e,n,o={})=>{const i=r?a(o):o;return await l.call(t,e,n,i)};const u=t._mountComponents,c=new WeakMap,h=new Set;t._mountComponents=async(e,n,o)=>{for(const[i,s]of Object.entries(n))if(i)for(const n of e.querySelectorAll(i)){if(!(n instanceof HTMLElement))continue;const i=t._extractProps(n);let l=i,u=c.get(e);if(!u){let t=e;for(;t&&!u;){if(t._eleva_instance&&t._eleva_instance.data){u=t._eleva_instance.data,c.set(e,u);break}t=t.parentElement}}if(r&&u){const e={};Object.keys(i).forEach(n=>{u[n]&&u[n]instanceof t.signal&&(e[n]=u[n])}),l={...i,...e}}let p=l;if(r){const t={};Object.entries(l).forEach(([e,n])=>{n&&"object"==typeof n&&"value"in n&&"watch"in n||(t[e]=n)}),p={...a(t),...l}}const d=await t.mount(n,s,p);d&&!o.includes(d)&&(o.push(d),r&&Object.keys(i).length>0&&!u&&h.add({instance:d,extractedProps:i,container:e,component:s}))}if(r&&h.size>0)for(const e of h){const{instance:n,extractedProps:r,container:o,component:i}=e;let a=c.get(o);if(!a){let t=o;for(;t&&!a;){if(t._eleva_instance&&t._eleva_instance.data){a=t._eleva_instance.data,c.set(o,a);break}t=t.parentElement}}if(a){const o={};if(Object.keys(r).forEach(e=>{a[e]&&a[e]instanceof t.signal&&(o[e]=a[e])}),Object.keys(o).length>0){Object.assign(n.data,o),Object.keys(o).forEach(e=>{const r=o[e];r&&"function"==typeof r.watch&&r.watch(()=>{const e=t._components.get(i)||i;if(e&&e.template){const r="function"==typeof e.template?e.template(n.data):e.template,o=s.parse(r,n.data);t.renderer.patchDOM(n.container,o)}})});const e=t._components.get(i)||i;if(e&&e.template){const r="function"==typeof e.template?e.template(n.data):e.template,o=s.parse(r,n.data);t.renderer.patchDOM(n.container,o)}}h.delete(e)}}},t.props={parse:t=>n?i(t):t,detectType:t=>null===t?"null":void 0===t?"undefined":"boolean"==typeof t?"boolean":"number"==typeof t?"number":"string"==typeof t?"string":"function"==typeof t?"function":t instanceof Date?"date":t instanceof Map?"map":t instanceof Set?"set":Array.isArray(t)?"array":"object"==typeof t?"object":"unknown"},t._originalExtractProps=t._extractProps,t._originalMount=l,t._originalMountComponents=u},uninstall(t){t._originalExtractProps&&(t._extractProps=t._originalExtractProps,delete t._originalExtractProps),t._originalMount&&(t.mount=t._originalMount,delete t._originalMount),t._originalMountComponents&&(t._mountComponents=t._originalMountComponents,delete t._originalMountComponents),t.props&&delete t.props}},l={name:"store",version:"1.0.0-rc.1",description:"Reactive state management for sharing data across the entire Eleva application",install(t,e={}){const{state:n={},actions:r={},namespaces:o={},persistence:i={},devTools:s=!1,onError:a=null}=e,l=new class{constructor(){this.state={},this.actions={},this.subscribers=new Set,this.mutations=[],this.persistence={enabled:!1,key:"eleva-store",storage:"localStorage",include:null,exclude:null,...i},this.devTools=s,this.onError=a,this._initializeState(n,r),this._initializeNamespaces(o),this._loadPersistedState(),this._setupDevTools()}_initializeState(e,n){Object.entries(e).forEach(([e,n])=>{this.state[e]=new t.signal(n)}),this.actions={...n}}_initializeNamespaces(e){Object.entries(e).forEach(([e,n])=>{const{state:r={},actions:o={}}=n;this.state[e]||(this.state[e]={}),this.actions[e]||(this.actions[e]={}),Object.entries(r).forEach(([n,r])=>{this.state[e][n]=new t.signal(r)}),this.actions[e]={...o}})}_loadPersistedState(){if(this.persistence.enabled&&"undefined"!=typeof window)try{const t=window[this.persistence.storage].getItem(this.persistence.key);if(t){const e=JSON.parse(t);this._applyPersistedData(e)}}catch(t){this.onError&&this.onError(t,"Failed to load persisted state")}}_applyPersistedData(t,e=this.state,n=""){Object.entries(t).forEach(([t,r])=>{const o=n?`${n}.${t}`:t;this._shouldPersist(o)&&(e[t]&&"object"==typeof e[t]&&"value"in e[t]?e[t].value=r:"object"==typeof r&&null!==r&&e[t]&&this._applyPersistedData(r,e[t],o))})}_shouldPersist(t){const{include:e,exclude:n}=this.persistence;return e&&e.length>0?e.some(e=>t.startsWith(e)):!(n&&n.length>0&&n.some(e=>t.startsWith(e)))}_saveState(){if(this.persistence.enabled&&"undefined"!=typeof window)try{const t=window[this.persistence.storage],e=this._extractPersistedData();t.setItem(this.persistence.key,JSON.stringify(e))}catch(t){this.onError&&this.onError(t,"Failed to save state")}}_extractPersistedData(t=this.state,e=""){const n={};return Object.entries(t).forEach(([t,r])=>{const o=e?`${e}.${t}`:t;if(this._shouldPersist(o))if(r&&"object"==typeof r&&"value"in r)n[t]=r.value;else if("object"==typeof r&&null!==r){const e=this._extractPersistedData(r,o);Object.keys(e).length>0&&(n[t]=e)}}),n}_setupDevTools(){this.devTools&&"undefined"!=typeof window&&window.__ELEVA_DEVTOOLS__&&window.__ELEVA_DEVTOOLS__.registerStore(this)}async dispatch(t,e){try{const n=this._getAction(t);if(!n){const e=new Error(`Action "${t}" not found`);throw this.onError&&this.onError(e,t),e}const r={type:t,payload:e,timestamp:Date.now()};this.mutations.push(r),this.mutations.length>100&&this.mutations.shift();const o=await n.call(null,this.state,e);return this._saveState(),this.subscribers.forEach(t=>{try{t(r,this.state)}catch(t){this.onError&&this.onError(t,"Subscriber callback failed")}}),this.devTools&&"undefined"!=typeof window&&window.__ELEVA_DEVTOOLS__&&window.__ELEVA_DEVTOOLS__.notifyMutation(r,this.state),o}catch(e){throw this.onError&&this.onError(e,`Action dispatch failed: ${t}`),e}}_getAction(t){const e=t.split(".");let n=this.actions;for(const t of e){if(void 0===n[t])return null;n=n[t]}return"function"==typeof n?n:null}subscribe(t){if("function"!=typeof t)throw new Error("Subscribe callback must be a function");return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}getState(){return this._extractPersistedData()}replaceState(t){this._applyPersistedData(t),this._saveState()}clearPersistedState(){if(this.persistence.enabled&&"undefined"!=typeof window)try{window[this.persistence.storage].removeItem(this.persistence.key)}catch(t){this.onError&&this.onError(t,"Failed to clear persisted state")}}registerModule(t,e){this.state[t]||this.actions[t]||(this.state[t]={},this.actions[t]={},this._initializeNamespaces({[t]:e}),this._saveState())}unregisterModule(t){(this.state[t]||this.actions[t])&&(delete this.state[t],delete this.actions[t],this._saveState())}},u=t.mount;t.mount=async(e,n,r={})=>{const o="string"==typeof n&&t._components.get(n)||n;if(!o)return await u.call(t,e,n,r);const i={...o,async setup(e){e.store={state:l.state,dispatch:l.dispatch.bind(l),subscribe:l.subscribe.bind(l),getState:l.getState.bind(l),registerModule:l.registerModule.bind(l),unregisterModule:l.unregisterModule.bind(l),createState:(e,n)=>(l.state[e]||(l.state[e]=new t.signal(n)),l.state[e]),createAction:(t,e)=>{l.actions[t]=e},signal:t.signal};const n=o.setup;return n?await n(e):{}}};return await u.call(t,e,i,r)};const c=t._mountComponents;t._mountComponents=async(e,n,r)=>{const o={};for(const[e,r]of Object.entries(n)){const n="string"==typeof r&&t._components.get(r)||r;o[e]=n&&"object"==typeof n?{...n,async setup(e){e.store={state:l.state,dispatch:l.dispatch.bind(l),subscribe:l.subscribe.bind(l),getState:l.getState.bind(l),registerModule:l.registerModule.bind(l),unregisterModule:l.unregisterModule.bind(l),createState:(e,n)=>(l.state[e]||(l.state[e]=new t.signal(n)),l.state[e]),createAction:(t,e)=>{l.actions[t]=e},signal:t.signal};const r=n.setup;return r?await r(e):{}}}:r}return await c.call(t,e,o,r)},t.store=l,t.createAction=(t,e)=>{l.actions[t]=e},t.dispatch=(t,e)=>l.dispatch(t,e),t.getState=()=>l.getState(),t.subscribe=t=>l.subscribe(t),t._originalMount=u,t._originalMountComponents=c},uninstall(t){t._originalMount&&(t.mount=t._originalMount,delete t._originalMount),t._originalMountComponents&&(t._mountComponents=t._originalMountComponents,delete t._originalMountComponents),t.store&&delete t.store,t.createAction&&delete t.createAction,t.dispatch&&delete t.dispatch,t.getState&&delete t.getState,t.subscribe&&delete t.subscribe}};t.Attr=n,t.Props=a,t.Router=i,t.Store=l},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ElevaPlugins={});
//# sourceMappingURL=eleva-plugins.umd.min.js.map
